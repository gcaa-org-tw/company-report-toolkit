import{_ as G}from"./nuxt-link.25688cdb.js";import{g as T,r as x,i as b,z as k,o as y,c as I,a as o,F as K,y as A,C as B,j as a,t as P,q as N,v as E,s as O,D as q,n as J,A as Q,_ as U,b as R,w as W,d as D,x as X,p as Y,e as Z,h as ee,G as te,E as oe,k as H}from"./entry.d3bd137e.js";import{a as ae,_ as z,b as ne}from"./PdfViewer.b75af27f.js";import{u as se}from"./useProfessionApi.f7c1acb0.js";import{u as re}from"./useReport.6be69024.js";import"./_commonjsHelpers.6d090dba.js";const le={class:"searchPanel"},ie={class:"flex mt2"},de={class:"flex flex-wrap"},ce=["onClick"],ue={class:"f6 gray mv1"},pe=["onClick"],_e={class:"flex-none dark-gray"},fe=["innerHTML"],S=15,me=T({__name:"SearchPanel",props:{report:{},fieldMeta:{}},emits:["matched-pages","page"],setup(m,{emit:d}){const c=m,_=J(),$=ae(_.public.algoliaAppId,_.public.algoliaSearchApiKey).initIndex(_.public.algoliaIndexName),v=x(""),n=x(""),p=x([]),f=x(null),i=b(()=>n.value||v.value||"");k([v,n],([e,l],[t,h])=>{e!==t&&e?n.value="":l!==h&&l&&(v.value="")});function w(e){v.value=e}k(i,()=>{r()});async function r(){if(!i.value){p.value=[],f.value=null;return}const{hits:e}=await $.search(i.value,{facetFilters:[`company:${c.report.company.id}`,`year:${c.report.year}`],hitsPerPage:100});p.value=e,f.value=null}k(p,e=>{const l=e.map(t=>t.page);d("matched-pages",l)});function g(e){e=e.replace(/\n/g,"");const l=`${i.value||""}`,t=e.indexOf(l),h=l.length+S;if(t<0)return e.slice(0,h*2);const s=l.length;let M=e.slice(0,t);const L=`${e.slice(t+s,t+s+S)}...`;if(t>S)M=`...${e.slice(t-S,t)}`;else return e.slice(0,h*2)+"...";return`${z.escape(M)}<b class="underline">${l}</b>${z.escape(L)}`}async function C(e){f.value===e?d("page",{highlight:"",page:1}):f.value=e,await Q(),d("page",{highlight:i.value,page:e.page})}function F(e){return e+(c.report.company.pageOffset||0)}return(e,l)=>(y(),I("div",le,[o("div",ie,[o("div",de,[(y(!0),I(K,null,A(e.fieldMeta.keywords,t=>(y(),I("button",{class:B(["searchPanel__keyword pointer ba b--moon-gray br1",{"searchPanel__keyword--active":t===a(i)}]),key:t,onClick:h=>w(t)},P(t),11,ce))),128)),N(o("input",{class:"mt1 f6 w-100 searchPanel__input","onUpdate:modelValue":l[0]||(l[0]=t=>O(n)?n.value=t:null),placeholder:"自訂關鍵字"},null,512),[[E,a(n),void 0,{trim:!0}]])])]),N(o("div",ue,[(y(!0),I(K,null,A(a(p),t=>(y(),I("div",{class:B(["flex mv2 dim pointer",{b:t===a(f)}]),key:t.page,onClick:h=>C(t)},[o("div",_e,"頁"+P(F(t.page)),1),o("div",{class:"pl2",innerHTML:g(t.content)},null,8,fe)],10,pe))),128))],512),[[q,a(p).length]])]))}});const ve=U(me,[["__scopeId","data-v-aa760d82"]]),V=m=>(Y("data-v-d7fb1def"),m=m(),Z(),m),ge={class:"editorControl pa3"},he=V(()=>o("i",{class:"fa-solid fa-arrow-left mr1"},null,-1)),be={class:"mb3 mt2 pb3 bb b--moon-gray"},ye={class:"fw6 f4 mt0 mb2 black"},xe={class:"gray f6 mv0 lh-copy"},Ie={class:"editorControl__keywordSection pb2 mb3 bb b--moon-gray"},we=V(()=>o("div",{class:"fw5 mb1"},"相關關鍵字",-1)),Pe=V(()=>o("div",{class:"f6 gray"},"點選以下關鍵字，或是自行輸入，就能搜出相關頁面",-1)),$e=["onSubmit"],Ce=V(()=>o("div",{class:"fw5 mb2"},"填寫判讀結果",-1)),Fe={class:"flex items-center mb2"},Me={class:"fieldForm__value flex-auto mr3"},Se={class:"fieldForm__unit flex-none"},ke={class:"tr"},Ne=["disabled"],Ve=T({__name:"EditorControl",props:{report:{},reportField:{},fieldMeta:{}},emits:["page","matched-pages","next","prev"],setup(m,{emit:d}){const c=m,{feathers:_}=se(),u=b(()=>({name:"profession-report-reportId",params:{reportId:c.report.id}}));function $(r){d("matched-pages",r)}function v(r){d("page",r)}const n=x({value:"",unit:""}),p=b(()=>n.value.value&&n.value.unit);k(()=>c.reportField,r=>{n.value.value=r.value,n.value.unit=r.unit});async function f(){await _.app.service("report-field").patch(c.reportField.id,{value:n.value.value,unit:n.value.unit}),d("next")}function i(){d("next")}function w(){d("prev")}return(r,g)=>{const C=G,F=ve;return y(),I("div",ge,[R(C,{class:"flex f6 gray items-center no-underline dim",to:a(u)},{default:W(()=>[he,D(P(r.report.company.abbreviation)+" "+P(r.report.year)+" 報告書",1)]),_:1},8,["to"]),o("div",be,[o("h1",ye,P(r.fieldMeta.name),1),o("p",xe,P(r.fieldMeta.description),1)]),o("div",{class:"flex justify-between items-center mb3 mt2 pb3 bb b--moon-gray"},[o("button",{class:"editorControl__nav",onClick:w},"往上個欄位"),o("button",{class:"editorControl__nav",onClick:i},"往下個欄位")]),o("div",Ie,[we,Pe,R(F,{report:r.report,"field-meta":r.fieldMeta,onMatchedPages:$,onPage:v},null,8,["report","field-meta"])]),o("form",{class:"fieldForm pb2 mb3 bb b--moon-gray",onSubmit:X(f,["prevent"])},[Ce,o("div",Fe,[o("label",Me,[D("數值"),N(o("input",{class:"fieldForm__input","onUpdate:modelValue":g[0]||(g[0]=e=>a(n).value=e),type:"text",placeholder:"數值"},null,512),[[E,a(n).value,void 0,{trim:!0}]])]),o("label",Se,[D("單位"),N(o("input",{class:"fieldForm__input","onUpdate:modelValue":g[1]||(g[1]=e=>a(n).unit=e),type:"text",placeholder:"單位"},null,512),[[E,a(n).unit,void 0,{trim:!0}]])])]),o("div",ke,[o("button",{class:"fieldForm__submit pv2 ph3 bw0 bg--green tc w4 pointer",disabled:!a(p)},"儲存",8,Ne)])],40,$e)])}}});const Le=U(Ve,[["__scopeId","data-v-d7fb1def"]]),De={key:0,class:"editor"},Ee={class:"editor__viewer"},ze=T({__name:"[fieldId]",setup(m){const d=ee(),c=b(()=>Number.parseInt(d.params.reportId)),{report:_,reportFieldList:u,isDataReady:$,meta:v}=re(c.value),n=b(()=>Number.parseInt(d.params.fieldId)),p=b(()=>u.value.find(M=>M.id===n.value)||u.value[0]),f=b(()=>v(p.value)),i=x({page:1,highlight:""}),w=x([]),r=x(0);function g(s){r.value=s}function C(s){i.value=s}function F(s){w.value=s}const e=te(),l=b(()=>u.value.findIndex(s=>s.id===n.value));function t(){let s=l.value+1;s===u.value.length&&(s=0),e.push({name:"profession-editor-reportId-fieldId",params:{reportId:c.value,fieldId:u.value[s].id}})}function h(){let s=l.value-1;s<0&&(s=u.value.length-1),e.push({name:"profession-editor-reportId-fieldId",params:{reportId:c.value,fieldId:u.value[s].id}})}return(s,M)=>{const L=Le,j=ne;return a($)?(y(),I("div",De,[R(L,{class:"editor__control br b--moon-gray",report:a(_),"report-field":a(p),"field-meta":a(f),onPage:C,onMatchedPages:F,onNext:t,onPrev:h},null,8,["report","report-field","field-meta"]),o("div",Ee,[a(i)?(y(),oe(j,{key:0,year:a(_).year,report:a(_),page:a(i).page,highlight:a(i).highlight,"matched-pages":a(w),onViewPage:g},null,8,["year","report","page","highlight","matched-pages"])):H("",!0)])])):H("",!0)}}});export{ze as default};
