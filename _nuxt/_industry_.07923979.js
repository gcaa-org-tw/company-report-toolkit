import{_ as j}from"./FieldProgress.d751a72f.js";import{_ as q}from"./nuxt-link.9916f4ff.js";import{f as Y,h as $,o as e,c as t,i,F as v,t as d,j as g,r as L,L as z,z as J,d as N,a,y as b,b as D,w as B,J as G,p as K,e as Q,_ as U,I as W,n as X,g as Z,B as T,C as x}from"./entry.64d8ce45.js";import{u as E}from"./useProfessionApi.aff587e3.js";import{u as ee}from"./useFieldMeta.6b47ff0d.js";import{d as H}from"./dayjs.min.43e59120.js";import{m as te}from"./industryStats.5556f7dc.js";import{_ as se}from"./lodash.5caf96cb.js";const ie={class:"cellValue"},re={key:0,class:"moon-gray"},ne={key:0,class:"cellValue__value"},oe={key:1,class:"f6 gray"},ae=Y({__name:"IndustryCellValue",props:{reportField:{},filedMeta:{}},setup(n){const u=n,y=$(()=>!u.reportField||!u.reportField.value&&!u.reportField.notes);return(c,r)=>(e(),t("div",ie,[i(y)?(e(),t("div",re,"尚未判讀")):(e(),t(v,{key:1},[c.reportField.value?(e(),t("div",ne,d(c.reportField.value)+" "+d(c.reportField.unit),1)):g("",!0),c.reportField.notes?(e(),t("div",oe,d(c.reportField.notes),1)):g("",!0)],64))]))}}),P=n=>(K("data-v-7559545f"),n=n(),Q(),n),le={class:"industryDetail"},ce={key:0,class:"mv5 tc f2"},de={class:"fw7"},_e=P(()=>a("div",{class:"industryDetail__cell industryDetail__cell--head industryDetail__cell--name"},"公司名稱",-1)),ue=P(()=>a("div",{class:"industryDetail__cell industryDetail__cell--head"},"更新時間",-1)),pe={key:0,class:"industryDetail__cell industryDetail__cell--head"},ye={key:0},fe=P(()=>a("i",{class:"ml2 fa-solid fa-arrow-up-right-from-square"},null,-1)),me={class:"industryDetail__value"},ve={class:"industryDetail__cell"},he={key:0,class:"industryDetail__cell"},ge=["onClick"],ke=Y({__name:"IndustryDetail",props:{reportList:{}},setup(n){const u=n,{feathers:y,isAdmin:c}=E(),r=L({}),{filedMetaList:k}=ee(),f=L(0),w=$(()=>{let s=`6rem repeat(${k.value.length}, 6rem) 8rem`;return c.value&&(s+=" 10rem"),{gridTemplateColumns:s}});function m(s){return H(s).format("YYYY/MM/DD HH:mm")}function M(s){return`/profession/report/${s.id}`}const I=z();async function C(s){confirm(`確定要將「${s.company.name} 」標為已驗證嗎？按下去之後，整本報告書就無法修改囉～～～`)&&(await y.app.service("report").patch(s.id,{isVerified:!0}),I.add({type:"success",text:`${s.company.name}驗證完畢`}),s.isVerified=!0)}function R(s,p=0){return y.app.service("report-field").find({query:{reportId:{$in:s},$limit:200,$skip:p}})}async function V(){const s=u.reportList.map(l=>l.id);let p=0;for(;;){const l=await R(s,p);if(l.data.forEach(h=>{r.value[h.reportId]||(r.value[h.reportId]={}),r.value[h.reportId][h.fieldId]=h}),!l.data.length){f.value=100;break}p=l.skip+l.data.length,f.value=Math.floor(p*100/l.total)}}async function S(){await V()}return J(()=>u.reportList,S,{immediate:!0}),(s,p)=>{const l=q,h=ae;return e(),t("div",le,[i(f)<100?(e(),t("h1",ce,[N(" 資料載入中... "),a("span",de,d(i(f))+"%",1)])):g("",!0),a("div",{class:"industryDetail__table mv3 f6",style:G(i(w))},[_e,(e(!0),t(v,null,b(i(k),_=>(e(),t("div",{key:_.id,class:"industryDetail__cell industryDetail__cell--head"},d(_.name),1))),128)),ue,i(c)?(e(),t("div",pe)):g("",!0),(e(!0),t(v,null,b(s.reportList,_=>(e(),t(v,{key:_.id},[i(r)[_.id]?(e(),t(v,{key:0},[D(l,{to:M(_),class:"industryDetail__cell industryDetail__cell--name gray dim no-underline"},{default:B(()=>[_.isVerified?(e(),t("span",ye,"✅")):g("",!0),N(" "+d(_.company.abbreviation)+" ",1),fe]),_:2},1032,["to"]),(e(!0),t(v,null,b(i(k),o=>(e(),t("div",{key:o.id,class:"industryDetail__cell"},[a("div",me,[D(h,{"report-field":i(r)[_.id][o.id],"filed-meta":o},null,8,["report-field","filed-meta"])])]))),128)),a("div",ve,d(m(_.updatedAt)),1),i(c)?(e(),t("div",he,[_.isVerified?g("",!0):(e(),t("button",{key:0,class:"bg-green white pv1 ph2 br2 bw0 dim pointer",onClick:o=>C(_)}," 標為已驗證 ✅ ",8,ge))])):g("",!0)],64)):g("",!0)],64))),128))],4)])}}});const $e=U(ke,[["__scopeId","data-v-7559545f"]]),be={class:"reportList"},Le=X('<div class="reportList__report"><div class="reportList__cell">公司名稱</div><div class="reportList__cell">年份</div><div class="reportList__cell">進度</div><div class="reportList__cell">更新時間</div></div>',1),De={class:"reportList__cell"},we={class:"reportList__cell"},Ie={class:"reportList__cell"},Ce={class:"reportList__cell"},Fe=a("i",{class:"fa-solid fa-arrow-right self-center"},null,-1),Ve={key:1,class:"pa2 tc"},xe=Y({__name:"ReportList",props:{reportList:{},filter:{}},setup(n){const u=n,y=$(()=>u.filter===F.all?u.reportList:u.reportList.filter(r=>u.filter===F.verified?r.isVerified:u.filter===F.isAnswered?r.answeredFields===r.totalFields:r.answeredFields<r.totalFields));function c(r){return H(r).format("YYYY/MM/DD HH:mm")}return(r,k)=>{const f=j,w=q;return e(),t("div",be,[Le,i(y).length?(e(!0),t(v,{key:0},b(i(y),m=>(e(),W(w,{key:m.id,to:`/profession/report/${m.id}`,class:"reportList__report black dim no-underline"},{default:B(()=>[a("div",De,d(m.company.name),1),a("div",we,d(m.year),1),a("div",Ie,[D(f,{progress:m,"is-industry":!1},null,8,["progress"])]),a("div",Ce,d(c(m.updatedAt)),1),Fe]),_:2},1032,["to"]))),128)):(e(),t("div",Ve," 此分類無 資料 "))])}}});const Ye={class:"pb3"},Me={class:"tc f2 fw6 mb2"},Re={class:"tc f3 mv2"},Se={class:"w5 center"},Pe={class:"pv3 mb4 bt bb b--moon-gray flex justify-between"},Ae={key:0},Ne=["onClick"],je={key:1},qe=["onClick"],Be={class:"industry__modeList"},Ee=["onClick"],He={key:0},Oe={key:1,class:"pa4"};var F=(n=>(n.all="全部",n.verified="已驗證",n.isAnswered="判讀完成",n.pending="待判讀",n))(F||{}),O=(n=>(n.list="報告書列表",n.detail="所有欄位資料",n))(O||{});const Ze=Y({__name:"[industry]",setup(n){const y=Z().params.industry,{feathers:c}=E(),r=L([]),k=L("全部"),f=L(0),w=$(()=>se.uniq(r.value.map(s=>s.year)));function m(s){f.value=s}const M=$(()=>r.value.filter(s=>s.year===f.value)),I=L("報告書列表"),C=$(()=>I.value==="所有欄位資料");function R(s){k.value=s}const V=$(()=>{const s={};return r.value.forEach(p=>{te(s,p)}),s[y]});async function S(){const p=(await c.app.service("company").find({query:{industry:y,$select:["id"],$limit:500}})).data.map(l=>l.id);c.app.service("report").find({query:{companyId:{$in:p},$limit:500,$sort:{year:-1}}}).then(l=>{r.value=l.data,l.data.length&&(f.value=l.data[0].year)})}return T(()=>{c.isReady.value&&S()}),(s,p)=>{const l=j,h=$e,_=xe;return i(r).length?(e(),t("div",{key:0,class:x(["industry pa4 lh-copy",{"industry--wide":i(C)}])},[a("div",Ye,[a("h1",Me,d(i(y)),1),a("p",Re,d(i(V).total)+" 本",1),a("div",Se,[D(l,{progress:i(V)},null,8,["progress"])])]),a("div",Pe,[i(C)?(e(),t("div",Ae,[(e(!0),t(v,null,b(i(w),o=>(e(),t("button",{class:x(["industry__filter bg-white pv2 ph3 ba b--light-gray br2 dim pointer",{"bg-green":i(f)===o}]),key:o,onClick:A=>m(o)},d(o),11,Ne))),128))])):(e(),t("div",je,[(e(!0),t(v,null,b(Object.values(F),o=>(e(),t("button",{class:x(["industry__filter bg-white pv2 ph3 ba b--light-gray br2 dim pointer",{"bg-green":i(k)===o}]),key:o,onClick:A=>R(o)},d(o),11,qe))),128))])),a("div",Be,[(e(!0),t(v,null,b(Object.values(O),o=>(e(),t("button",{class:x(["industry__mode bg-white pv2 ph3 ba b-light-green b--light-gray br2 dim pointer",{"industry__mode--active":i(I)===o}]),key:o,onClick:A=>I.value=o},d(o),11,Ee))),128))])]),i(C)?(e(),t("div",He,[D(h,{"report-list":i(M)},null,8,["report-list"])])):(e(),t("div",Oe,[D(_,{"report-list":i(r),filter:i(k)},null,8,["report-list","filter"])]))],2)):g("",!0)}}});export{F as FilterType,Ze as default};
