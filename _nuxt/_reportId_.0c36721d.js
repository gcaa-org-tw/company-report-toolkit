import{_ as Nt}from"./nuxt-link.0417cf0c.js";import{f as he,r as k,h as T,B as fe,z as be,o as N,c as C,a as d,F as te,y as ce,C as Le,i as m,t as J,q as H,v as Ie,s as nt,D as Ee,m as Ft,A as Ue,_ as pe,L as Ot,M as He,d as z,N as Ct,x as Tt,p as Ne,e as Fe,E as xe,J as Be,j as de,b as _e,w as Pt,u as $t,l as Dt,G as Mt,H as kt,I as Ve,K as Lt,g as Ut,O as Bt}from"./entry.32f6ad73.js";import{a as Vt,_ as Se,u as Yt,b as qt,c as zt}from"./SinglePdfPage.8a3c799e.js";import{u as it}from"./useProfessionApi.79a3563e.js";import{u as Jt}from"./useReport.510e26c3.js";import"./_commonjsHelpers.81b02c95.js";const jt={class:"searchPanel"},Ht={class:"flex mt2"},Qt={class:"flex flex-wrap"},Gt=["onClick"],Wt={class:"f6 dark-gray mv1"},Kt=["onClick"],Xt={class:"flex-none dark-gray"},Zt=["innerHTML"],ve=15,er=he({__name:"SearchPanel",props:{report:{},fieldMeta:{}},emits:["matched-pages","page"],setup(r,{emit:e}){const t=r,n=Ft(),s=Vt(n.public.algoliaAppId,n.public.algoliaSearchApiKey).initIndex(n.public.algoliaIndexName),o=k(""),a=k(""),u=k([]),f=k(null),h=T(()=>a.value||o.value||"");fe(()=>{t.fieldMeta.keywords.length&&(o.value=t.fieldMeta.keywords[0])}),be([o,a],([g,y],[p,w])=>{g!==p&&g?a.value="":y!==w&&y&&(o.value="")});function c(g){o.value=g}fe(()=>{h.value&&b()});async function b(){if(!h.value){u.value=[],f.value=null;return}const{hits:g}=await s.search(h.value,{facetFilters:[`company:${t.report.company.id}`,`year:${t.report.year}`],hitsPerPage:100});u.value=g,f.value=null}be(u,g=>{const y=g.map(p=>p.page);e("matched-pages",y)});function I(g){g=g.replace(/\n/g,"");const y=`${h.value||""}`,p=g.indexOf(y),w=y.length+ve;if(p<0)return g.slice(0,w*2);const R=y.length;let L=g.slice(0,p);const A=`${g.slice(p+R,p+R+ve)}...`;if(p>ve)L=`...${g.slice(p-ve,p)}`;else return g.slice(0,w*2)+"...";return`${Se.escape(L)}<b class="underline">${y}</b>${Se.escape(A)}`}async function O(g){f.value===g?e("page",{highlight:"",page:1}):f.value=g,await Ue(),e("page",{highlight:h.value,page:g.page})}function x(g){return g+(t.report.pageOffset||0)}return(g,y)=>(N(),C("div",jt,[d("div",Ht,[d("div",Qt,[(N(!0),C(te,null,ce(g.fieldMeta.keywords,p=>(N(),C("button",{class:Le(["searchPanel__keyword pointer ba b--moon-gray br1",{"searchPanel__keyword--active":p===m(h)}]),key:p,onClick:w=>c(p)},J(p),11,Gt))),128)),H(d("input",{class:"mt1 f6 w-100 searchPanel__input","onUpdate:modelValue":y[0]||(y[0]=p=>nt(a)?a.value=p:null),placeholder:"自訂關鍵字"},null,512),[[Ie,m(a),void 0,{trim:!0}]])])]),H(d("div",Wt,[(N(!0),C(te,null,ce(m(u),p=>(N(),C("div",{class:Le(["flex mv2 dim pointer",{b:p===m(f)}]),key:p.page,onClick:w=>O(p)},[d("div",Xt,"頁"+J(x(p.page)),1),d("div",{class:"pl2",innerHTML:I(p.content)},null,8,Zt)],10,Kt))),128))],512),[[Ee,m(u).length]])]))}});const tr=pe(er,[["__scopeId","data-v-9e94115f"]]),rr=r=>(Ne("data-v-16f4da96"),r=r(),Fe(),r),nr={class:"answerPanel"},ir=["onSubmit"],or={class:"fw5 mb2"},sr={class:"flex items-center mb2"},ar={class:"answerPanel__value flex-auto mr3"},lr=rr(()=>d("span",{class:"f6 mid-gray"}," 數值 ",-1)),ur=["type"],fr={key:1,class:"answerPanel__input pv2"},cr={class:"mr2"},hr={class:"answerPanel__unit flex-none"},_r=["value"],dr={class:"flex mb2"},pr={class:"flex-auto mr3"},mr={class:"answerPanel__answerPage flex-none"},gr={class:"flex justify-between"},wr=["disabled"],De="NA",yr=he({__name:"AnswerPanel",props:{report:{},reportField:{},fieldMeta:{},focusedPage:{}},emits:["next"],setup(r,{emit:e}){const t=r,{feathers:n}=it(),i=k({value:"",unit:"",notes:"",pageIndex:0}),s=T(()=>i.value.notes?!0:i.value.value&&(i.value.unit||!u.value)),o=T(()=>{let x="填寫判讀結果";return i.value.value===De&&(x+=" (已標為無法填答)"),x}),a=new Set(["無",De]),u=T(()=>t.fieldMeta.units?t.fieldMeta.units.some(x=>!a.has(x)):!1),f={number:"number",string:"text",boolean:"radio"},h=T(()=>f[t.fieldMeta.dataType]||"text"),c=T(()=>t.report.pageOffset||0);fe(()=>{t.reportField&&(i.value.value=t.reportField.value||"",i.value.unit=t.reportField.unit||"",i.value.notes=t.reportField.notes||"",t.reportField.pageIndex&&(i.value.pageIndex=t.reportField.pageIndex+c.value))}),fe(()=>{i.value.pageIndex=t.focusedPage+c.value});async function b(x){x={...x,pageIndex:x.pageIndex-c.value},await n.app.service("report-field").patch(t.reportField.id,x),e("next",x)}function I(){b({value:i.value.value.toString(),unit:i.value.unit,notes:i.value.notes,pageIndex:i.value.pageIndex})}function O(){b({value:De,unit:"",notes:i.value.notes,pageIndex:i.value.pageIndex})}return(x,g)=>(N(),C("div",nr,[d("form",{class:"answerPanel__form pb2 bb b--moon-gray",onSubmit:Tt(I,["prevent"])},[d("div",or,J(m(o)),1),d("div",sr,[d("div",ar,[lr,m(h)!=="radio"?H((N(),C("input",{key:0,"onUpdate:modelValue":g[0]||(g[0]=y=>m(i).value=y),type:m(h),class:"answerPanel__input",placeholder:"數值"},null,8,ur)),[[Ot,m(i).value,void 0,{trim:!0}]]):(N(),C("div",fr,[d("label",cr,[H(d("input",{"onUpdate:modelValue":g[1]||(g[1]=y=>m(i).value=y),type:"radio",name:"answerValue",value:"是"},null,512),[[He,m(i).value]]),z(" 是 ")]),d("label",null,[H(d("input",{"onUpdate:modelValue":g[2]||(g[2]=y=>m(i).value=y),type:"radio",name:"answerValue",value:"否"},null,512),[[He,m(i).value]]),z(" 否 ")])]))]),H(d("label",hr,[z(" 單位 "),H(d("select",{"onUpdate:modelValue":g[3]||(g[3]=y=>m(i).unit=y),name:"answerUnit",class:"answerPanel__input"},[(N(!0),C(te,null,ce(x.fieldMeta.units,y=>(N(),C("option",{key:y,value:y},J(y),9,_r))),128))],512),[[Ct,m(i).unit]])],512),[[Ee,m(u)]])]),d("div",dr,[d("label",pr,[z(" 備註 "),H(d("textarea",{"onUpdate:modelValue":g[4]||(g[4]=y=>m(i).notes=y),class:"answerPanel__input mt1",placeholder:"備註"},null,512),[[Ie,m(i).notes,void 0,{trim:!0}]])]),d("label",mr,[z(" 答案頁次 "),H(d("input",{"onUpdate:modelValue":g[5]||(g[5]=y=>m(i).pageIndex=y),type:"number",class:"answerPanel__input mt1"},null,512),[[Ie,m(i).pageIndex]])])]),d("div",gr,[d("button",{type:"button",class:"answerPanel__submit",onClick:O},"無法填答"),d("button",{type:"submit",disabled:!m(s),class:"answerPanel__submit"},"儲存",8,wr)])],40,ir)]))}});const vr=pe(yr,[["__scopeId","data-v-16f4da96"]]);var Qe=typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{},K=[],j=[],xr=typeof Uint8Array<"u"?Uint8Array:Array,qe=!1;function ot(){qe=!0;for(var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e=0,t=r.length;e<t;++e)K[e]=r[e],j[r.charCodeAt(e)]=e;j["-".charCodeAt(0)]=62,j["_".charCodeAt(0)]=63}function br(r){qe||ot();var e,t,n,i,s,o,a=r.length;if(a%4>0)throw new Error("Invalid string. Length must be a multiple of 4");s=r[a-2]==="="?2:r[a-1]==="="?1:0,o=new xr(a*3/4-s),n=s>0?a-4:a;var u=0;for(e=0,t=0;e<n;e+=4,t+=3)i=j[r.charCodeAt(e)]<<18|j[r.charCodeAt(e+1)]<<12|j[r.charCodeAt(e+2)]<<6|j[r.charCodeAt(e+3)],o[u++]=i>>16&255,o[u++]=i>>8&255,o[u++]=i&255;return s===2?(i=j[r.charCodeAt(e)]<<2|j[r.charCodeAt(e+1)]>>4,o[u++]=i&255):s===1&&(i=j[r.charCodeAt(e)]<<10|j[r.charCodeAt(e+1)]<<4|j[r.charCodeAt(e+2)]>>2,o[u++]=i>>8&255,o[u++]=i&255),o}function Ir(r){return K[r>>18&63]+K[r>>12&63]+K[r>>6&63]+K[r&63]}function Er(r,e,t){for(var n,i=[],s=e;s<t;s+=3)n=(r[s]<<16)+(r[s+1]<<8)+r[s+2],i.push(Ir(n));return i.join("")}function Ge(r){qe||ot();for(var e,t=r.length,n=t%3,i="",s=[],o=16383,a=0,u=t-n;a<u;a+=o)s.push(Er(r,a,a+o>u?u:a+o));return n===1?(e=r[t-1],i+=K[e>>2],i+=K[e<<4&63],i+="=="):n===2&&(e=(r[t-2]<<8)+r[t-1],i+=K[e>>10],i+=K[e>>4&63],i+=K[e<<2&63],i+="="),s.push(i),s.join("")}function Oe(r,e,t,n,i){var s,o,a=i*8-n-1,u=(1<<a)-1,f=u>>1,h=-7,c=t?i-1:0,b=t?-1:1,I=r[e+c];for(c+=b,s=I&(1<<-h)-1,I>>=-h,h+=a;h>0;s=s*256+r[e+c],c+=b,h-=8);for(o=s&(1<<-h)-1,s>>=-h,h+=n;h>0;o=o*256+r[e+c],c+=b,h-=8);if(s===0)s=1-f;else{if(s===u)return o?NaN:(I?-1:1)*(1/0);o=o+Math.pow(2,n),s=s-f}return(I?-1:1)*o*Math.pow(2,s-n)}function st(r,e,t,n,i,s){var o,a,u,f=s*8-i-1,h=(1<<f)-1,c=h>>1,b=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,I=n?0:s-1,O=n?1:-1,x=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=h):(o=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-o))<1&&(o--,u*=2),o+c>=1?e+=b/u:e+=b*Math.pow(2,1-c),e*u>=2&&(o++,u/=2),o+c>=h?(a=0,o=h):o+c>=1?(a=(e*u-1)*Math.pow(2,i),o=o+c):(a=e*Math.pow(2,c-1)*Math.pow(2,i),o=0));i>=8;r[t+I]=a&255,I+=O,a/=256,i-=8);for(o=o<<i|a,f+=i;f>0;r[t+I]=o&255,I+=O,o/=256,f-=8);r[t+I-O]|=x*128}var Sr={}.toString,at=Array.isArray||function(r){return Sr.call(r)=="[object Array]"},Ar=50;l.TYPED_ARRAY_SUPPORT=Qe.TYPED_ARRAY_SUPPORT!==void 0?Qe.TYPED_ARRAY_SUPPORT:!0;Ae();function Ae(){return l.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function ee(r,e){if(Ae()<e)throw new RangeError("Invalid typed array length");return l.TYPED_ARRAY_SUPPORT?(r=new Uint8Array(e),r.__proto__=l.prototype):(r===null&&(r=new l(e)),r.length=e),r}function l(r,e,t){if(!l.TYPED_ARRAY_SUPPORT&&!(this instanceof l))return new l(r,e,t);if(typeof r=="number"){if(typeof e=="string")throw new Error("If encoding is specified then the first argument must be a string");return ze(this,r)}return lt(this,r,e,t)}l.poolSize=8192;l._augment=function(r){return r.__proto__=l.prototype,r};function lt(r,e,t,n){if(typeof e=="number")throw new TypeError('"value" argument must not be a number');return typeof ArrayBuffer<"u"&&e instanceof ArrayBuffer?Fr(r,e,t,n):typeof e=="string"?Nr(r,e,t):Or(r,e)}l.from=function(r,e,t){return lt(null,r,e,t)};l.TYPED_ARRAY_SUPPORT&&(l.prototype.__proto__=Uint8Array.prototype,l.__proto__=Uint8Array,typeof Symbol<"u"&&Symbol.species&&l[Symbol.species]);function ut(r){if(typeof r!="number")throw new TypeError('"size" argument must be a number');if(r<0)throw new RangeError('"size" argument must not be negative')}function Rr(r,e,t,n){return ut(e),e<=0?ee(r,e):t!==void 0?typeof n=="string"?ee(r,e).fill(t,n):ee(r,e).fill(t):ee(r,e)}l.alloc=function(r,e,t){return Rr(null,r,e,t)};function ze(r,e){if(ut(e),r=ee(r,e<0?0:Je(e)|0),!l.TYPED_ARRAY_SUPPORT)for(var t=0;t<e;++t)r[t]=0;return r}l.allocUnsafe=function(r){return ze(null,r)};l.allocUnsafeSlow=function(r){return ze(null,r)};function Nr(r,e,t){if((typeof t!="string"||t==="")&&(t="utf8"),!l.isEncoding(t))throw new TypeError('"encoding" must be a valid string encoding');var n=ft(e,t)|0;r=ee(r,n);var i=r.write(e,t);return i!==n&&(r=r.slice(0,i)),r}function Ye(r,e){var t=e.length<0?0:Je(e.length)|0;r=ee(r,t);for(var n=0;n<t;n+=1)r[n]=e[n]&255;return r}function Fr(r,e,t,n){if(e.byteLength,t<0||e.byteLength<t)throw new RangeError("'offset' is out of bounds");if(e.byteLength<t+(n||0))throw new RangeError("'length' is out of bounds");return t===void 0&&n===void 0?e=new Uint8Array(e):n===void 0?e=new Uint8Array(e,t):e=new Uint8Array(e,t,n),l.TYPED_ARRAY_SUPPORT?(r=e,r.__proto__=l.prototype):r=Ye(r,e),r}function Or(r,e){if(X(e)){var t=Je(e.length)|0;return r=ee(r,t),r.length===0||e.copy(r,0,0,t),r}if(e){if(typeof ArrayBuffer<"u"&&e.buffer instanceof ArrayBuffer||"length"in e)return typeof e.length!="number"||Gr(e.length)?ee(r,0):Ye(r,e);if(e.type==="Buffer"&&at(e.data))return Ye(r,e.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function Je(r){if(r>=Ae())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+Ae().toString(16)+" bytes");return r|0}l.isBuffer=Q;function X(r){return!!(r!=null&&r._isBuffer)}l.compare=function(e,t){if(!X(e)||!X(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,i=t.length,s=0,o=Math.min(n,i);s<o;++s)if(e[s]!==t[s]){n=e[s],i=t[s];break}return n<i?-1:i<n?1:0};l.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}};l.concat=function(e,t){if(!at(e))throw new TypeError('"list" argument must be an Array of Buffers');if(e.length===0)return l.alloc(0);var n;if(t===void 0)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var i=l.allocUnsafe(t),s=0;for(n=0;n<e.length;++n){var o=e[n];if(!X(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(i,s),s+=o.length}return i};function ft(r,e){if(X(r))return r.length;if(typeof ArrayBuffer<"u"&&typeof ArrayBuffer.isView=="function"&&(ArrayBuffer.isView(r)||r instanceof ArrayBuffer))return r.byteLength;typeof r!="string"&&(r=""+r);var t=r.length;if(t===0)return 0;for(var n=!1;;)switch(e){case"ascii":case"latin1":case"binary":return t;case"utf8":case"utf-8":case void 0:return Re(r).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return t*2;case"hex":return t>>>1;case"base64":return gt(r).length;default:if(n)return Re(r).length;e=(""+e).toLowerCase(),n=!0}}l.byteLength=ft;function Cr(r,e,t){var n=!1;if((e===void 0||e<0)&&(e=0),e>this.length||((t===void 0||t>this.length)&&(t=this.length),t<=0)||(t>>>=0,e>>>=0,t<=e))return"";for(r||(r="utf8");;)switch(r){case"hex":return Vr(this,e,t);case"utf8":case"utf-8":return _t(this,e,t);case"ascii":return Ur(this,e,t);case"latin1":case"binary":return Br(this,e,t);case"base64":return kr(this,e,t);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Yr(this,e,t);default:if(n)throw new TypeError("Unknown encoding: "+r);r=(r+"").toLowerCase(),n=!0}}l.prototype._isBuffer=!0;function se(r,e,t){var n=r[e];r[e]=r[t],r[t]=n}l.prototype.swap16=function(){var e=this.length;if(e%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)se(this,t,t+1);return this};l.prototype.swap32=function(){var e=this.length;if(e%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)se(this,t,t+3),se(this,t+1,t+2);return this};l.prototype.swap64=function(){var e=this.length;if(e%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)se(this,t,t+7),se(this,t+1,t+6),se(this,t+2,t+5),se(this,t+3,t+4);return this};l.prototype.toString=function(){var e=this.length|0;return e===0?"":arguments.length===0?_t(this,0,e):Cr.apply(this,arguments)};l.prototype.equals=function(e){if(!X(e))throw new TypeError("Argument must be a Buffer");return this===e?!0:l.compare(this,e)===0};l.prototype.inspect=function(){var e="",t=Ar;return this.length>0&&(e=this.toString("hex",0,t).match(/.{2}/g).join(" "),this.length>t&&(e+=" ... ")),"<Buffer "+e+">"};l.prototype.compare=function(e,t,n,i,s){if(!X(e))throw new TypeError("Argument must be a Buffer");if(t===void 0&&(t=0),n===void 0&&(n=e?e.length:0),i===void 0&&(i=0),s===void 0&&(s=this.length),t<0||n>e.length||i<0||s>this.length)throw new RangeError("out of range index");if(i>=s&&t>=n)return 0;if(i>=s)return-1;if(t>=n)return 1;if(t>>>=0,n>>>=0,i>>>=0,s>>>=0,this===e)return 0;for(var o=s-i,a=n-t,u=Math.min(o,a),f=this.slice(i,s),h=e.slice(t,n),c=0;c<u;++c)if(f[c]!==h[c]){o=f[c],a=h[c];break}return o<a?-1:a<o?1:0};function ct(r,e,t,n,i){if(r.length===0)return-1;if(typeof t=="string"?(n=t,t=0):t>2147483647?t=2147483647:t<-2147483648&&(t=-2147483648),t=+t,isNaN(t)&&(t=i?0:r.length-1),t<0&&(t=r.length+t),t>=r.length){if(i)return-1;t=r.length-1}else if(t<0)if(i)t=0;else return-1;if(typeof e=="string"&&(e=l.from(e,n)),X(e))return e.length===0?-1:We(r,e,t,n,i);if(typeof e=="number")return e=e&255,l.TYPED_ARRAY_SUPPORT&&typeof Uint8Array.prototype.indexOf=="function"?i?Uint8Array.prototype.indexOf.call(r,e,t):Uint8Array.prototype.lastIndexOf.call(r,e,t):We(r,[e],t,n,i);throw new TypeError("val must be string, number or Buffer")}function We(r,e,t,n,i){var s=1,o=r.length,a=e.length;if(n!==void 0&&(n=String(n).toLowerCase(),n==="ucs2"||n==="ucs-2"||n==="utf16le"||n==="utf-16le")){if(r.length<2||e.length<2)return-1;s=2,o/=2,a/=2,t/=2}function u(I,O){return s===1?I[O]:I.readUInt16BE(O*s)}var f;if(i){var h=-1;for(f=t;f<o;f++)if(u(r,f)===u(e,h===-1?0:f-h)){if(h===-1&&(h=f),f-h+1===a)return h*s}else h!==-1&&(f-=f-h),h=-1}else for(t+a>o&&(t=o-a),f=t;f>=0;f--){for(var c=!0,b=0;b<a;b++)if(u(r,f+b)!==u(e,b)){c=!1;break}if(c)return f}return-1}l.prototype.includes=function(e,t,n){return this.indexOf(e,t,n)!==-1};l.prototype.indexOf=function(e,t,n){return ct(this,e,t,n,!0)};l.prototype.lastIndexOf=function(e,t,n){return ct(this,e,t,n,!1)};function Tr(r,e,t,n){t=Number(t)||0;var i=r.length-t;n?(n=Number(n),n>i&&(n=i)):n=i;var s=e.length;if(s%2!==0)throw new TypeError("Invalid hex string");n>s/2&&(n=s/2);for(var o=0;o<n;++o){var a=parseInt(e.substr(o*2,2),16);if(isNaN(a))return o;r[t+o]=a}return o}function Pr(r,e,t,n){return Pe(Re(e,r.length-t),r,t,n)}function ht(r,e,t,n){return Pe(Hr(e),r,t,n)}function $r(r,e,t,n){return ht(r,e,t,n)}function Dr(r,e,t,n){return Pe(gt(e),r,t,n)}function Mr(r,e,t,n){return Pe(Qr(e,r.length-t),r,t,n)}l.prototype.write=function(e,t,n,i){if(t===void 0)i="utf8",n=this.length,t=0;else if(n===void 0&&typeof t=="string")i=t,n=this.length,t=0;else if(isFinite(t))t=t|0,isFinite(n)?(n=n|0,i===void 0&&(i="utf8")):(i=n,n=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var s=this.length-t;if((n===void 0||n>s)&&(n=s),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");for(var o=!1;;)switch(i){case"hex":return Tr(this,e,t,n);case"utf8":case"utf-8":return Pr(this,e,t,n);case"ascii":return ht(this,e,t,n);case"latin1":case"binary":return $r(this,e,t,n);case"base64":return Dr(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Mr(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),o=!0}};l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function kr(r,e,t){return e===0&&t===r.length?Ge(r):Ge(r.slice(e,t))}function _t(r,e,t){t=Math.min(r.length,t);for(var n=[],i=e;i<t;){var s=r[i],o=null,a=s>239?4:s>223?3:s>191?2:1;if(i+a<=t){var u,f,h,c;switch(a){case 1:s<128&&(o=s);break;case 2:u=r[i+1],(u&192)===128&&(c=(s&31)<<6|u&63,c>127&&(o=c));break;case 3:u=r[i+1],f=r[i+2],(u&192)===128&&(f&192)===128&&(c=(s&15)<<12|(u&63)<<6|f&63,c>2047&&(c<55296||c>57343)&&(o=c));break;case 4:u=r[i+1],f=r[i+2],h=r[i+3],(u&192)===128&&(f&192)===128&&(h&192)===128&&(c=(s&15)<<18|(u&63)<<12|(f&63)<<6|h&63,c>65535&&c<1114112&&(o=c))}}o===null?(o=65533,a=1):o>65535&&(o-=65536,n.push(o>>>10&1023|55296),o=56320|o&1023),n.push(o),i+=a}return Lr(n)}var Ke=4096;function Lr(r){var e=r.length;if(e<=Ke)return String.fromCharCode.apply(String,r);for(var t="",n=0;n<e;)t+=String.fromCharCode.apply(String,r.slice(n,n+=Ke));return t}function Ur(r,e,t){var n="";t=Math.min(r.length,t);for(var i=e;i<t;++i)n+=String.fromCharCode(r[i]&127);return n}function Br(r,e,t){var n="";t=Math.min(r.length,t);for(var i=e;i<t;++i)n+=String.fromCharCode(r[i]);return n}function Vr(r,e,t){var n=r.length;(!e||e<0)&&(e=0),(!t||t<0||t>n)&&(t=n);for(var i="",s=e;s<t;++s)i+=jr(r[s]);return i}function Yr(r,e,t){for(var n=r.slice(e,t),i="",s=0;s<n.length;s+=2)i+=String.fromCharCode(n[s]+n[s+1]*256);return i}l.prototype.slice=function(e,t){var n=this.length;e=~~e,t=t===void 0?n:~~t,e<0?(e+=n,e<0&&(e=0)):e>n&&(e=n),t<0?(t+=n,t<0&&(t=0)):t>n&&(t=n),t<e&&(t=e);var i;if(l.TYPED_ARRAY_SUPPORT)i=this.subarray(e,t),i.__proto__=l.prototype;else{var s=t-e;i=new l(s,void 0);for(var o=0;o<s;++o)i[o]=this[o+e]}return i};function U(r,e,t){if(r%1!==0||r<0)throw new RangeError("offset is not uint");if(r+e>t)throw new RangeError("Trying to access beyond buffer length")}l.prototype.readUIntLE=function(e,t,n){e=e|0,t=t|0,n||U(e,t,this.length);for(var i=this[e],s=1,o=0;++o<t&&(s*=256);)i+=this[e+o]*s;return i};l.prototype.readUIntBE=function(e,t,n){e=e|0,t=t|0,n||U(e,t,this.length);for(var i=this[e+--t],s=1;t>0&&(s*=256);)i+=this[e+--t]*s;return i};l.prototype.readUInt8=function(e,t){return t||U(e,1,this.length),this[e]};l.prototype.readUInt16LE=function(e,t){return t||U(e,2,this.length),this[e]|this[e+1]<<8};l.prototype.readUInt16BE=function(e,t){return t||U(e,2,this.length),this[e]<<8|this[e+1]};l.prototype.readUInt32LE=function(e,t){return t||U(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+this[e+3]*16777216};l.prototype.readUInt32BE=function(e,t){return t||U(e,4,this.length),this[e]*16777216+(this[e+1]<<16|this[e+2]<<8|this[e+3])};l.prototype.readIntLE=function(e,t,n){e=e|0,t=t|0,n||U(e,t,this.length);for(var i=this[e],s=1,o=0;++o<t&&(s*=256);)i+=this[e+o]*s;return s*=128,i>=s&&(i-=Math.pow(2,8*t)),i};l.prototype.readIntBE=function(e,t,n){e=e|0,t=t|0,n||U(e,t,this.length);for(var i=t,s=1,o=this[e+--i];i>0&&(s*=256);)o+=this[e+--i]*s;return s*=128,o>=s&&(o-=Math.pow(2,8*t)),o};l.prototype.readInt8=function(e,t){return t||U(e,1,this.length),this[e]&128?(255-this[e]+1)*-1:this[e]};l.prototype.readInt16LE=function(e,t){t||U(e,2,this.length);var n=this[e]|this[e+1]<<8;return n&32768?n|4294901760:n};l.prototype.readInt16BE=function(e,t){t||U(e,2,this.length);var n=this[e+1]|this[e]<<8;return n&32768?n|4294901760:n};l.prototype.readInt32LE=function(e,t){return t||U(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24};l.prototype.readInt32BE=function(e,t){return t||U(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]};l.prototype.readFloatLE=function(e,t){return t||U(e,4,this.length),Oe(this,e,!0,23,4)};l.prototype.readFloatBE=function(e,t){return t||U(e,4,this.length),Oe(this,e,!1,23,4)};l.prototype.readDoubleLE=function(e,t){return t||U(e,8,this.length),Oe(this,e,!0,52,8)};l.prototype.readDoubleBE=function(e,t){return t||U(e,8,this.length),Oe(this,e,!1,52,8)};function Y(r,e,t,n,i,s){if(!X(r))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>i||e<s)throw new RangeError('"value" argument is out of bounds');if(t+n>r.length)throw new RangeError("Index out of range")}l.prototype.writeUIntLE=function(e,t,n,i){if(e=+e,t=t|0,n=n|0,!i){var s=Math.pow(2,8*n)-1;Y(this,e,t,n,s,0)}var o=1,a=0;for(this[t]=e&255;++a<n&&(o*=256);)this[t+a]=e/o&255;return t+n};l.prototype.writeUIntBE=function(e,t,n,i){if(e=+e,t=t|0,n=n|0,!i){var s=Math.pow(2,8*n)-1;Y(this,e,t,n,s,0)}var o=n-1,a=1;for(this[t+o]=e&255;--o>=0&&(a*=256);)this[t+o]=e/a&255;return t+n};l.prototype.writeUInt8=function(e,t,n){return e=+e,t=t|0,n||Y(this,e,t,1,255,0),l.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=e&255,t+1};function Ce(r,e,t,n){e<0&&(e=65535+e+1);for(var i=0,s=Math.min(r.length-t,2);i<s;++i)r[t+i]=(e&255<<8*(n?i:1-i))>>>(n?i:1-i)*8}l.prototype.writeUInt16LE=function(e,t,n){return e=+e,t=t|0,n||Y(this,e,t,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[t]=e&255,this[t+1]=e>>>8):Ce(this,e,t,!0),t+2};l.prototype.writeUInt16BE=function(e,t,n){return e=+e,t=t|0,n||Y(this,e,t,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=e&255):Ce(this,e,t,!1),t+2};function Te(r,e,t,n){e<0&&(e=4294967295+e+1);for(var i=0,s=Math.min(r.length-t,4);i<s;++i)r[t+i]=e>>>(n?i:3-i)*8&255}l.prototype.writeUInt32LE=function(e,t,n){return e=+e,t=t|0,n||Y(this,e,t,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=e&255):Te(this,e,t,!0),t+4};l.prototype.writeUInt32BE=function(e,t,n){return e=+e,t=t|0,n||Y(this,e,t,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=e&255):Te(this,e,t,!1),t+4};l.prototype.writeIntLE=function(e,t,n,i){if(e=+e,t=t|0,!i){var s=Math.pow(2,8*n-1);Y(this,e,t,n,s-1,-s)}var o=0,a=1,u=0;for(this[t]=e&255;++o<n&&(a*=256);)e<0&&u===0&&this[t+o-1]!==0&&(u=1),this[t+o]=(e/a>>0)-u&255;return t+n};l.prototype.writeIntBE=function(e,t,n,i){if(e=+e,t=t|0,!i){var s=Math.pow(2,8*n-1);Y(this,e,t,n,s-1,-s)}var o=n-1,a=1,u=0;for(this[t+o]=e&255;--o>=0&&(a*=256);)e<0&&u===0&&this[t+o+1]!==0&&(u=1),this[t+o]=(e/a>>0)-u&255;return t+n};l.prototype.writeInt8=function(e,t,n){return e=+e,t=t|0,n||Y(this,e,t,1,127,-128),l.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=e&255,t+1};l.prototype.writeInt16LE=function(e,t,n){return e=+e,t=t|0,n||Y(this,e,t,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[t]=e&255,this[t+1]=e>>>8):Ce(this,e,t,!0),t+2};l.prototype.writeInt16BE=function(e,t,n){return e=+e,t=t|0,n||Y(this,e,t,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=e&255):Ce(this,e,t,!1),t+2};l.prototype.writeInt32LE=function(e,t,n){return e=+e,t=t|0,n||Y(this,e,t,4,2147483647,-2147483648),l.TYPED_ARRAY_SUPPORT?(this[t]=e&255,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):Te(this,e,t,!0),t+4};l.prototype.writeInt32BE=function(e,t,n){return e=+e,t=t|0,n||Y(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=e&255):Te(this,e,t,!1),t+4};function dt(r,e,t,n,i,s){if(t+n>r.length)throw new RangeError("Index out of range");if(t<0)throw new RangeError("Index out of range")}function pt(r,e,t,n,i){return i||dt(r,e,t,4),st(r,e,t,n,23,4),t+4}l.prototype.writeFloatLE=function(e,t,n){return pt(this,e,t,!0,n)};l.prototype.writeFloatBE=function(e,t,n){return pt(this,e,t,!1,n)};function mt(r,e,t,n,i){return i||dt(r,e,t,8),st(r,e,t,n,52,8),t+8}l.prototype.writeDoubleLE=function(e,t,n){return mt(this,e,t,!0,n)};l.prototype.writeDoubleBE=function(e,t,n){return mt(this,e,t,!1,n)};l.prototype.copy=function(e,t,n,i){if(n||(n=0),!i&&i!==0&&(i=this.length),t>=e.length&&(t=e.length),t||(t=0),i>0&&i<n&&(i=n),i===n||e.length===0||this.length===0)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-t<i-n&&(i=e.length-t+n);var s=i-n,o;if(this===e&&n<t&&t<i)for(o=s-1;o>=0;--o)e[o+t]=this[o+n];else if(s<1e3||!l.TYPED_ARRAY_SUPPORT)for(o=0;o<s;++o)e[o+t]=this[o+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+s),t);return s};l.prototype.fill=function(e,t,n,i){if(typeof e=="string"){if(typeof t=="string"?(i=t,t=0,n=this.length):typeof n=="string"&&(i=n,n=this.length),e.length===1){var s=e.charCodeAt(0);s<256&&(e=s)}if(i!==void 0&&typeof i!="string")throw new TypeError("encoding must be a string");if(typeof i=="string"&&!l.isEncoding(i))throw new TypeError("Unknown encoding: "+i)}else typeof e=="number"&&(e=e&255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;t=t>>>0,n=n===void 0?this.length:n>>>0,e||(e=0);var o;if(typeof e=="number")for(o=t;o<n;++o)this[o]=e;else{var a=X(e)?e:Re(new l(e,i).toString()),u=a.length;for(o=0;o<n-t;++o)this[o+t]=a[o%u]}return this};var qr=/[^+\/0-9A-Za-z-_]/g;function zr(r){if(r=Jr(r).replace(qr,""),r.length<2)return"";for(;r.length%4!==0;)r=r+"=";return r}function Jr(r){return r.trim?r.trim():r.replace(/^\s+|\s+$/g,"")}function jr(r){return r<16?"0"+r.toString(16):r.toString(16)}function Re(r,e){e=e||1/0;for(var t,n=r.length,i=null,s=[],o=0;o<n;++o){if(t=r.charCodeAt(o),t>55295&&t<57344){if(!i){if(t>56319){(e-=3)>-1&&s.push(239,191,189);continue}else if(o+1===n){(e-=3)>-1&&s.push(239,191,189);continue}i=t;continue}if(t<56320){(e-=3)>-1&&s.push(239,191,189),i=t;continue}t=(i-55296<<10|t-56320)+65536}else i&&(e-=3)>-1&&s.push(239,191,189);if(i=null,t<128){if((e-=1)<0)break;s.push(t)}else if(t<2048){if((e-=2)<0)break;s.push(t>>6|192,t&63|128)}else if(t<65536){if((e-=3)<0)break;s.push(t>>12|224,t>>6&63|128,t&63|128)}else if(t<1114112){if((e-=4)<0)break;s.push(t>>18|240,t>>12&63|128,t>>6&63|128,t&63|128)}else throw new Error("Invalid code point")}return s}function Hr(r){for(var e=[],t=0;t<r.length;++t)e.push(r.charCodeAt(t)&255);return e}function Qr(r,e){for(var t,n,i,s=[],o=0;o<r.length&&!((e-=2)<0);++o)t=r.charCodeAt(o),n=t>>8,i=t%256,s.push(i),s.push(n);return s}function gt(r){return br(zr(r))}function Pe(r,e,t,n){for(var i=0;i<n&&!(i+t>=e.length||i>=r.length);++i)e[i+t]=r[i];return i}function Gr(r){return r!==r}function Q(r){return r!=null&&(!!r._isBuffer||wt(r)||Wr(r))}function wt(r){return!!r.constructor&&typeof r.constructor.isBuffer=="function"&&r.constructor.isBuffer(r)}function Wr(r){return typeof r.readFloatLE=="function"&&typeof r.slice=="function"&&wt(r.slice(0,0))}class S extends Error{constructor(e,t,n,...i){Array.isArray(t)&&(t=t.join(" ").trim()),super(t),Error.captureStackTrace!==void 0&&Error.captureStackTrace(this,S),this.code=e;for(const s of i)for(const o in s){const a=s[o];this[o]=Q(a)?a.toString(n.encoding):a==null?a:JSON.parse(JSON.stringify(a))}}}const Kr=function(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)},yt=function(r){const e=[];for(let t=0,n=r.length;t<n;t++){const i=r[t];if(i==null||i===!1)e[t]={disabled:!0};else if(typeof i=="string")e[t]={name:i};else if(Kr(i)){if(typeof i.name!="string")throw new S("CSV_OPTION_COLUMNS_MISSING_NAME",["Option columns missing name:",`property "name" is required at position ${t}`,"when column is an object literal"]);e[t]=i}else throw new S("CSV_INVALID_COLUMN_DEFINITION",["Invalid column definition:","expect a string or a literal object,",`got ${JSON.stringify(i)} at position ${t}`])}return e};class Xe{constructor(e=100){this.size=e,this.length=0,this.buf=l.allocUnsafe(e)}prepend(e){if(Q(e)){const t=this.length+e.length;if(t>=this.size&&(this.resize(),t>=this.size))throw Error("INVALID_BUFFER_STATE");const n=this.buf;this.buf=l.allocUnsafe(this.size),e.copy(this.buf,0),n.copy(this.buf,e.length),this.length+=e.length}else{const t=this.length++;t===this.size&&this.resize();const n=this.clone();this.buf[0]=e,n.copy(this.buf,1,0,t)}}append(e){const t=this.length++;t===this.size&&this.resize(),this.buf[t]=e}clone(){return l.from(this.buf.slice(0,this.length))}resize(){const e=this.length;this.size=this.size*2;const t=l.allocUnsafe(this.size);this.buf.copy(t,0,0,e),this.buf=t}toString(e){return e?this.buf.slice(0,this.length).toString(e):Uint8Array.prototype.slice.call(this.buf.slice(0,this.length))}toJSON(){return this.toString("utf8")}reset(){this.length=0}}const Xr=12,Zr=13,en=10,tn=32,rn=9,nn=function(r){return{bomSkipped:!1,bufBytesStart:0,castField:r.cast_function,commenting:!1,error:void 0,enabled:r.from_line===1,escaping:!1,escapeIsQuote:Q(r.escape)&&Q(r.quote)&&l.compare(r.escape,r.quote)===0,expectedRecordLength:Array.isArray(r.columns)?r.columns.length:void 0,field:new Xe(20),firstLineToHeaders:r.cast_first_line_to_header,needMoreDataSize:Math.max(r.comment!==null?r.comment.length:0,...r.delimiter.map(e=>e.length),r.quote!==null?r.quote.length:0),previousBuf:void 0,quoting:!1,stop:!1,rawBuffer:new Xe(100),record:[],recordHasError:!1,record_length:0,recordDelimiterMaxLength:r.record_delimiter.length===0?0:Math.max(...r.record_delimiter.map(e=>e.length)),trimChars:[l.from(" ",r.encoding)[0],l.from("	",r.encoding)[0]],wasQuoting:!1,wasRowDelimiter:!1,timchars:[l.from(l.from([Zr],"utf8").toString(),r.encoding),l.from(l.from([en],"utf8").toString(),r.encoding),l.from(l.from([Xr],"utf8").toString(),r.encoding),l.from(l.from([tn],"utf8").toString(),r.encoding),l.from(l.from([rn],"utf8").toString(),r.encoding)]}},on=function(r){return r.replace(/([A-Z])/g,function(e,t){return"_"+t.toLowerCase()})},Ze=function(r){const e={};for(const n in r)e[on(n)]=r[n];if(e.encoding===void 0||e.encoding===!0)e.encoding="utf8";else if(e.encoding===null||e.encoding===!1)e.encoding=null;else if(typeof e.encoding!="string"&&e.encoding!==null)throw new S("CSV_INVALID_OPTION_ENCODING",["Invalid option encoding:","encoding must be a string or null to return a buffer,",`got ${JSON.stringify(e.encoding)}`],e);if(e.bom===void 0||e.bom===null||e.bom===!1)e.bom=!1;else if(e.bom!==!0)throw new S("CSV_INVALID_OPTION_BOM",["Invalid option bom:","bom must be true,",`got ${JSON.stringify(e.bom)}`],e);if(e.cast_function=null,e.cast===void 0||e.cast===null||e.cast===!1||e.cast==="")e.cast=void 0;else if(typeof e.cast=="function")e.cast_function=e.cast,e.cast=!0;else if(e.cast!==!0)throw new S("CSV_INVALID_OPTION_CAST",["Invalid option cast:","cast must be true or a function,",`got ${JSON.stringify(e.cast)}`],e);if(e.cast_date===void 0||e.cast_date===null||e.cast_date===!1||e.cast_date==="")e.cast_date=!1;else if(e.cast_date===!0)e.cast_date=function(n){const i=Date.parse(n);return isNaN(i)?n:new Date(i)};else if(typeof e.cast_date!="function")throw new S("CSV_INVALID_OPTION_CAST_DATE",["Invalid option cast_date:","cast_date must be true or a function,",`got ${JSON.stringify(e.cast_date)}`],e);if(e.cast_first_line_to_header=null,e.columns===!0)e.cast_first_line_to_header=void 0;else if(typeof e.columns=="function")e.cast_first_line_to_header=e.columns,e.columns=!0;else if(Array.isArray(e.columns))e.columns=yt(e.columns);else if(e.columns===void 0||e.columns===null||e.columns===!1)e.columns=!1;else throw new S("CSV_INVALID_OPTION_COLUMNS",["Invalid option columns:","expect an array, a function or true,",`got ${JSON.stringify(e.columns)}`],e);if(e.group_columns_by_name===void 0||e.group_columns_by_name===null||e.group_columns_by_name===!1)e.group_columns_by_name=!1;else{if(e.group_columns_by_name!==!0)throw new S("CSV_INVALID_OPTION_GROUP_COLUMNS_BY_NAME",["Invalid option group_columns_by_name:","expect an boolean,",`got ${JSON.stringify(e.group_columns_by_name)}`],e);if(e.columns===!1)throw new S("CSV_INVALID_OPTION_GROUP_COLUMNS_BY_NAME",["Invalid option group_columns_by_name:","the `columns` mode must be activated."],e)}if(e.comment===void 0||e.comment===null||e.comment===!1||e.comment==="")e.comment=null;else if(typeof e.comment=="string"&&(e.comment=l.from(e.comment,e.encoding)),!Q(e.comment))throw new S("CSV_INVALID_OPTION_COMMENT",["Invalid option comment:","comment must be a buffer or a string,",`got ${JSON.stringify(e.comment)}`],e);if(e.comment_no_infix===void 0||e.comment_no_infix===null||e.comment_no_infix===!1)e.comment_no_infix=!1;else if(e.comment_no_infix!==!0)throw new S("CSV_INVALID_OPTION_COMMENT",["Invalid option comment_no_infix:","value must be a boolean,",`got ${JSON.stringify(e.comment_no_infix)}`],e);const t=JSON.stringify(e.delimiter);if(Array.isArray(e.delimiter)||(e.delimiter=[e.delimiter]),e.delimiter.length===0)throw new S("CSV_INVALID_OPTION_DELIMITER",["Invalid option delimiter:","delimiter must be a non empty string or buffer or array of string|buffer,",`got ${t}`],e);if(e.delimiter=e.delimiter.map(function(n){if(n==null||n===!1)return l.from(",",e.encoding);if(typeof n=="string"&&(n=l.from(n,e.encoding)),!Q(n)||n.length===0)throw new S("CSV_INVALID_OPTION_DELIMITER",["Invalid option delimiter:","delimiter must be a non empty string or buffer or array of string|buffer,",`got ${t}`],e);return n}),e.escape===void 0||e.escape===!0?e.escape=l.from('"',e.encoding):typeof e.escape=="string"?e.escape=l.from(e.escape,e.encoding):(e.escape===null||e.escape===!1)&&(e.escape=null),e.escape!==null&&!Q(e.escape))throw new Error(`Invalid Option: escape must be a buffer, a string or a boolean, got ${JSON.stringify(e.escape)}`);if(e.from===void 0||e.from===null)e.from=1;else if(typeof e.from=="string"&&/\d+/.test(e.from)&&(e.from=parseInt(e.from)),Number.isInteger(e.from)){if(e.from<0)throw new Error(`Invalid Option: from must be a positive integer, got ${JSON.stringify(r.from)}`)}else throw new Error(`Invalid Option: from must be an integer, got ${JSON.stringify(e.from)}`);if(e.from_line===void 0||e.from_line===null)e.from_line=1;else if(typeof e.from_line=="string"&&/\d+/.test(e.from_line)&&(e.from_line=parseInt(e.from_line)),Number.isInteger(e.from_line)){if(e.from_line<=0)throw new Error(`Invalid Option: from_line must be a positive integer greater than 0, got ${JSON.stringify(r.from_line)}`)}else throw new Error(`Invalid Option: from_line must be an integer, got ${JSON.stringify(r.from_line)}`);if(e.ignore_last_delimiters===void 0||e.ignore_last_delimiters===null)e.ignore_last_delimiters=!1;else if(typeof e.ignore_last_delimiters=="number")e.ignore_last_delimiters=Math.floor(e.ignore_last_delimiters),e.ignore_last_delimiters===0&&(e.ignore_last_delimiters=!1);else if(typeof e.ignore_last_delimiters!="boolean")throw new S("CSV_INVALID_OPTION_IGNORE_LAST_DELIMITERS",["Invalid option `ignore_last_delimiters`:","the value must be a boolean value or an integer,",`got ${JSON.stringify(e.ignore_last_delimiters)}`],e);if(e.ignore_last_delimiters===!0&&e.columns===!1)throw new S("CSV_IGNORE_LAST_DELIMITERS_REQUIRES_COLUMNS",["The option `ignore_last_delimiters`","requires the activation of the `columns` option"],e);if(e.info===void 0||e.info===null||e.info===!1)e.info=!1;else if(e.info!==!0)throw new Error(`Invalid Option: info must be true, got ${JSON.stringify(e.info)}`);if(e.max_record_size===void 0||e.max_record_size===null||e.max_record_size===!1)e.max_record_size=0;else if(!(Number.isInteger(e.max_record_size)&&e.max_record_size>=0))if(typeof e.max_record_size=="string"&&/\d+/.test(e.max_record_size))e.max_record_size=parseInt(e.max_record_size);else throw new Error(`Invalid Option: max_record_size must be a positive integer, got ${JSON.stringify(e.max_record_size)}`);if(e.objname===void 0||e.objname===null||e.objname===!1)e.objname=void 0;else if(Q(e.objname)){if(e.objname.length===0)throw new Error("Invalid Option: objname must be a non empty buffer");e.encoding===null||(e.objname=e.objname.toString(e.encoding))}else if(typeof e.objname=="string"){if(e.objname.length===0)throw new Error("Invalid Option: objname must be a non empty string")}else if(typeof e.objname!="number")throw new Error(`Invalid Option: objname must be a string or a buffer, got ${e.objname}`);if(e.objname!==void 0){if(typeof e.objname=="number"){if(e.columns!==!1)throw Error("Invalid Option: objname index cannot be combined with columns or be defined as a field")}else if(e.columns===!1)throw Error("Invalid Option: objname field must be combined with columns or be defined as an index")}if(e.on_record===void 0||e.on_record===null)e.on_record=void 0;else if(typeof e.on_record!="function")throw new S("CSV_INVALID_OPTION_ON_RECORD",["Invalid option `on_record`:","expect a function,",`got ${JSON.stringify(e.on_record)}`],e);if(e.quote===null||e.quote===!1||e.quote==="")e.quote=null;else if(e.quote===void 0||e.quote===!0?e.quote=l.from('"',e.encoding):typeof e.quote=="string"&&(e.quote=l.from(e.quote,e.encoding)),!Q(e.quote))throw new Error(`Invalid Option: quote must be a buffer or a string, got ${JSON.stringify(e.quote)}`);if(e.raw===void 0||e.raw===null||e.raw===!1)e.raw=!1;else if(e.raw!==!0)throw new Error(`Invalid Option: raw must be true, got ${JSON.stringify(e.raw)}`);if(e.record_delimiter===void 0)e.record_delimiter=[];else if(typeof e.record_delimiter=="string"||Q(e.record_delimiter)){if(e.record_delimiter.length===0)throw new S("CSV_INVALID_OPTION_RECORD_DELIMITER",["Invalid option `record_delimiter`:","value must be a non empty string or buffer,",`got ${JSON.stringify(e.record_delimiter)}`],e);e.record_delimiter=[e.record_delimiter]}else if(!Array.isArray(e.record_delimiter))throw new S("CSV_INVALID_OPTION_RECORD_DELIMITER",["Invalid option `record_delimiter`:","value must be a string, a buffer or array of string|buffer,",`got ${JSON.stringify(e.record_delimiter)}`],e);if(e.record_delimiter=e.record_delimiter.map(function(n,i){if(typeof n!="string"&&!Q(n))throw new S("CSV_INVALID_OPTION_RECORD_DELIMITER",["Invalid option `record_delimiter`:","value must be a string, a buffer or array of string|buffer",`at index ${i},`,`got ${JSON.stringify(n)}`],e);if(n.length===0)throw new S("CSV_INVALID_OPTION_RECORD_DELIMITER",["Invalid option `record_delimiter`:","value must be a non empty string or buffer",`at index ${i},`,`got ${JSON.stringify(n)}`],e);return typeof n=="string"&&(n=l.from(n,e.encoding)),n}),typeof e.relax_column_count!="boolean")if(e.relax_column_count===void 0||e.relax_column_count===null)e.relax_column_count=!1;else throw new Error(`Invalid Option: relax_column_count must be a boolean, got ${JSON.stringify(e.relax_column_count)}`);if(typeof e.relax_column_count_less!="boolean")if(e.relax_column_count_less===void 0||e.relax_column_count_less===null)e.relax_column_count_less=!1;else throw new Error(`Invalid Option: relax_column_count_less must be a boolean, got ${JSON.stringify(e.relax_column_count_less)}`);if(typeof e.relax_column_count_more!="boolean")if(e.relax_column_count_more===void 0||e.relax_column_count_more===null)e.relax_column_count_more=!1;else throw new Error(`Invalid Option: relax_column_count_more must be a boolean, got ${JSON.stringify(e.relax_column_count_more)}`);if(typeof e.relax_quotes!="boolean")if(e.relax_quotes===void 0||e.relax_quotes===null)e.relax_quotes=!1;else throw new Error(`Invalid Option: relax_quotes must be a boolean, got ${JSON.stringify(e.relax_quotes)}`);if(typeof e.skip_empty_lines!="boolean")if(e.skip_empty_lines===void 0||e.skip_empty_lines===null)e.skip_empty_lines=!1;else throw new Error(`Invalid Option: skip_empty_lines must be a boolean, got ${JSON.stringify(e.skip_empty_lines)}`);if(typeof e.skip_records_with_empty_values!="boolean")if(e.skip_records_with_empty_values===void 0||e.skip_records_with_empty_values===null)e.skip_records_with_empty_values=!1;else throw new Error(`Invalid Option: skip_records_with_empty_values must be a boolean, got ${JSON.stringify(e.skip_records_with_empty_values)}`);if(typeof e.skip_records_with_error!="boolean")if(e.skip_records_with_error===void 0||e.skip_records_with_error===null)e.skip_records_with_error=!1;else throw new Error(`Invalid Option: skip_records_with_error must be a boolean, got ${JSON.stringify(e.skip_records_with_error)}`);if(e.rtrim===void 0||e.rtrim===null||e.rtrim===!1)e.rtrim=!1;else if(e.rtrim!==!0)throw new Error(`Invalid Option: rtrim must be a boolean, got ${JSON.stringify(e.rtrim)}`);if(e.ltrim===void 0||e.ltrim===null||e.ltrim===!1)e.ltrim=!1;else if(e.ltrim!==!0)throw new Error(`Invalid Option: ltrim must be a boolean, got ${JSON.stringify(e.ltrim)}`);if(e.trim===void 0||e.trim===null||e.trim===!1)e.trim=!1;else if(e.trim!==!0)throw new Error(`Invalid Option: trim must be a boolean, got ${JSON.stringify(e.trim)}`);if(e.trim===!0&&r.ltrim!==!1?e.ltrim=!0:e.ltrim!==!0&&(e.ltrim=!1),e.trim===!0&&r.rtrim!==!1?e.rtrim=!0:e.rtrim!==!0&&(e.rtrim=!1),e.to===void 0||e.to===null)e.to=-1;else if(typeof e.to=="string"&&/\d+/.test(e.to)&&(e.to=parseInt(e.to)),Number.isInteger(e.to)){if(e.to<=0)throw new Error(`Invalid Option: to must be a positive integer greater than 0, got ${JSON.stringify(r.to)}`)}else throw new Error(`Invalid Option: to must be an integer, got ${JSON.stringify(r.to)}`);if(e.to_line===void 0||e.to_line===null)e.to_line=-1;else if(typeof e.to_line=="string"&&/\d+/.test(e.to_line)&&(e.to_line=parseInt(e.to_line)),Number.isInteger(e.to_line)){if(e.to_line<=0)throw new Error(`Invalid Option: to_line must be a positive integer greater than 0, got ${JSON.stringify(r.to_line)}`)}else throw new Error(`Invalid Option: to_line must be an integer, got ${JSON.stringify(r.to_line)}`);return e},et=function(r){return r.every(e=>e==null||e.toString&&e.toString().trim()==="")},sn=13,an=10,ue={utf8:l.from([239,187,191]),utf16le:l.from([255,254])},ln=function(r={}){const e={bytes:0,comment_lines:0,empty_lines:0,invalid_field_length:0,lines:1,records:0},t=Ze(r);return{info:e,original_options:r,options:t,state:nn(t),__needMoreData:function(n,i,s){if(s)return!1;const{encoding:o,escape:a,quote:u}=this.options,{quoting:f,needMoreDataSize:h,recordDelimiterMaxLength:c}=this.state,b=i-n-1,I=Math.max(h,c===0?l.from(`\r
`,o).length:c,f?(a===null?0:a.length)+u.length:0,f?u.length+c:0);return b<I},parse:function(n,i,s,o){const{bom:a,comment_no_infix:u,encoding:f,from_line:h,ltrim:c,max_record_size:b,raw:I,relax_quotes:O,rtrim:x,skip_empty_lines:g,to:y,to_line:p}=this.options;let{comment:w,escape:R,quote:L,record_delimiter:A}=this.options;const{bomSkipped:Z,previousBuf:re,rawBuffer:ae,escapeIsQuote:we}=this.state;let E;if(re===void 0)if(n===void 0){o();return}else E=n;else re!==void 0&&n===void 0?E=re:E=l.concat([re,n]);if(Z===!1)if(a===!1)this.state.bomSkipped=!0;else if(E.length<3){if(i===!1){this.state.previousBuf=E;return}}else{for(const P in ue)if(ue[P].compare(E,0,ue[P].length)===0){const G=ue[P].length;this.state.bufBytesStart+=G,E=E.slice(G),this.options=Ze({...this.original_options,encoding:P}),{comment:w,escape:R,quote:L}=this.options;break}this.state.bomSkipped=!0}const ne=E.length;let v;for(v=0;v<ne&&!this.__needMoreData(v,ne,i);v++){if(this.state.wasRowDelimiter===!0&&(this.info.lines++,this.state.wasRowDelimiter=!1),p!==-1&&this.info.lines>p){this.state.stop=!0,o();return}this.state.quoting===!1&&A.length===0&&this.__autoDiscoverRecordDelimiter(E,v)&&(A=this.options.record_delimiter);const P=E[v];if(I===!0&&ae.append(P),(P===sn||P===an)&&this.state.wasRowDelimiter===!1&&(this.state.wasRowDelimiter=!0),this.state.escaping===!0)this.state.escaping=!1;else{if(R!==null&&this.state.quoting===!0&&this.__isEscape(E,v,P)&&v+R.length<ne)if(we){if(this.__isQuote(E,v+R.length)){this.state.escaping=!0,v+=R.length-1;continue}}else{this.state.escaping=!0,v+=R.length-1;continue}if(this.state.commenting===!1&&this.__isQuote(E,v))if(this.state.quoting===!0){const $=E[v+L.length],ie=x&&this.__isCharTrimable(E,v+L.length),W=w!==null&&this.__compareBytes(w,E,v+L.length,$),B=this.__isDelimiter(E,v+L.length,$),le=A.length===0?this.__autoDiscoverRecordDelimiter(E,v+L.length):this.__isRecordDelimiter($,E,v+L.length);if(R!==null&&this.__isEscape(E,v,P)&&this.__isQuote(E,v+R.length))v+=R.length-1;else if(!$||B||le||W||ie){this.state.quoting=!1,this.state.wasQuoting=!0,v+=L.length-1;continue}else if(O===!1){const oe=this.__error(new S("CSV_INVALID_CLOSING_QUOTE",["Invalid Closing Quote:",`got "${String.fromCharCode($)}"`,`at line ${this.info.lines}`,"instead of delimiter, record delimiter, trimable character","(if activated) or comment"],this.options,this.__infoField()));if(oe!==void 0)return oe}else this.state.quoting=!1,this.state.wasQuoting=!0,this.state.field.prepend(L),v+=L.length-1}else if(this.state.field.length!==0){if(O===!1){const $=this.__infoField(),ie=Object.keys(ue).map(B=>ue[B].equals(this.state.field.toString())?B:!1).filter(Boolean)[0],W=this.__error(new S("INVALID_OPENING_QUOTE",["Invalid Opening Quote:",`a quote is found on field ${JSON.stringify($.column)} at line ${$.lines}, value is ${JSON.stringify(this.state.field.toString(f))}`,ie?`(${ie} bom)`:void 0],this.options,$,{field:this.state.field}));if(W!==void 0)return W}}else{this.state.quoting=!0,v+=L.length-1;continue}if(this.state.quoting===!1){const $=this.__isRecordDelimiter(P,E,v);if($!==0){if(this.state.commenting&&this.state.wasQuoting===!1&&this.state.record.length===0&&this.state.field.length===0)this.info.comment_lines++;else{if(this.state.enabled===!1&&this.info.lines+(this.state.wasRowDelimiter===!0?1:0)>=h){this.state.enabled=!0,this.__resetField(),this.__resetRecord(),v+=$-1;continue}if(g===!0&&this.state.wasQuoting===!1&&this.state.record.length===0&&this.state.field.length===0){this.info.empty_lines++,v+=$-1;continue}this.info.bytes=this.state.bufBytesStart+v;const le=this.__onField();if(le!==void 0)return le;this.info.bytes=this.state.bufBytesStart+v+$;const oe=this.__onRecord(s);if(oe!==void 0)return oe;if(y!==-1&&this.info.records>=y){this.state.stop=!0,o();return}}this.state.commenting=!1,v+=$-1;continue}if(this.state.commenting)continue;if((w===null?0:this.__compareBytes(w,E,v,P))!==0&&(u===!1||this.state.field.length===0)){this.state.commenting=!0;continue}const W=this.__isDelimiter(E,v,P);if(W!==0){this.info.bytes=this.state.bufBytesStart+v;const B=this.__onField();if(B!==void 0)return B;v+=W-1;continue}}}if(this.state.commenting===!1&&b!==0&&this.state.record_length+this.state.field.length>b)return this.__error(new S("CSV_MAX_RECORD_SIZE",["Max Record Size:","record exceed the maximum number of tolerated bytes",`of ${b}`,`at line ${this.info.lines}`],this.options,this.__infoField()));const G=c===!1||this.state.quoting===!0||this.state.field.length!==0||!this.__isCharTrimable(E,v),$e=x===!1||this.state.wasQuoting===!1;if(G===!0&&$e===!0)this.state.field.append(P);else{if(x===!0&&!this.__isCharTrimable(E,v))return this.__error(new S("CSV_NON_TRIMABLE_CHAR_AFTER_CLOSING_QUOTE",["Invalid Closing Quote:","found non trimable byte after quote",`at line ${this.info.lines}`],this.options,this.__infoField()));G===!1&&(v+=this.__isCharTrimable(E,v)-1);continue}}if(i===!0)if(this.state.quoting===!0){const P=this.__error(new S("CSV_QUOTE_NOT_CLOSED",["Quote Not Closed:",`the parsing is finished with an opening quote at line ${this.info.lines}`],this.options,this.__infoField()));if(P!==void 0)return P}else if(this.state.wasQuoting===!0||this.state.record.length!==0||this.state.field.length!==0){this.info.bytes=this.state.bufBytesStart+v;const P=this.__onField();if(P!==void 0)return P;const G=this.__onRecord(s);if(G!==void 0)return G}else this.state.wasRowDelimiter===!0?this.info.empty_lines++:this.state.commenting===!0&&this.info.comment_lines++;else this.state.bufBytesStart+=v,this.state.previousBuf=E.slice(v);this.state.wasRowDelimiter===!0&&(this.info.lines++,this.state.wasRowDelimiter=!1)},__onRecord:function(n){const{columns:i,group_columns_by_name:s,encoding:o,info:a,from:u,relax_column_count:f,relax_column_count_less:h,relax_column_count_more:c,raw:b,skip_records_with_empty_values:I}=this.options,{enabled:O,record:x}=this.state;if(O===!1)return this.__resetRecord();const g=x.length;if(i===!0){if(I===!0&&et(x)){this.__resetRecord();return}return this.__firstLineToColumns(x)}if(i===!1&&this.info.records===0&&(this.state.expectedRecordLength=g),g!==this.state.expectedRecordLength){const y=i===!1?new S("CSV_RECORD_INCONSISTENT_FIELDS_LENGTH",["Invalid Record Length:",`expect ${this.state.expectedRecordLength},`,`got ${g} on line ${this.info.lines}`],this.options,this.__infoField(),{record:x}):new S("CSV_RECORD_INCONSISTENT_COLUMNS",["Invalid Record Length:",`columns length is ${i.length},`,`got ${g} on line ${this.info.lines}`],this.options,this.__infoField(),{record:x});if(f===!0||h===!0&&g<this.state.expectedRecordLength||c===!0&&g>this.state.expectedRecordLength)this.info.invalid_field_length++,this.state.error=y;else{const p=this.__error(y);if(p)return p}}if(I===!0&&et(x)){this.__resetRecord();return}if(this.state.recordHasError===!0){this.__resetRecord(),this.state.recordHasError=!1;return}if(this.info.records++,u===1||this.info.records>=u){const{objname:y}=this.options;if(i!==!1){const p={};for(let w=0,R=x.length;w<R;w++)i[w]===void 0||i[w].disabled||(s===!0&&p[i[w].name]!==void 0?Array.isArray(p[i[w].name])?p[i[w].name]=p[i[w].name].concat(x[w]):p[i[w].name]=[p[i[w].name],x[w]]:p[i[w].name]=x[w]);if(b===!0||a===!0){const w=Object.assign({record:p},b===!0?{raw:this.state.rawBuffer.toString(o)}:{},a===!0?{info:this.__infoRecord()}:{}),R=this.__push(y===void 0?w:[p[y],w],n);if(R)return R}else{const w=this.__push(y===void 0?p:[p[y],p],n);if(w)return w}}else if(b===!0||a===!0){const p=Object.assign({record:x},b===!0?{raw:this.state.rawBuffer.toString(o)}:{},a===!0?{info:this.__infoRecord()}:{}),w=this.__push(y===void 0?p:[x[y],p],n);if(w)return w}else{const p=this.__push(y===void 0?x:[x[y],x],n);if(p)return p}}this.__resetRecord()},__firstLineToColumns:function(n){const{firstLineToHeaders:i}=this.state;try{const s=i===void 0?n:i.call(null,n);if(!Array.isArray(s))return this.__error(new S("CSV_INVALID_COLUMN_MAPPING",["Invalid Column Mapping:","expect an array from column function,",`got ${JSON.stringify(s)}`],this.options,this.__infoField(),{headers:s}));const o=yt(s);this.state.expectedRecordLength=o.length,this.options.columns=o,this.__resetRecord();return}catch(s){return s}},__resetRecord:function(){this.options.raw===!0&&this.state.rawBuffer.reset(),this.state.error=void 0,this.state.record=[],this.state.record_length=0},__onField:function(){const{cast:n,encoding:i,rtrim:s,max_record_size:o}=this.options,{enabled:a,wasQuoting:u}=this.state;if(a===!1)return this.__resetField();let f=this.state.field.toString(i);if(s===!0&&u===!1&&(f=f.trimRight()),n===!0){const[h,c]=this.__cast(f);if(h!==void 0)return h;f=c}this.state.record.push(f),o!==0&&typeof f=="string"&&(this.state.record_length+=f.length),this.__resetField()},__resetField:function(){this.state.field.reset(),this.state.wasQuoting=!1},__push:function(n,i){const{on_record:s}=this.options;if(s!==void 0){const o=this.__infoRecord();try{n=s.call(null,n,o)}catch(a){return a}if(n==null)return}i(n)},__cast:function(n){const{columns:i,relax_column_count:s}=this.options;if(Array.isArray(i)===!0&&s&&this.options.columns.length<=this.state.record.length)return[void 0,void 0];if(this.state.castField!==null)try{const a=this.__infoField();return[void 0,this.state.castField.call(null,n,a)]}catch(a){return[a]}if(this.__isFloat(n))return[void 0,parseFloat(n)];if(this.options.cast_date!==!1){const a=this.__infoField();return[void 0,this.options.cast_date.call(null,n,a)]}return[void 0,n]},__isCharTrimable:function(n,i){return((o,a)=>{const{timchars:u}=this.state;e:for(let f=0;f<u.length;f++){const h=u[f];for(let c=0;c<h.length;c++)if(h[c]!==o[a+c])continue e;return h.length}return 0})(n,i)},__isFloat:function(n){return n-parseFloat(n)+1>=0},__compareBytes:function(n,i,s,o){if(n[0]!==o)return 0;const a=n.length;for(let u=1;u<a;u++)if(n[u]!==i[s+u])return 0;return a},__isDelimiter:function(n,i,s){const{delimiter:o,ignore_last_delimiters:a}=this.options;if(a===!0&&this.state.record.length===this.options.columns.length-1)return 0;if(a!==!1&&typeof a=="number"&&this.state.record.length===a-1)return 0;e:for(let u=0;u<o.length;u++){const f=o[u];if(f[0]===s){for(let h=1;h<f.length;h++)if(f[h]!==n[i+h])continue e;return f.length}}return 0},__isRecordDelimiter:function(n,i,s){const{record_delimiter:o}=this.options,a=o.length;e:for(let u=0;u<a;u++){const f=o[u],h=f.length;if(f[0]===n){for(let c=1;c<h;c++)if(f[c]!==i[s+c])continue e;return f.length}}return 0},__isEscape:function(n,i,s){const{escape:o}=this.options;if(o===null)return!1;const a=o.length;if(o[0]===s){for(let u=0;u<a;u++)if(o[u]!==n[i+u])return!1;return!0}return!1},__isQuote:function(n,i){const{quote:s}=this.options;if(s===null)return!1;const o=s.length;for(let a=0;a<o;a++)if(s[a]!==n[i+a])return!1;return!0},__autoDiscoverRecordDelimiter:function(n,i){const{encoding:s}=this.options,o=[l.from(`\r
`,s),l.from(`
`,s),l.from("\r",s)];e:for(let a=0;a<o.length;a++){const u=o[a].length;for(let f=0;f<u;f++)if(o[a][f]!==n[i+f])continue e;return this.options.record_delimiter.push(o[a]),this.state.recordDelimiterMaxLength=o[a].length,o[a].length}return 0},__error:function(n){const{encoding:i,raw:s,skip_records_with_error:o}=this.options,a=typeof n=="string"?new Error(n):n;if(o){this.state.recordHasError=!0,this.options.on_skip!==void 0&&this.options.on_skip(a,s?this.state.rawBuffer.toString(i):void 0);return}else return a},__infoDataSet:function(){return{...this.info,columns:this.options.columns}},__infoRecord:function(){const{columns:n,raw:i,encoding:s}=this.options;return{...this.__infoDataSet(),error:this.state.error,header:n===!0,index:this.state.record.length,raw:i?this.state.rawBuffer.toString(s):void 0}},__infoField:function(){const{columns:n}=this.options,i=Array.isArray(n);return{...this.__infoRecord(),column:i===!0?n.length>this.state.record.length?n[this.state.record.length].name:null:this.state.record.length,quoting:this.state.wasQuoting}}}},un=function(r,e={}){typeof r=="string"&&(r=l.from(r));const t=e&&e.objname?{}:[],n=ln(e),i=u=>{n.options.objname===void 0?t.push(u):t[u[0]]=u[1]},s=()=>{},o=n.parse(r,!1,i,s);if(o!==void 0)throw o;const a=n.parse(void 0,!0,i,s);if(a!==void 0)throw a;return t},vt=r=>(Ne("data-v-ad49a8ca"),r=r(),Fe(),r),fn={class:"verifyPanel"},cn={class:"fw5 mb2"},hn=vt(()=>d("div",{class:"verifyPanel__head bb b--moon-gray pb1 mb1"},"年度",-1)),_n=vt(()=>d("div",{class:"verifyPanel__head"},"數值",-1)),dn="https://thaubing-esg.gcaa.org.tw/content/company/",pn=5,mn=he({__name:"VerifyPanel",props:{report:{},reportField:{},fieldMeta:{}},setup(r){const e=r,t=T(()=>i.value.length?"歷史資料":"無歷史資料"),n=xe(),i=T(()=>{const u=e.fieldMeta.historyColumnName;return!u||!n.value?[]:n.value.filter(f=>u===f.項目).map(f=>({year:f.年份,value:f.數值})).sort((f,h)=>f.year-h.year).slice(-pn)}),s=T(()=>({gridTemplateColumns:`1fr repeat(${i.value.length}, 2fr)`}));async function o(){const u=e.report.company.abbreviation,f=`${dn}${u}.csv`,c=await(await fetch(f)).text();n.value=un(c,{columns:!0,skip_empty_lines:!0})}function a(u){return e.fieldMeta.dataType==="number"?Number.parseFloat(u).toLocaleString():u.toLocaleString()}return fe(()=>{o()}),(u,f)=>(N(),C("div",fn,[d("div",cn,J(m(t)),1),m(i).length?(N(),C("div",{key:0,class:"verifyPanel__table f6 pb3 relative",style:Be(m(s))},[hn,(N(!0),C(te,null,ce(m(i),h=>(N(),C("div",{key:h.year,class:"verifyPanel__cell bb b--moon-gray pb1 ph1 mb1"},J(h.year),1))),128)),_n,(N(!0),C(te,null,ce(m(i),h=>(N(),C("div",{key:h.year,class:"verifyPanel__cell ph1"},J(a(h.value)),1))),128))],4)):de("",!0)]))}});const gn=pe(mn,[["__scopeId","data-v-ad49a8ca"]]),me=r=>(Ne("data-v-2e64c4fb"),r=r(),Fe(),r),wn={class:"editorControl"},yn={class:"ph3"},vn=me(()=>d("i",{class:"fa-solid fa-arrow-left mr1"},null,-1)),xn={class:"editorControl__keepTop mt2 pv2 ph3 mb2 bb b--moon-gray"},bn={class:"fw6 f4 mv0 black"},In={class:"ph3"},En={class:"gray f6 mt0 pb2 mb3 bb b--moon-gray lh-copy"},Sn={class:"editorControl__keywordSection pb2 mb3"},An=me(()=>d("div",{class:"editorControl__keepMiddle fw5 mb1"},"相關關鍵字",-1)),Rn=me(()=>d("div",{class:"f6 gray"},"點選以下關鍵字，或是自行輸入，就能搜出相關頁面",-1)),Nn={class:"editorControl__keepBottom pb3 pt2 ph3 bt b--moon-gray shadow-1"},Fn={class:"flex justify-end"},On=me(()=>d("i",{class:"fa-solid fa-eye ml2 f7"},null,-1)),Cn=me(()=>d("i",{class:"fa-solid fa-eye-slash ml2 f7"},null,-1)),Tn={class:"mt2"},Pn={class:"mt3"},$n=he({__name:"EditorControl",props:{report:{},reportField:{},fieldMeta:{},focusedPage:{}},emits:["page","matched-pages","next","prev","report-field"],setup(r,{emit:e}){const t=r,n=T(()=>({name:"profession-report-reportId",params:{reportId:t.report.id}}));function i(c){e("matched-pages",c)}function s(c){e("page",c)}const o=k(!1);function a(){o.value=!o.value}function u(c){e("report-field",c),f()}function f(){e("next")}function h(){e("prev")}return(c,b)=>{const I=Nt,O=tr,x=vr,g=gn;return N(),C("div",wn,[d("div",yn,[_e(I,{class:"flex f6 gray items-center no-underline dim pt3",to:m(n)},{default:Pt(()=>[vn,z(J(c.report.company.abbreviation)+" "+J(c.report.year)+" 報告書",1)]),_:1},8,["to"])]),d("div",xn,[d("h1",bn,J(c.fieldMeta.name),1)]),d("div",In,[d("p",En,J(c.fieldMeta.description),1),d("div",{class:"flex justify-between items-center mb3 mt2 pb3 bb b--moon-gray"},[d("button",{class:"editorControl__nav",onClick:h},"往上個欄位"),d("button",{class:"editorControl__nav",onClick:f},"往下個欄位")]),d("div",Sn,[An,Rn,_e(O,{report:c.report,"field-meta":c.fieldMeta,onMatchedPages:i,onPage:s},null,8,["report","field-meta"])])]),d("div",Nn,[d("div",Fn,[d("button",{class:"pv1 ph3 ba bg-white pointer f6 gray flex items-baseline",onClick:a},[m(o)?(N(),C(te,{key:0},[z("展開填答 x 驗證區"),On],64)):(N(),C(te,{key:1},[z("收合填答 x 驗證區"),Cn],64))])]),H(d("div",Tn,[_e(x,{report:c.report,"report-field":c.reportField,"field-meta":c.fieldMeta,"focused-page":c.focusedPage,onNext:u},null,8,["report","report-field","field-meta","focused-page"])],512),[[Ee,!m(o)]]),H(d("div",Pn,[_e(g,{report:c.report,"report-field":c.reportField,"field-meta":c.fieldMeta},null,8,["report","report-field","field-meta"])],512),[[Ee,!m(o)]])])])}}});const Dn=pe($n,[["__scopeId","data-v-2e64c4fb"]]),ge=r=>(Ne("data-v-4cbb17ec"),r=r(),Fe(),r),Mn={class:"reportViewer"},kn={class:"reportViewer__control pr2"},Ln={class:"bb b--moon-gray flex items-center justify-between pv2"},Un={class:"flex items-center pl3"},Bn=ge(()=>d("i",{class:"fa-solid fa-plus"},null,-1)),Vn=ge(()=>d("i",{class:"fa-solid fa-minus"},null,-1)),Yn=ge(()=>d("i",{class:"fa-solid fa-arrows-left-right"},null,-1)),qn=ge(()=>d("i",{class:"fa-solid fa-arrows-up-down"},null,-1)),zn={key:0,class:"reportViewer__content w-100"},Jn=["onClick"],jn=ge(()=>d("div",{class:"flex items-center justify-center h-100 f3 fw6"},[d("div",{class:"reportViewer__maskLabel pv3 ph4 br2"},"設定為第一頁")],-1)),Hn=[jn],Me="https://cdn.jsdelivr.net/npm/pdfjs-dist@3.9.179",Qn="https://gcaa-static.s3.ap-northeast-3.amazonaws.com/company-report-toolkit",ke=10,Gn=100,Wn=60,tt=.1,rt=100,Kn=he({__name:"PdfViewer",props:{page:{default:1},year:{default:2019},report:{},highlight:{default:""},matchedPages:{default(){return[]}}},emits:["view-page","page","reload"],setup(r,{emit:e}){const t=r,{feathers:n}=it();$t({link:[{rel:"stylesheet",href:`${Me}/web/pdf_viewer.css`}]});const i=k(!1),s=k(void 0),o=k([]),a=k(0),u=xe({}),f=k([null]),h=k(1),c=k(1),b=T({get(){return c.value+(t.report.pageOffset||0)},set(_){const F=Number.parseInt(_,10)-(t.report.pageOffset||0);oe(F)}}),I=T(()=>{const _=t.report.pageOffset||0;return _?`${t.report.totalPages+_} + ${Math.abs(_)}`:t.report.totalPages}),O=k(!1),x=()=>{O.value=!O.value},g=T(()=>O.value?"取消設定報告第一頁":"頁次對不上？點此調整");async function y(_){const F=1-_;await n.app.service("report").patch(t.report.id,{pageOffset:F}),e("reload"),O.value=!1}const p=k("fit-width"),w=k({pdfSize:{width:0,height:0},widthScale:0,heightScale:0,customScale:0}),R=T(()=>{if(!w.value.widthScale||!W.value)return null;let _=1;switch(p.value){case"custom":_=w.value.customScale;break;case"fit-height":_=w.value.heightScale;break;case"fit-width":default:_=w.value.widthScale}return _=_||1,{scale:_,width:w.value.pdfSize.width*_,height:w.value.pdfSize.height*_}});Dt(()=>{ae()}),Mt(()=>{clearTimeout(s.value)});const L=T(()=>f.value[0]&&R.value),A=T(()=>`${Qn}/${t.year}/${t.report.company.id}`),Z=T(()=>t.highlight+"");function re(){return!!window&&!!window.pdfjsLib&&!!window.pdfjsViewer}function ae(){s.value=setTimeout(async()=>{const _=re();_?(window.pdfjsLib.GlobalWorkerOptions.workerSrc=`${Me}/build/pdf.worker.js`,await Ue()):ae(),i.value=_},Gn)}async function we(_){const F=window.pdfjsLib,D=`${Me}/cmaps/`,q=_%ke||ke,M=$e(_);u.value[M]||(u.value[M]=F.getDocument({url:`${A.value}/${M}.pdf`,cMapUrl:D,cMapPacked:!0,enableXfa:!0}));const V=await u.value[M].promise;return E(V),{document:V,page:q}}async function E(_){if(w.value.widthScale)return;const F=await _.getPage(1),{width:D,height:q}=F.getViewport({scale:1});w.value.pdfSize={width:D,height:q};const M=B.value,V=M.clientWidth,ye=M.clientHeight,At=Number.parseInt(getComputedStyle(M).paddingLeft),Rt=V-At*2;w.value.widthScale=Rt/D,w.value.heightScale=ye/q}const ne=T(()=>{var _,F;return R.value?{width:`${(_=R.value)==null?void 0:_.width}px`,height:`${(F=R.value)==null?void 0:F.height}px`}:{}}),v=T(()=>ne.value.height?{...ne.value,marginTop:`-${ne.value.height}`}:{});async function P(){const _=await we(1);f.value[0]={pdf:xe(_)}}function G(){u.value={},f.value=Array(t.report.totalPages).fill(null),p.value="fit-width",w.value.widthScale=0}fe(()=>{!A.value||!i.value||!W.value||(G(),P())});function $e(_){return`${Math.ceil(_/ke)}`.padStart(3,"0")}async function $(_,{forceLoad:F=!1,anchor:D=0}={}){if(!F&&o.value.length){o.value.includes(_)||o.value.unshift(_);return}const q=_-1;if(q>=f.value.length)throw new Error(`Invalid page number: ${_}`);if(F||(o.value.push(_),D&&(a.value=D)),!f.value[q]){const M=await we(_);f.value[q]={pdf:xe(M),highlight:t.matchedPages.includes(_)?Z.value:""}}o.value.pop(),o.value.length?$(o.value[0],{forceLoad:!0}):setTimeout(()=>{a.value=0},rt)}const ie=Se.debounce(_=>{$(_)},100),W=Yt(),B=k(null);function le(_){const D=B.value.querySelectorAll(".reportViewer__page")[_-1];return D==null?void 0:D.offsetTop}function oe(_){_<1||_>t.report.totalPages||Number.isNaN(_)||(je(_),e("page",_))}async function je(_){const F=le(_),D=$(_,{anchor:F});_>1&&$(_-1),_<t.report.totalPages&&$(_+1),F&&B.value.scrollTo({top:F}),await D,c.value=_}be(()=>t.page,async()=>{await je(t.page)});function xt(){var _;w.value.customScale=(((_=R.value)==null?void 0:_.scale)||1)*(1+tt),p.value="custom"}function bt(){var _;w.value.customScale=(((_=R.value)==null?void 0:_.scale)||1)*(1-tt),p.value="custom"}function It(){p.value="fit-width"}function Et(){p.value="fit-height"}be(R,async(_,F)=>{if(!_||!F||!B.value)return;const D=B.value,q=D.clientHeight/2,M=(D.scrollTop+q)/D.scrollHeight;await Ue();const V=D.scrollHeight*M-q;a.value=V,setTimeout(()=>{a.value=0},rt)});const St=Se.debounce(_=>{_!==h.value&&(c.value=h.value,h.value=_,e("view-page",c.value))},Wn);return(_,F)=>{const D=qt,q=zt;return N(),C("div",Mn,[d("div",kn,[d("div",Ln,[d("div",Un,[H(d("input",{class:"reportViewer__pageInput b--moon-gray ba ph1 mr1","onUpdate:modelValue":F[0]||(F[0]=M=>nt(b)?b.value=M:null),onKeyup:F[1]||(F[1]=kt(M=>M.target.blur(),["enter"]))},null,544),[[Ie,m(b),void 0,{lazy:!0}]]),z("頁 / 共 "+J(m(I))+" 頁",1),d("button",{class:"reportViewer__button ml2 gray",onClick:x},J(m(g)),1)]),d("div",{class:"flex items-center"},[d("button",{class:"reportViewer__button",onClick:xt},[Bn,z("放大")]),d("button",{class:"reportViewer__button",onClick:bt},[Vn,z("縮小")]),d("button",{class:"reportViewer__button",onClick:It},[Yn,z("滿頁寬")]),d("button",{class:"reportViewer__button",onClick:Et},[qn,z("滿頁高")])])])]),d("div",{class:"reportViewer__scrollContainer relative",ref_key:"scrollerEle",ref:B},[m(L)?(N(),C("div",zn,[(N(!0),C(te,null,ce(m(f),(M,V)=>(N(),C(te,{key:V},[M?(N(),Ve(q,Lt({key:1,class:"reportViewer__page"},M.pdf,{class:[`thePage--${V+1}`],highlight:M.highlight,"page-anchor":m(a),scale:m(R).scale,onVisible:ye=>m(St)(V+1)}),null,16,["class","highlight","page-anchor","scale","onVisible"])):(N(),Ve(D,{key:0,class:Le(["reportViewer__page",[`theEmpty--${V+1}`]]),style:Be(m(ne)),"page-number":V+1,onVisible:ye=>m(ie)(V+1)},null,8,["style","class","page-number","onVisible"])),m(O)?(N(),C("div",{key:2,class:"reportViewer__page reportViewer__page--mask center pointer",style:Be(m(v)),onClick:ye=>y(V+1)},Hn,12,Jn)):de("",!0)],64))),128))])):de("",!0)],512)])}}});const Xn=pe(Kn,[["__scopeId","data-v-4cbb17ec"]]),Zn={key:0,class:"editor"},ei={class:"editor__viewer"},ai=he({__name:"[reportId]",setup(r){const e=Ut(),t=T(()=>Number.parseInt(e.params.reportId)),{report:n,reportFieldList:i,isDataReady:s,meta:o}=Jt(t.value),a=T(()=>Number.parseInt(e.query.fieldId)),u=T(()=>i.value.find(Z=>Z.id===a.value)||i.value[0]);function f(A){Object.keys(A).forEach(Z=>{u.value[Z]=A[Z]})}const h=T(()=>o(u.value)),c=k({page:1,highlight:""}),b=k([]),I=k(0);function O(A){I.value=A}function x(A){c.value=A}function g(A){b.value=A}const y=Bt(),p=T(()=>i.value.findIndex(A=>A.id===a.value));function w(){let A=p.value+1;A===i.value.length&&(A=0),y.push({name:"profession-editor-reportId",params:{reportId:t.value},query:{fieldId:i.value[A].id}})}function R(){let A=p.value-1;A<0&&(A=i.value.length-1),y.push({name:"profession-editor-reportId",params:{reportId:t.value},query:{fieldId:i.value[A].id}})}function L(){window.location.reload()}return(A,Z)=>{const re=Dn,ae=Xn;return m(s)?(N(),C("div",Zn,[_e(re,{class:"editor__control br b--moon-gray",report:m(n),"report-field":m(u),"field-meta":m(h),"focused-page":m(I),onPage:x,onMatchedPages:g,onNext:w,onPrev:R,onReportField:f},null,8,["report","report-field","field-meta","focused-page"]),d("div",ei,[m(c)?(N(),Ve(ae,{key:0,year:m(n).year,report:m(n),page:m(c).page,highlight:m(c).highlight,"matched-pages":m(b),onViewPage:O,onReload:L},null,8,["year","report","page","highlight","matched-pages"])):de("",!0)])])):de("",!0)}}});export{ai as default};
