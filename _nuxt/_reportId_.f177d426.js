import{_ as $t}from"./nuxt-link.8e976574.js";import{f as pe,r as M,h as T,B as ke,z as _e,o as O,c as F,a as _,F as te,y as le,C as Me,i as g,t as V,q as X,v as me,s as at,D as ze,m as Dt,A as Ue,_ as we,E as Ie,J as Be,j as ue,p as Ne,e as Re,l as lt,M as Lt,N as We,d as Q,O as kt,x as Mt,b as ge,w as Ut,L as ut,u as Bt,G as Vt,H as Yt,I as Ve,K as zt,g as qt,P as Jt}from"./entry.7ae34011.js";import{_ as Ee,w as jt,a as Ht}from"./lodash.fb727903.js";import{a as Qt,c as Gt,d as Wt,u as Kt,_ as Xt,b as Zt}from"./SinglePdfPage.8bca785b.js";import{u as qe}from"./useProfessionApi.ecf8385f.js";import{u as en}from"./useReport.a607039e.js";const tn={class:"searchPanel"},nn={class:"flex mt2"},rn={class:"flex flex-wrap"},on=["onClick"],sn={class:"f6 dark-gray mv1"},an=["onClick"],ln={class:"flex-none dark-gray"},un=["innerHTML"],be=15,fn=pe({__name:"SearchPanel",props:{report:{},fieldMeta:{}},emits:["matched-pages","page"],setup(n,{emit:e}){const t=n,r=Dt(),o=Qt(r.public.algoliaAppId,r.public.algoliaSearchApiKey).initIndex(r.public.algoliaIndexName),s=M(""),a=M(""),u=M([]),c=M(null),d=T(()=>a.value||s.value||"");ke(()=>{t.fieldMeta.keywords.length&&(s.value=t.fieldMeta.keywords[0])}),_e([s,a],([v,S],[w,I])=>{v!==w&&v?a.value="":S!==I&&S&&(s.value="")});function f(v){s.value=v}ke(()=>{d.value&&m()});async function m(){if(!d.value){u.value=[],c.value=null;return}const{hits:v}=await o.search(d.value,{facetFilters:[`company:${t.report.company.id}`,`year:${t.report.year}`],hitsPerPage:100});u.value=v.filter(S=>S.page<=t.report.totalPages),c.value=null}_e(u,v=>{const S=v.map(w=>w.page);e("matched-pages",S)});function p(v){v=v.replace(/\n/g,"");const S=`${d.value||""}`,w=v.indexOf(S),I=S.length+be;if(w<0)return v.slice(0,I*2);const $=S.length;let y=v.slice(0,w);const N=`${v.slice(w+$,w+$+be)}...`;if(w>be)y=`...${v.slice(w-be,w)}`;else return v.slice(0,I*2)+"...";return`${Ee.escape(y)}<b class="underline">${S}</b>${Ee.escape(N)}`}async function E(v){c.value===v?e("page",{highlight:"",page:1}):c.value=v,await Ue(),e("page",{highlight:d.value,page:v.page})}function A(v){return v+(t.report.pageOffset||0)}return(v,S)=>(O(),F("div",tn,[_("div",nn,[_("div",rn,[(O(!0),F(te,null,le(v.fieldMeta.keywords,w=>(O(),F("button",{class:Me(["searchPanel__keyword pointer ba b--moon-gray br1",{"searchPanel__keyword--active":w===g(d)}]),key:w,onClick:I=>f(w)},V(w),11,on))),128)),X(_("input",{class:"mt1 f6 w-100 searchPanel__input","onUpdate:modelValue":S[0]||(S[0]=w=>at(a)?a.value=w:null),placeholder:"自訂關鍵字"},null,512),[[me,g(a),void 0,{trim:!0}]])])]),X(_("div",sn,[(O(!0),F(te,null,le(g(u),w=>(O(),F("div",{class:Me(["flex mv2 dim pointer",{b:w===g(c)}]),key:w.page,onClick:I=>E(w)},[_("div",ln,"頁"+V(A(w.page)),1),_("div",{class:"pl2",innerHTML:p(w.content)},null,8,un)],10,an))),128))],512),[[ze,g(u).length]])]))}});const cn=we(fn,[["__scopeId","data-v-009febed"]]);var Ke=typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{},ee=[],K=[],dn=typeof Uint8Array<"u"?Uint8Array:Array,Je=!1;function ft(){Je=!0;for(var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e=0,t=n.length;e<t;++e)ee[e]=n[e],K[n.charCodeAt(e)]=e;K["-".charCodeAt(0)]=62,K["_".charCodeAt(0)]=63}function hn(n){Je||ft();var e,t,r,i,o,s,a=n.length;if(a%4>0)throw new Error("Invalid string. Length must be a multiple of 4");o=n[a-2]==="="?2:n[a-1]==="="?1:0,s=new dn(a*3/4-o),r=o>0?a-4:a;var u=0;for(e=0,t=0;e<r;e+=4,t+=3)i=K[n.charCodeAt(e)]<<18|K[n.charCodeAt(e+1)]<<12|K[n.charCodeAt(e+2)]<<6|K[n.charCodeAt(e+3)],s[u++]=i>>16&255,s[u++]=i>>8&255,s[u++]=i&255;return o===2?(i=K[n.charCodeAt(e)]<<2|K[n.charCodeAt(e+1)]>>4,s[u++]=i&255):o===1&&(i=K[n.charCodeAt(e)]<<10|K[n.charCodeAt(e+1)]<<4|K[n.charCodeAt(e+2)]>>2,s[u++]=i>>8&255,s[u++]=i&255),s}function _n(n){return ee[n>>18&63]+ee[n>>12&63]+ee[n>>6&63]+ee[n&63]}function pn(n,e,t){for(var r,i=[],o=e;o<t;o+=3)r=(n[o]<<16)+(n[o+1]<<8)+n[o+2],i.push(_n(r));return i.join("")}function Xe(n){Je||ft();for(var e,t=n.length,r=t%3,i="",o=[],s=16383,a=0,u=t-r;a<u;a+=s)o.push(pn(n,a,a+s>u?u:a+s));return r===1?(e=n[t-1],i+=ee[e>>2],i+=ee[e<<4&63],i+="=="):r===2&&(e=(n[t-2]<<8)+n[t-1],i+=ee[e>>10],i+=ee[e>>4&63],i+=ee[e<<2&63],i+="="),o.push(i),o.join("")}function Oe(n,e,t,r,i){var o,s,a=i*8-r-1,u=(1<<a)-1,c=u>>1,d=-7,f=t?i-1:0,m=t?-1:1,p=n[e+f];for(f+=m,o=p&(1<<-d)-1,p>>=-d,d+=a;d>0;o=o*256+n[e+f],f+=m,d-=8);for(s=o&(1<<-d)-1,o>>=-d,d+=r;d>0;s=s*256+n[e+f],f+=m,d-=8);if(o===0)o=1-c;else{if(o===u)return s?NaN:(p?-1:1)*(1/0);s=s+Math.pow(2,r),o=o-c}return(p?-1:1)*s*Math.pow(2,o-r)}function ct(n,e,t,r,i,o){var s,a,u,c=o*8-i-1,d=(1<<c)-1,f=d>>1,m=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:o-1,E=r?1:-1,A=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=d):(s=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-s))<1&&(s--,u*=2),s+f>=1?e+=m/u:e+=m*Math.pow(2,1-f),e*u>=2&&(s++,u/=2),s+f>=d?(a=0,s=d):s+f>=1?(a=(e*u-1)*Math.pow(2,i),s=s+f):(a=e*Math.pow(2,f-1)*Math.pow(2,i),s=0));i>=8;n[t+p]=a&255,p+=E,a/=256,i-=8);for(s=s<<i|a,c+=i;c>0;n[t+p]=s&255,p+=E,s/=256,c-=8);n[t+p-E]|=A*128}var mn={}.toString,dt=Array.isArray||function(n){return mn.call(n)=="[object Array]"},gn=50;l.TYPED_ARRAY_SUPPORT=Ke.TYPED_ARRAY_SUPPORT!==void 0?Ke.TYPED_ARRAY_SUPPORT:!0;Se();function Se(){return l.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function ie(n,e){if(Se()<e)throw new RangeError("Invalid typed array length");return l.TYPED_ARRAY_SUPPORT?(n=new Uint8Array(e),n.__proto__=l.prototype):(n===null&&(n=new l(e)),n.length=e),n}function l(n,e,t){if(!l.TYPED_ARRAY_SUPPORT&&!(this instanceof l))return new l(n,e,t);if(typeof n=="number"){if(typeof e=="string")throw new Error("If encoding is specified then the first argument must be a string");return je(this,n)}return ht(this,n,e,t)}l.poolSize=8192;l._augment=function(n){return n.__proto__=l.prototype,n};function ht(n,e,t,r){if(typeof e=="number")throw new TypeError('"value" argument must not be a number');return typeof ArrayBuffer<"u"&&e instanceof ArrayBuffer?vn(n,e,t,r):typeof e=="string"?yn(n,e,t):xn(n,e)}l.from=function(n,e,t){return ht(null,n,e,t)};l.TYPED_ARRAY_SUPPORT&&(l.prototype.__proto__=Uint8Array.prototype,l.__proto__=Uint8Array,typeof Symbol<"u"&&Symbol.species&&l[Symbol.species]);function _t(n){if(typeof n!="number")throw new TypeError('"size" argument must be a number');if(n<0)throw new RangeError('"size" argument must not be negative')}function wn(n,e,t,r){return _t(e),e<=0?ie(n,e):t!==void 0?typeof r=="string"?ie(n,e).fill(t,r):ie(n,e).fill(t):ie(n,e)}l.alloc=function(n,e,t){return wn(null,n,e,t)};function je(n,e){if(_t(e),n=ie(n,e<0?0:He(e)|0),!l.TYPED_ARRAY_SUPPORT)for(var t=0;t<e;++t)n[t]=0;return n}l.allocUnsafe=function(n){return je(null,n)};l.allocUnsafeSlow=function(n){return je(null,n)};function yn(n,e,t){if((typeof t!="string"||t==="")&&(t="utf8"),!l.isEncoding(t))throw new TypeError('"encoding" must be a valid string encoding');var r=pt(e,t)|0;n=ie(n,r);var i=n.write(e,t);return i!==r&&(n=n.slice(0,i)),n}function Ye(n,e){var t=e.length<0?0:He(e.length)|0;n=ie(n,t);for(var r=0;r<t;r+=1)n[r]=e[r]&255;return n}function vn(n,e,t,r){if(e.byteLength,t<0||e.byteLength<t)throw new RangeError("'offset' is out of bounds");if(e.byteLength<t+(r||0))throw new RangeError("'length' is out of bounds");return t===void 0&&r===void 0?e=new Uint8Array(e):r===void 0?e=new Uint8Array(e,t):e=new Uint8Array(e,t,r),l.TYPED_ARRAY_SUPPORT?(n=e,n.__proto__=l.prototype):n=Ye(n,e),n}function xn(n,e){if(ne(e)){var t=He(e.length)|0;return n=ie(n,t),n.length===0||e.copy(n,0,0,t),n}if(e){if(typeof ArrayBuffer<"u"&&e.buffer instanceof ArrayBuffer||"length"in e)return typeof e.length!="number"||Bn(e.length)?ie(n,0):Ye(n,e);if(e.type==="Buffer"&&dt(e.data))return Ye(n,e.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function He(n){if(n>=Se())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+Se().toString(16)+" bytes");return n|0}l.isBuffer=Z;function ne(n){return!!(n!=null&&n._isBuffer)}l.compare=function(e,t){if(!ne(e)||!ne(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var r=e.length,i=t.length,o=0,s=Math.min(r,i);o<s;++o)if(e[o]!==t[o]){r=e[o],i=t[o];break}return r<i?-1:i<r?1:0};l.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}};l.concat=function(e,t){if(!dt(e))throw new TypeError('"list" argument must be an Array of Buffers');if(e.length===0)return l.alloc(0);var r;if(t===void 0)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var i=l.allocUnsafe(t),o=0;for(r=0;r<e.length;++r){var s=e[r];if(!ne(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(i,o),o+=s.length}return i};function pt(n,e){if(ne(n))return n.length;if(typeof ArrayBuffer<"u"&&typeof ArrayBuffer.isView=="function"&&(ArrayBuffer.isView(n)||n instanceof ArrayBuffer))return n.byteLength;typeof n!="string"&&(n=""+n);var t=n.length;if(t===0)return 0;for(var r=!1;;)switch(e){case"ascii":case"latin1":case"binary":return t;case"utf8":case"utf-8":case void 0:return Ae(n).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return t*2;case"hex":return t>>>1;case"base64":return bt(n).length;default:if(r)return Ae(n).length;e=(""+e).toLowerCase(),r=!0}}l.byteLength=pt;function bn(n,e,t){var r=!1;if((e===void 0||e<0)&&(e=0),e>this.length||((t===void 0||t>this.length)&&(t=this.length),t<=0)||(t>>>=0,e>>>=0,t<=e))return"";for(n||(n="utf8");;)switch(n){case"hex":return Pn(this,e,t);case"utf8":case"utf-8":return wt(this,e,t);case"ascii":return Fn(this,e,t);case"latin1":case"binary":return Cn(this,e,t);case"base64":return Rn(this,e,t);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Tn(this,e,t);default:if(r)throw new TypeError("Unknown encoding: "+n);n=(n+"").toLowerCase(),r=!0}}l.prototype._isBuffer=!0;function ae(n,e,t){var r=n[e];n[e]=n[t],n[t]=r}l.prototype.swap16=function(){var e=this.length;if(e%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)ae(this,t,t+1);return this};l.prototype.swap32=function(){var e=this.length;if(e%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)ae(this,t,t+3),ae(this,t+1,t+2);return this};l.prototype.swap64=function(){var e=this.length;if(e%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)ae(this,t,t+7),ae(this,t+1,t+6),ae(this,t+2,t+5),ae(this,t+3,t+4);return this};l.prototype.toString=function(){var e=this.length|0;return e===0?"":arguments.length===0?wt(this,0,e):bn.apply(this,arguments)};l.prototype.equals=function(e){if(!ne(e))throw new TypeError("Argument must be a Buffer");return this===e?!0:l.compare(this,e)===0};l.prototype.inspect=function(){var e="",t=gn;return this.length>0&&(e=this.toString("hex",0,t).match(/.{2}/g).join(" "),this.length>t&&(e+=" ... ")),"<Buffer "+e+">"};l.prototype.compare=function(e,t,r,i,o){if(!ne(e))throw new TypeError("Argument must be a Buffer");if(t===void 0&&(t=0),r===void 0&&(r=e?e.length:0),i===void 0&&(i=0),o===void 0&&(o=this.length),t<0||r>e.length||i<0||o>this.length)throw new RangeError("out of range index");if(i>=o&&t>=r)return 0;if(i>=o)return-1;if(t>=r)return 1;if(t>>>=0,r>>>=0,i>>>=0,o>>>=0,this===e)return 0;for(var s=o-i,a=r-t,u=Math.min(s,a),c=this.slice(i,o),d=e.slice(t,r),f=0;f<u;++f)if(c[f]!==d[f]){s=c[f],a=d[f];break}return s<a?-1:a<s?1:0};function mt(n,e,t,r,i){if(n.length===0)return-1;if(typeof t=="string"?(r=t,t=0):t>2147483647?t=2147483647:t<-2147483648&&(t=-2147483648),t=+t,isNaN(t)&&(t=i?0:n.length-1),t<0&&(t=n.length+t),t>=n.length){if(i)return-1;t=n.length-1}else if(t<0)if(i)t=0;else return-1;if(typeof e=="string"&&(e=l.from(e,r)),ne(e))return e.length===0?-1:Ze(n,e,t,r,i);if(typeof e=="number")return e=e&255,l.TYPED_ARRAY_SUPPORT&&typeof Uint8Array.prototype.indexOf=="function"?i?Uint8Array.prototype.indexOf.call(n,e,t):Uint8Array.prototype.lastIndexOf.call(n,e,t):Ze(n,[e],t,r,i);throw new TypeError("val must be string, number or Buffer")}function Ze(n,e,t,r,i){var o=1,s=n.length,a=e.length;if(r!==void 0&&(r=String(r).toLowerCase(),r==="ucs2"||r==="ucs-2"||r==="utf16le"||r==="utf-16le")){if(n.length<2||e.length<2)return-1;o=2,s/=2,a/=2,t/=2}function u(p,E){return o===1?p[E]:p.readUInt16BE(E*o)}var c;if(i){var d=-1;for(c=t;c<s;c++)if(u(n,c)===u(e,d===-1?0:c-d)){if(d===-1&&(d=c),c-d+1===a)return d*o}else d!==-1&&(c-=c-d),d=-1}else for(t+a>s&&(t=s-a),c=t;c>=0;c--){for(var f=!0,m=0;m<a;m++)if(u(n,c+m)!==u(e,m)){f=!1;break}if(f)return c}return-1}l.prototype.includes=function(e,t,r){return this.indexOf(e,t,r)!==-1};l.prototype.indexOf=function(e,t,r){return mt(this,e,t,r,!0)};l.prototype.lastIndexOf=function(e,t,r){return mt(this,e,t,r,!1)};function In(n,e,t,r){t=Number(t)||0;var i=n.length-t;r?(r=Number(r),r>i&&(r=i)):r=i;var o=e.length;if(o%2!==0)throw new TypeError("Invalid hex string");r>o/2&&(r=o/2);for(var s=0;s<r;++s){var a=parseInt(e.substr(s*2,2),16);if(isNaN(a))return s;n[t+s]=a}return s}function En(n,e,t,r){return Pe(Ae(e,n.length-t),n,t,r)}function gt(n,e,t,r){return Pe(Mn(e),n,t,r)}function Sn(n,e,t,r){return gt(n,e,t,r)}function An(n,e,t,r){return Pe(bt(e),n,t,r)}function Nn(n,e,t,r){return Pe(Un(e,n.length-t),n,t,r)}l.prototype.write=function(e,t,r,i){if(t===void 0)i="utf8",r=this.length,t=0;else if(r===void 0&&typeof t=="string")i=t,r=this.length,t=0;else if(isFinite(t))t=t|0,isFinite(r)?(r=r|0,i===void 0&&(i="utf8")):(i=r,r=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var o=this.length-t;if((r===void 0||r>o)&&(r=o),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");for(var s=!1;;)switch(i){case"hex":return In(this,e,t,r);case"utf8":case"utf-8":return En(this,e,t,r);case"ascii":return gt(this,e,t,r);case"latin1":case"binary":return Sn(this,e,t,r);case"base64":return An(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Nn(this,e,t,r);default:if(s)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),s=!0}};l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function Rn(n,e,t){return e===0&&t===n.length?Xe(n):Xe(n.slice(e,t))}function wt(n,e,t){t=Math.min(n.length,t);for(var r=[],i=e;i<t;){var o=n[i],s=null,a=o>239?4:o>223?3:o>191?2:1;if(i+a<=t){var u,c,d,f;switch(a){case 1:o<128&&(s=o);break;case 2:u=n[i+1],(u&192)===128&&(f=(o&31)<<6|u&63,f>127&&(s=f));break;case 3:u=n[i+1],c=n[i+2],(u&192)===128&&(c&192)===128&&(f=(o&15)<<12|(u&63)<<6|c&63,f>2047&&(f<55296||f>57343)&&(s=f));break;case 4:u=n[i+1],c=n[i+2],d=n[i+3],(u&192)===128&&(c&192)===128&&(d&192)===128&&(f=(o&15)<<18|(u&63)<<12|(c&63)<<6|d&63,f>65535&&f<1114112&&(s=f))}}s===null?(s=65533,a=1):s>65535&&(s-=65536,r.push(s>>>10&1023|55296),s=56320|s&1023),r.push(s),i+=a}return On(r)}var et=4096;function On(n){var e=n.length;if(e<=et)return String.fromCharCode.apply(String,n);for(var t="",r=0;r<e;)t+=String.fromCharCode.apply(String,n.slice(r,r+=et));return t}function Fn(n,e,t){var r="";t=Math.min(n.length,t);for(var i=e;i<t;++i)r+=String.fromCharCode(n[i]&127);return r}function Cn(n,e,t){var r="";t=Math.min(n.length,t);for(var i=e;i<t;++i)r+=String.fromCharCode(n[i]);return r}function Pn(n,e,t){var r=n.length;(!e||e<0)&&(e=0),(!t||t<0||t>r)&&(t=r);for(var i="",o=e;o<t;++o)i+=kn(n[o]);return i}function Tn(n,e,t){for(var r=n.slice(e,t),i="",o=0;o<r.length;o+=2)i+=String.fromCharCode(r[o]+r[o+1]*256);return i}l.prototype.slice=function(e,t){var r=this.length;e=~~e,t=t===void 0?r:~~t,e<0?(e+=r,e<0&&(e=0)):e>r&&(e=r),t<0?(t+=r,t<0&&(t=0)):t>r&&(t=r),t<e&&(t=e);var i;if(l.TYPED_ARRAY_SUPPORT)i=this.subarray(e,t),i.__proto__=l.prototype;else{var o=t-e;i=new l(o,void 0);for(var s=0;s<o;++s)i[s]=this[s+e]}return i};function B(n,e,t){if(n%1!==0||n<0)throw new RangeError("offset is not uint");if(n+e>t)throw new RangeError("Trying to access beyond buffer length")}l.prototype.readUIntLE=function(e,t,r){e=e|0,t=t|0,r||B(e,t,this.length);for(var i=this[e],o=1,s=0;++s<t&&(o*=256);)i+=this[e+s]*o;return i};l.prototype.readUIntBE=function(e,t,r){e=e|0,t=t|0,r||B(e,t,this.length);for(var i=this[e+--t],o=1;t>0&&(o*=256);)i+=this[e+--t]*o;return i};l.prototype.readUInt8=function(e,t){return t||B(e,1,this.length),this[e]};l.prototype.readUInt16LE=function(e,t){return t||B(e,2,this.length),this[e]|this[e+1]<<8};l.prototype.readUInt16BE=function(e,t){return t||B(e,2,this.length),this[e]<<8|this[e+1]};l.prototype.readUInt32LE=function(e,t){return t||B(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+this[e+3]*16777216};l.prototype.readUInt32BE=function(e,t){return t||B(e,4,this.length),this[e]*16777216+(this[e+1]<<16|this[e+2]<<8|this[e+3])};l.prototype.readIntLE=function(e,t,r){e=e|0,t=t|0,r||B(e,t,this.length);for(var i=this[e],o=1,s=0;++s<t&&(o*=256);)i+=this[e+s]*o;return o*=128,i>=o&&(i-=Math.pow(2,8*t)),i};l.prototype.readIntBE=function(e,t,r){e=e|0,t=t|0,r||B(e,t,this.length);for(var i=t,o=1,s=this[e+--i];i>0&&(o*=256);)s+=this[e+--i]*o;return o*=128,s>=o&&(s-=Math.pow(2,8*t)),s};l.prototype.readInt8=function(e,t){return t||B(e,1,this.length),this[e]&128?(255-this[e]+1)*-1:this[e]};l.prototype.readInt16LE=function(e,t){t||B(e,2,this.length);var r=this[e]|this[e+1]<<8;return r&32768?r|4294901760:r};l.prototype.readInt16BE=function(e,t){t||B(e,2,this.length);var r=this[e+1]|this[e]<<8;return r&32768?r|4294901760:r};l.prototype.readInt32LE=function(e,t){return t||B(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24};l.prototype.readInt32BE=function(e,t){return t||B(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]};l.prototype.readFloatLE=function(e,t){return t||B(e,4,this.length),Oe(this,e,!0,23,4)};l.prototype.readFloatBE=function(e,t){return t||B(e,4,this.length),Oe(this,e,!1,23,4)};l.prototype.readDoubleLE=function(e,t){return t||B(e,8,this.length),Oe(this,e,!0,52,8)};l.prototype.readDoubleBE=function(e,t){return t||B(e,8,this.length),Oe(this,e,!1,52,8)};function J(n,e,t,r,i,o){if(!ne(n))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>i||e<o)throw new RangeError('"value" argument is out of bounds');if(t+r>n.length)throw new RangeError("Index out of range")}l.prototype.writeUIntLE=function(e,t,r,i){if(e=+e,t=t|0,r=r|0,!i){var o=Math.pow(2,8*r)-1;J(this,e,t,r,o,0)}var s=1,a=0;for(this[t]=e&255;++a<r&&(s*=256);)this[t+a]=e/s&255;return t+r};l.prototype.writeUIntBE=function(e,t,r,i){if(e=+e,t=t|0,r=r|0,!i){var o=Math.pow(2,8*r)-1;J(this,e,t,r,o,0)}var s=r-1,a=1;for(this[t+s]=e&255;--s>=0&&(a*=256);)this[t+s]=e/a&255;return t+r};l.prototype.writeUInt8=function(e,t,r){return e=+e,t=t|0,r||J(this,e,t,1,255,0),l.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=e&255,t+1};function Fe(n,e,t,r){e<0&&(e=65535+e+1);for(var i=0,o=Math.min(n.length-t,2);i<o;++i)n[t+i]=(e&255<<8*(r?i:1-i))>>>(r?i:1-i)*8}l.prototype.writeUInt16LE=function(e,t,r){return e=+e,t=t|0,r||J(this,e,t,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[t]=e&255,this[t+1]=e>>>8):Fe(this,e,t,!0),t+2};l.prototype.writeUInt16BE=function(e,t,r){return e=+e,t=t|0,r||J(this,e,t,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=e&255):Fe(this,e,t,!1),t+2};function Ce(n,e,t,r){e<0&&(e=4294967295+e+1);for(var i=0,o=Math.min(n.length-t,4);i<o;++i)n[t+i]=e>>>(r?i:3-i)*8&255}l.prototype.writeUInt32LE=function(e,t,r){return e=+e,t=t|0,r||J(this,e,t,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=e&255):Ce(this,e,t,!0),t+4};l.prototype.writeUInt32BE=function(e,t,r){return e=+e,t=t|0,r||J(this,e,t,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=e&255):Ce(this,e,t,!1),t+4};l.prototype.writeIntLE=function(e,t,r,i){if(e=+e,t=t|0,!i){var o=Math.pow(2,8*r-1);J(this,e,t,r,o-1,-o)}var s=0,a=1,u=0;for(this[t]=e&255;++s<r&&(a*=256);)e<0&&u===0&&this[t+s-1]!==0&&(u=1),this[t+s]=(e/a>>0)-u&255;return t+r};l.prototype.writeIntBE=function(e,t,r,i){if(e=+e,t=t|0,!i){var o=Math.pow(2,8*r-1);J(this,e,t,r,o-1,-o)}var s=r-1,a=1,u=0;for(this[t+s]=e&255;--s>=0&&(a*=256);)e<0&&u===0&&this[t+s+1]!==0&&(u=1),this[t+s]=(e/a>>0)-u&255;return t+r};l.prototype.writeInt8=function(e,t,r){return e=+e,t=t|0,r||J(this,e,t,1,127,-128),l.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=e&255,t+1};l.prototype.writeInt16LE=function(e,t,r){return e=+e,t=t|0,r||J(this,e,t,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[t]=e&255,this[t+1]=e>>>8):Fe(this,e,t,!0),t+2};l.prototype.writeInt16BE=function(e,t,r){return e=+e,t=t|0,r||J(this,e,t,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=e&255):Fe(this,e,t,!1),t+2};l.prototype.writeInt32LE=function(e,t,r){return e=+e,t=t|0,r||J(this,e,t,4,2147483647,-2147483648),l.TYPED_ARRAY_SUPPORT?(this[t]=e&255,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):Ce(this,e,t,!0),t+4};l.prototype.writeInt32BE=function(e,t,r){return e=+e,t=t|0,r||J(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=e&255):Ce(this,e,t,!1),t+4};function yt(n,e,t,r,i,o){if(t+r>n.length)throw new RangeError("Index out of range");if(t<0)throw new RangeError("Index out of range")}function vt(n,e,t,r,i){return i||yt(n,e,t,4),ct(n,e,t,r,23,4),t+4}l.prototype.writeFloatLE=function(e,t,r){return vt(this,e,t,!0,r)};l.prototype.writeFloatBE=function(e,t,r){return vt(this,e,t,!1,r)};function xt(n,e,t,r,i){return i||yt(n,e,t,8),ct(n,e,t,r,52,8),t+8}l.prototype.writeDoubleLE=function(e,t,r){return xt(this,e,t,!0,r)};l.prototype.writeDoubleBE=function(e,t,r){return xt(this,e,t,!1,r)};l.prototype.copy=function(e,t,r,i){if(r||(r=0),!i&&i!==0&&(i=this.length),t>=e.length&&(t=e.length),t||(t=0),i>0&&i<r&&(i=r),i===r||e.length===0||this.length===0)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-t<i-r&&(i=e.length-t+r);var o=i-r,s;if(this===e&&r<t&&t<i)for(s=o-1;s>=0;--s)e[s+t]=this[s+r];else if(o<1e3||!l.TYPED_ARRAY_SUPPORT)for(s=0;s<o;++s)e[s+t]=this[s+r];else Uint8Array.prototype.set.call(e,this.subarray(r,r+o),t);return o};l.prototype.fill=function(e,t,r,i){if(typeof e=="string"){if(typeof t=="string"?(i=t,t=0,r=this.length):typeof r=="string"&&(i=r,r=this.length),e.length===1){var o=e.charCodeAt(0);o<256&&(e=o)}if(i!==void 0&&typeof i!="string")throw new TypeError("encoding must be a string");if(typeof i=="string"&&!l.isEncoding(i))throw new TypeError("Unknown encoding: "+i)}else typeof e=="number"&&(e=e&255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;t=t>>>0,r=r===void 0?this.length:r>>>0,e||(e=0);var s;if(typeof e=="number")for(s=t;s<r;++s)this[s]=e;else{var a=ne(e)?e:Ae(new l(e,i).toString()),u=a.length;for(s=0;s<r-t;++s)this[s+t]=a[s%u]}return this};var $n=/[^+\/0-9A-Za-z-_]/g;function Dn(n){if(n=Ln(n).replace($n,""),n.length<2)return"";for(;n.length%4!==0;)n=n+"=";return n}function Ln(n){return n.trim?n.trim():n.replace(/^\s+|\s+$/g,"")}function kn(n){return n<16?"0"+n.toString(16):n.toString(16)}function Ae(n,e){e=e||1/0;for(var t,r=n.length,i=null,o=[],s=0;s<r;++s){if(t=n.charCodeAt(s),t>55295&&t<57344){if(!i){if(t>56319){(e-=3)>-1&&o.push(239,191,189);continue}else if(s+1===r){(e-=3)>-1&&o.push(239,191,189);continue}i=t;continue}if(t<56320){(e-=3)>-1&&o.push(239,191,189),i=t;continue}t=(i-55296<<10|t-56320)+65536}else i&&(e-=3)>-1&&o.push(239,191,189);if(i=null,t<128){if((e-=1)<0)break;o.push(t)}else if(t<2048){if((e-=2)<0)break;o.push(t>>6|192,t&63|128)}else if(t<65536){if((e-=3)<0)break;o.push(t>>12|224,t>>6&63|128,t&63|128)}else if(t<1114112){if((e-=4)<0)break;o.push(t>>18|240,t>>12&63|128,t>>6&63|128,t&63|128)}else throw new Error("Invalid code point")}return o}function Mn(n){for(var e=[],t=0;t<n.length;++t)e.push(n.charCodeAt(t)&255);return e}function Un(n,e){for(var t,r,i,o=[],s=0;s<n.length&&!((e-=2)<0);++s)t=n.charCodeAt(s),r=t>>8,i=t%256,o.push(i),o.push(r);return o}function bt(n){return hn(Dn(n))}function Pe(n,e,t,r){for(var i=0;i<r&&!(i+t>=e.length||i>=n.length);++i)e[i+t]=n[i];return i}function Bn(n){return n!==n}function Z(n){return n!=null&&(!!n._isBuffer||It(n)||Vn(n))}function It(n){return!!n.constructor&&typeof n.constructor.isBuffer=="function"&&n.constructor.isBuffer(n)}function Vn(n){return typeof n.readFloatLE=="function"&&typeof n.slice=="function"&&It(n.slice(0,0))}class C extends Error{constructor(e,t,r,...i){Array.isArray(t)&&(t=t.join(" ").trim()),super(t),Error.captureStackTrace!==void 0&&Error.captureStackTrace(this,C),this.code=e;for(const o of i)for(const s in o){const a=o[s];this[s]=Z(a)?a.toString(r.encoding):a==null?a:JSON.parse(JSON.stringify(a))}}}const Yn=function(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)},Et=function(n){const e=[];for(let t=0,r=n.length;t<r;t++){const i=n[t];if(i==null||i===!1)e[t]={disabled:!0};else if(typeof i=="string")e[t]={name:i};else if(Yn(i)){if(typeof i.name!="string")throw new C("CSV_OPTION_COLUMNS_MISSING_NAME",["Option columns missing name:",`property "name" is required at position ${t}`,"when column is an object literal"]);e[t]=i}else throw new C("CSV_INVALID_COLUMN_DEFINITION",["Invalid column definition:","expect a string or a literal object,",`got ${JSON.stringify(i)} at position ${t}`])}return e};class tt{constructor(e=100){this.size=e,this.length=0,this.buf=l.allocUnsafe(e)}prepend(e){if(Z(e)){const t=this.length+e.length;if(t>=this.size&&(this.resize(),t>=this.size))throw Error("INVALID_BUFFER_STATE");const r=this.buf;this.buf=l.allocUnsafe(this.size),e.copy(this.buf,0),r.copy(this.buf,e.length),this.length+=e.length}else{const t=this.length++;t===this.size&&this.resize();const r=this.clone();this.buf[0]=e,r.copy(this.buf,1,0,t)}}append(e){const t=this.length++;t===this.size&&this.resize(),this.buf[t]=e}clone(){return l.from(this.buf.slice(0,this.length))}resize(){const e=this.length;this.size=this.size*2;const t=l.allocUnsafe(this.size);this.buf.copy(t,0,0,e),this.buf=t}toString(e){return e?this.buf.slice(0,this.length).toString(e):Uint8Array.prototype.slice.call(this.buf.slice(0,this.length))}toJSON(){return this.toString("utf8")}reset(){this.length=0}}const zn=12,qn=13,Jn=10,jn=32,Hn=9,Qn=function(n){return{bomSkipped:!1,bufBytesStart:0,castField:n.cast_function,commenting:!1,error:void 0,enabled:n.from_line===1,escaping:!1,escapeIsQuote:Z(n.escape)&&Z(n.quote)&&l.compare(n.escape,n.quote)===0,expectedRecordLength:Array.isArray(n.columns)?n.columns.length:void 0,field:new tt(20),firstLineToHeaders:n.cast_first_line_to_header,needMoreDataSize:Math.max(n.comment!==null?n.comment.length:0,...n.delimiter.map(e=>e.length),n.quote!==null?n.quote.length:0),previousBuf:void 0,quoting:!1,stop:!1,rawBuffer:new tt(100),record:[],recordHasError:!1,record_length:0,recordDelimiterMaxLength:n.record_delimiter.length===0?0:Math.max(...n.record_delimiter.map(e=>e.length)),trimChars:[l.from(" ",n.encoding)[0],l.from("	",n.encoding)[0]],wasQuoting:!1,wasRowDelimiter:!1,timchars:[l.from(l.from([qn],"utf8").toString(),n.encoding),l.from(l.from([Jn],"utf8").toString(),n.encoding),l.from(l.from([zn],"utf8").toString(),n.encoding),l.from(l.from([jn],"utf8").toString(),n.encoding),l.from(l.from([Hn],"utf8").toString(),n.encoding)]}},Gn=function(n){return n.replace(/([A-Z])/g,function(e,t){return"_"+t.toLowerCase()})},nt=function(n){const e={};for(const r in n)e[Gn(r)]=n[r];if(e.encoding===void 0||e.encoding===!0)e.encoding="utf8";else if(e.encoding===null||e.encoding===!1)e.encoding=null;else if(typeof e.encoding!="string"&&e.encoding!==null)throw new C("CSV_INVALID_OPTION_ENCODING",["Invalid option encoding:","encoding must be a string or null to return a buffer,",`got ${JSON.stringify(e.encoding)}`],e);if(e.bom===void 0||e.bom===null||e.bom===!1)e.bom=!1;else if(e.bom!==!0)throw new C("CSV_INVALID_OPTION_BOM",["Invalid option bom:","bom must be true,",`got ${JSON.stringify(e.bom)}`],e);if(e.cast_function=null,e.cast===void 0||e.cast===null||e.cast===!1||e.cast==="")e.cast=void 0;else if(typeof e.cast=="function")e.cast_function=e.cast,e.cast=!0;else if(e.cast!==!0)throw new C("CSV_INVALID_OPTION_CAST",["Invalid option cast:","cast must be true or a function,",`got ${JSON.stringify(e.cast)}`],e);if(e.cast_date===void 0||e.cast_date===null||e.cast_date===!1||e.cast_date==="")e.cast_date=!1;else if(e.cast_date===!0)e.cast_date=function(r){const i=Date.parse(r);return isNaN(i)?r:new Date(i)};else if(typeof e.cast_date!="function")throw new C("CSV_INVALID_OPTION_CAST_DATE",["Invalid option cast_date:","cast_date must be true or a function,",`got ${JSON.stringify(e.cast_date)}`],e);if(e.cast_first_line_to_header=null,e.columns===!0)e.cast_first_line_to_header=void 0;else if(typeof e.columns=="function")e.cast_first_line_to_header=e.columns,e.columns=!0;else if(Array.isArray(e.columns))e.columns=Et(e.columns);else if(e.columns===void 0||e.columns===null||e.columns===!1)e.columns=!1;else throw new C("CSV_INVALID_OPTION_COLUMNS",["Invalid option columns:","expect an array, a function or true,",`got ${JSON.stringify(e.columns)}`],e);if(e.group_columns_by_name===void 0||e.group_columns_by_name===null||e.group_columns_by_name===!1)e.group_columns_by_name=!1;else{if(e.group_columns_by_name!==!0)throw new C("CSV_INVALID_OPTION_GROUP_COLUMNS_BY_NAME",["Invalid option group_columns_by_name:","expect an boolean,",`got ${JSON.stringify(e.group_columns_by_name)}`],e);if(e.columns===!1)throw new C("CSV_INVALID_OPTION_GROUP_COLUMNS_BY_NAME",["Invalid option group_columns_by_name:","the `columns` mode must be activated."],e)}if(e.comment===void 0||e.comment===null||e.comment===!1||e.comment==="")e.comment=null;else if(typeof e.comment=="string"&&(e.comment=l.from(e.comment,e.encoding)),!Z(e.comment))throw new C("CSV_INVALID_OPTION_COMMENT",["Invalid option comment:","comment must be a buffer or a string,",`got ${JSON.stringify(e.comment)}`],e);if(e.comment_no_infix===void 0||e.comment_no_infix===null||e.comment_no_infix===!1)e.comment_no_infix=!1;else if(e.comment_no_infix!==!0)throw new C("CSV_INVALID_OPTION_COMMENT",["Invalid option comment_no_infix:","value must be a boolean,",`got ${JSON.stringify(e.comment_no_infix)}`],e);const t=JSON.stringify(e.delimiter);if(Array.isArray(e.delimiter)||(e.delimiter=[e.delimiter]),e.delimiter.length===0)throw new C("CSV_INVALID_OPTION_DELIMITER",["Invalid option delimiter:","delimiter must be a non empty string or buffer or array of string|buffer,",`got ${t}`],e);if(e.delimiter=e.delimiter.map(function(r){if(r==null||r===!1)return l.from(",",e.encoding);if(typeof r=="string"&&(r=l.from(r,e.encoding)),!Z(r)||r.length===0)throw new C("CSV_INVALID_OPTION_DELIMITER",["Invalid option delimiter:","delimiter must be a non empty string or buffer or array of string|buffer,",`got ${t}`],e);return r}),e.escape===void 0||e.escape===!0?e.escape=l.from('"',e.encoding):typeof e.escape=="string"?e.escape=l.from(e.escape,e.encoding):(e.escape===null||e.escape===!1)&&(e.escape=null),e.escape!==null&&!Z(e.escape))throw new Error(`Invalid Option: escape must be a buffer, a string or a boolean, got ${JSON.stringify(e.escape)}`);if(e.from===void 0||e.from===null)e.from=1;else if(typeof e.from=="string"&&/\d+/.test(e.from)&&(e.from=parseInt(e.from)),Number.isInteger(e.from)){if(e.from<0)throw new Error(`Invalid Option: from must be a positive integer, got ${JSON.stringify(n.from)}`)}else throw new Error(`Invalid Option: from must be an integer, got ${JSON.stringify(e.from)}`);if(e.from_line===void 0||e.from_line===null)e.from_line=1;else if(typeof e.from_line=="string"&&/\d+/.test(e.from_line)&&(e.from_line=parseInt(e.from_line)),Number.isInteger(e.from_line)){if(e.from_line<=0)throw new Error(`Invalid Option: from_line must be a positive integer greater than 0, got ${JSON.stringify(n.from_line)}`)}else throw new Error(`Invalid Option: from_line must be an integer, got ${JSON.stringify(n.from_line)}`);if(e.ignore_last_delimiters===void 0||e.ignore_last_delimiters===null)e.ignore_last_delimiters=!1;else if(typeof e.ignore_last_delimiters=="number")e.ignore_last_delimiters=Math.floor(e.ignore_last_delimiters),e.ignore_last_delimiters===0&&(e.ignore_last_delimiters=!1);else if(typeof e.ignore_last_delimiters!="boolean")throw new C("CSV_INVALID_OPTION_IGNORE_LAST_DELIMITERS",["Invalid option `ignore_last_delimiters`:","the value must be a boolean value or an integer,",`got ${JSON.stringify(e.ignore_last_delimiters)}`],e);if(e.ignore_last_delimiters===!0&&e.columns===!1)throw new C("CSV_IGNORE_LAST_DELIMITERS_REQUIRES_COLUMNS",["The option `ignore_last_delimiters`","requires the activation of the `columns` option"],e);if(e.info===void 0||e.info===null||e.info===!1)e.info=!1;else if(e.info!==!0)throw new Error(`Invalid Option: info must be true, got ${JSON.stringify(e.info)}`);if(e.max_record_size===void 0||e.max_record_size===null||e.max_record_size===!1)e.max_record_size=0;else if(!(Number.isInteger(e.max_record_size)&&e.max_record_size>=0))if(typeof e.max_record_size=="string"&&/\d+/.test(e.max_record_size))e.max_record_size=parseInt(e.max_record_size);else throw new Error(`Invalid Option: max_record_size must be a positive integer, got ${JSON.stringify(e.max_record_size)}`);if(e.objname===void 0||e.objname===null||e.objname===!1)e.objname=void 0;else if(Z(e.objname)){if(e.objname.length===0)throw new Error("Invalid Option: objname must be a non empty buffer");e.encoding===null||(e.objname=e.objname.toString(e.encoding))}else if(typeof e.objname=="string"){if(e.objname.length===0)throw new Error("Invalid Option: objname must be a non empty string")}else if(typeof e.objname!="number")throw new Error(`Invalid Option: objname must be a string or a buffer, got ${e.objname}`);if(e.objname!==void 0){if(typeof e.objname=="number"){if(e.columns!==!1)throw Error("Invalid Option: objname index cannot be combined with columns or be defined as a field")}else if(e.columns===!1)throw Error("Invalid Option: objname field must be combined with columns or be defined as an index")}if(e.on_record===void 0||e.on_record===null)e.on_record=void 0;else if(typeof e.on_record!="function")throw new C("CSV_INVALID_OPTION_ON_RECORD",["Invalid option `on_record`:","expect a function,",`got ${JSON.stringify(e.on_record)}`],e);if(e.quote===null||e.quote===!1||e.quote==="")e.quote=null;else if(e.quote===void 0||e.quote===!0?e.quote=l.from('"',e.encoding):typeof e.quote=="string"&&(e.quote=l.from(e.quote,e.encoding)),!Z(e.quote))throw new Error(`Invalid Option: quote must be a buffer or a string, got ${JSON.stringify(e.quote)}`);if(e.raw===void 0||e.raw===null||e.raw===!1)e.raw=!1;else if(e.raw!==!0)throw new Error(`Invalid Option: raw must be true, got ${JSON.stringify(e.raw)}`);if(e.record_delimiter===void 0)e.record_delimiter=[];else if(typeof e.record_delimiter=="string"||Z(e.record_delimiter)){if(e.record_delimiter.length===0)throw new C("CSV_INVALID_OPTION_RECORD_DELIMITER",["Invalid option `record_delimiter`:","value must be a non empty string or buffer,",`got ${JSON.stringify(e.record_delimiter)}`],e);e.record_delimiter=[e.record_delimiter]}else if(!Array.isArray(e.record_delimiter))throw new C("CSV_INVALID_OPTION_RECORD_DELIMITER",["Invalid option `record_delimiter`:","value must be a string, a buffer or array of string|buffer,",`got ${JSON.stringify(e.record_delimiter)}`],e);if(e.record_delimiter=e.record_delimiter.map(function(r,i){if(typeof r!="string"&&!Z(r))throw new C("CSV_INVALID_OPTION_RECORD_DELIMITER",["Invalid option `record_delimiter`:","value must be a string, a buffer or array of string|buffer",`at index ${i},`,`got ${JSON.stringify(r)}`],e);if(r.length===0)throw new C("CSV_INVALID_OPTION_RECORD_DELIMITER",["Invalid option `record_delimiter`:","value must be a non empty string or buffer",`at index ${i},`,`got ${JSON.stringify(r)}`],e);return typeof r=="string"&&(r=l.from(r,e.encoding)),r}),typeof e.relax_column_count!="boolean")if(e.relax_column_count===void 0||e.relax_column_count===null)e.relax_column_count=!1;else throw new Error(`Invalid Option: relax_column_count must be a boolean, got ${JSON.stringify(e.relax_column_count)}`);if(typeof e.relax_column_count_less!="boolean")if(e.relax_column_count_less===void 0||e.relax_column_count_less===null)e.relax_column_count_less=!1;else throw new Error(`Invalid Option: relax_column_count_less must be a boolean, got ${JSON.stringify(e.relax_column_count_less)}`);if(typeof e.relax_column_count_more!="boolean")if(e.relax_column_count_more===void 0||e.relax_column_count_more===null)e.relax_column_count_more=!1;else throw new Error(`Invalid Option: relax_column_count_more must be a boolean, got ${JSON.stringify(e.relax_column_count_more)}`);if(typeof e.relax_quotes!="boolean")if(e.relax_quotes===void 0||e.relax_quotes===null)e.relax_quotes=!1;else throw new Error(`Invalid Option: relax_quotes must be a boolean, got ${JSON.stringify(e.relax_quotes)}`);if(typeof e.skip_empty_lines!="boolean")if(e.skip_empty_lines===void 0||e.skip_empty_lines===null)e.skip_empty_lines=!1;else throw new Error(`Invalid Option: skip_empty_lines must be a boolean, got ${JSON.stringify(e.skip_empty_lines)}`);if(typeof e.skip_records_with_empty_values!="boolean")if(e.skip_records_with_empty_values===void 0||e.skip_records_with_empty_values===null)e.skip_records_with_empty_values=!1;else throw new Error(`Invalid Option: skip_records_with_empty_values must be a boolean, got ${JSON.stringify(e.skip_records_with_empty_values)}`);if(typeof e.skip_records_with_error!="boolean")if(e.skip_records_with_error===void 0||e.skip_records_with_error===null)e.skip_records_with_error=!1;else throw new Error(`Invalid Option: skip_records_with_error must be a boolean, got ${JSON.stringify(e.skip_records_with_error)}`);if(e.rtrim===void 0||e.rtrim===null||e.rtrim===!1)e.rtrim=!1;else if(e.rtrim!==!0)throw new Error(`Invalid Option: rtrim must be a boolean, got ${JSON.stringify(e.rtrim)}`);if(e.ltrim===void 0||e.ltrim===null||e.ltrim===!1)e.ltrim=!1;else if(e.ltrim!==!0)throw new Error(`Invalid Option: ltrim must be a boolean, got ${JSON.stringify(e.ltrim)}`);if(e.trim===void 0||e.trim===null||e.trim===!1)e.trim=!1;else if(e.trim!==!0)throw new Error(`Invalid Option: trim must be a boolean, got ${JSON.stringify(e.trim)}`);if(e.trim===!0&&n.ltrim!==!1?e.ltrim=!0:e.ltrim!==!0&&(e.ltrim=!1),e.trim===!0&&n.rtrim!==!1?e.rtrim=!0:e.rtrim!==!0&&(e.rtrim=!1),e.to===void 0||e.to===null)e.to=-1;else if(typeof e.to=="string"&&/\d+/.test(e.to)&&(e.to=parseInt(e.to)),Number.isInteger(e.to)){if(e.to<=0)throw new Error(`Invalid Option: to must be a positive integer greater than 0, got ${JSON.stringify(n.to)}`)}else throw new Error(`Invalid Option: to must be an integer, got ${JSON.stringify(n.to)}`);if(e.to_line===void 0||e.to_line===null)e.to_line=-1;else if(typeof e.to_line=="string"&&/\d+/.test(e.to_line)&&(e.to_line=parseInt(e.to_line)),Number.isInteger(e.to_line)){if(e.to_line<=0)throw new Error(`Invalid Option: to_line must be a positive integer greater than 0, got ${JSON.stringify(n.to_line)}`)}else throw new Error(`Invalid Option: to_line must be an integer, got ${JSON.stringify(n.to_line)}`);return e},rt=function(n){return n.every(e=>e==null||e.toString&&e.toString().trim()==="")},Wn=13,Kn=10,he={utf8:l.from([239,187,191]),utf16le:l.from([255,254])},Xn=function(n={}){const e={bytes:0,comment_lines:0,empty_lines:0,invalid_field_length:0,lines:1,records:0},t=nt(n);return{info:e,original_options:n,options:t,state:Qn(t),__needMoreData:function(r,i,o){if(o)return!1;const{encoding:s,escape:a,quote:u}=this.options,{quoting:c,needMoreDataSize:d,recordDelimiterMaxLength:f}=this.state,m=i-r-1,p=Math.max(d,f===0?l.from(`\r
`,s).length:f,c?(a===null?0:a.length)+u.length:0,c?u.length+f:0);return m<p},parse:function(r,i,o,s){const{bom:a,comment_no_infix:u,encoding:c,from_line:d,ltrim:f,max_record_size:m,raw:p,relax_quotes:E,rtrim:A,skip_empty_lines:v,to:S,to_line:w}=this.options;let{comment:I,escape:$,quote:y,record_delimiter:N}=this.options;const{bomSkipped:Y,previousBuf:x,rawBuffer:G,escapeIsQuote:W}=this.state;let R;if(x===void 0)if(r===void 0){s();return}else R=r;else x!==void 0&&r===void 0?R=x:R=l.concat([x,r]);if(Y===!1)if(a===!1)this.state.bomSkipped=!0;else if(R.length<3){if(i===!1){this.state.previousBuf=R;return}}else{for(const L in he)if(he[L].compare(R,0,he[L].length)===0){const j=he[L].length;this.state.bufBytesStart+=j,R=R.slice(j),this.options=nt({...this.original_options,encoding:L}),{comment:I,escape:$,quote:y}=this.options;break}this.state.bomSkipped=!0}const fe=R.length;let b;for(b=0;b<fe&&!this.__needMoreData(b,fe,i);b++){if(this.state.wasRowDelimiter===!0&&(this.info.lines++,this.state.wasRowDelimiter=!1),w!==-1&&this.info.lines>w){this.state.stop=!0,s();return}this.state.quoting===!1&&N.length===0&&this.__autoDiscoverRecordDelimiter(R,b)&&(N=this.options.record_delimiter);const L=R[b];if(p===!0&&G.append(L),(L===Wn||L===Kn)&&this.state.wasRowDelimiter===!1&&(this.state.wasRowDelimiter=!0),this.state.escaping===!0)this.state.escaping=!1;else{if($!==null&&this.state.quoting===!0&&this.__isEscape(R,b,L)&&b+$.length<fe)if(W){if(this.__isQuote(R,b+$.length)){this.state.escaping=!0,b+=$.length-1;continue}}else{this.state.escaping=!0,b+=$.length-1;continue}if(this.state.commenting===!1&&this.__isQuote(R,b))if(this.state.quoting===!0){const U=R[b+y.length],se=A&&this.__isCharTrimable(R,b+y.length),re=I!==null&&this.__compareBytes(I,R,b+y.length,U),z=this.__isDelimiter(R,b+y.length,U),ce=N.length===0?this.__autoDiscoverRecordDelimiter(R,b+y.length):this.__isRecordDelimiter(U,R,b+y.length);if($!==null&&this.__isEscape(R,b,L)&&this.__isQuote(R,b+$.length))b+=$.length-1;else if(!U||z||ce||re||se){this.state.quoting=!1,this.state.wasQuoting=!0,b+=y.length-1;continue}else if(E===!1){const oe=this.__error(new C("CSV_INVALID_CLOSING_QUOTE",["Invalid Closing Quote:",`got "${String.fromCharCode(U)}"`,`at line ${this.info.lines}`,"instead of delimiter, record delimiter, trimable character","(if activated) or comment"],this.options,this.__infoField()));if(oe!==void 0)return oe}else this.state.quoting=!1,this.state.wasQuoting=!0,this.state.field.prepend(y),b+=y.length-1}else if(this.state.field.length!==0){if(E===!1){const U=this.__infoField(),se=Object.keys(he).map(z=>he[z].equals(this.state.field.toString())?z:!1).filter(Boolean)[0],re=this.__error(new C("INVALID_OPENING_QUOTE",["Invalid Opening Quote:",`a quote is found on field ${JSON.stringify(U.column)} at line ${U.lines}, value is ${JSON.stringify(this.state.field.toString(c))}`,se?`(${se} bom)`:void 0],this.options,U,{field:this.state.field}));if(re!==void 0)return re}}else{this.state.quoting=!0,b+=y.length-1;continue}if(this.state.quoting===!1){const U=this.__isRecordDelimiter(L,R,b);if(U!==0){if(this.state.commenting&&this.state.wasQuoting===!1&&this.state.record.length===0&&this.state.field.length===0)this.info.comment_lines++;else{if(this.state.enabled===!1&&this.info.lines+(this.state.wasRowDelimiter===!0?1:0)>=d){this.state.enabled=!0,this.__resetField(),this.__resetRecord(),b+=U-1;continue}if(v===!0&&this.state.wasQuoting===!1&&this.state.record.length===0&&this.state.field.length===0){this.info.empty_lines++,b+=U-1;continue}this.info.bytes=this.state.bufBytesStart+b;const ce=this.__onField();if(ce!==void 0)return ce;this.info.bytes=this.state.bufBytesStart+b+U;const oe=this.__onRecord(o);if(oe!==void 0)return oe;if(S!==-1&&this.info.records>=S){this.state.stop=!0,s();return}}this.state.commenting=!1,b+=U-1;continue}if(this.state.commenting)continue;if((I===null?0:this.__compareBytes(I,R,b,L))!==0&&(u===!1||this.state.field.length===0)){this.state.commenting=!0;continue}const re=this.__isDelimiter(R,b,L);if(re!==0){this.info.bytes=this.state.bufBytesStart+b;const z=this.__onField();if(z!==void 0)return z;b+=re-1;continue}}}if(this.state.commenting===!1&&m!==0&&this.state.record_length+this.state.field.length>m)return this.__error(new C("CSV_MAX_RECORD_SIZE",["Max Record Size:","record exceed the maximum number of tolerated bytes",`of ${m}`,`at line ${this.info.lines}`],this.options,this.__infoField()));const j=f===!1||this.state.quoting===!0||this.state.field.length!==0||!this.__isCharTrimable(R,b),Te=A===!1||this.state.wasQuoting===!1;if(j===!0&&Te===!0)this.state.field.append(L);else{if(A===!0&&!this.__isCharTrimable(R,b))return this.__error(new C("CSV_NON_TRIMABLE_CHAR_AFTER_CLOSING_QUOTE",["Invalid Closing Quote:","found non trimable byte after quote",`at line ${this.info.lines}`],this.options,this.__infoField()));j===!1&&(b+=this.__isCharTrimable(R,b)-1);continue}}if(i===!0)if(this.state.quoting===!0){const L=this.__error(new C("CSV_QUOTE_NOT_CLOSED",["Quote Not Closed:",`the parsing is finished with an opening quote at line ${this.info.lines}`],this.options,this.__infoField()));if(L!==void 0)return L}else if(this.state.wasQuoting===!0||this.state.record.length!==0||this.state.field.length!==0){this.info.bytes=this.state.bufBytesStart+b;const L=this.__onField();if(L!==void 0)return L;const j=this.__onRecord(o);if(j!==void 0)return j}else this.state.wasRowDelimiter===!0?this.info.empty_lines++:this.state.commenting===!0&&this.info.comment_lines++;else this.state.bufBytesStart+=b,this.state.previousBuf=R.slice(b);this.state.wasRowDelimiter===!0&&(this.info.lines++,this.state.wasRowDelimiter=!1)},__onRecord:function(r){const{columns:i,group_columns_by_name:o,encoding:s,info:a,from:u,relax_column_count:c,relax_column_count_less:d,relax_column_count_more:f,raw:m,skip_records_with_empty_values:p}=this.options,{enabled:E,record:A}=this.state;if(E===!1)return this.__resetRecord();const v=A.length;if(i===!0){if(p===!0&&rt(A)){this.__resetRecord();return}return this.__firstLineToColumns(A)}if(i===!1&&this.info.records===0&&(this.state.expectedRecordLength=v),v!==this.state.expectedRecordLength){const S=i===!1?new C("CSV_RECORD_INCONSISTENT_FIELDS_LENGTH",["Invalid Record Length:",`expect ${this.state.expectedRecordLength},`,`got ${v} on line ${this.info.lines}`],this.options,this.__infoField(),{record:A}):new C("CSV_RECORD_INCONSISTENT_COLUMNS",["Invalid Record Length:",`columns length is ${i.length},`,`got ${v} on line ${this.info.lines}`],this.options,this.__infoField(),{record:A});if(c===!0||d===!0&&v<this.state.expectedRecordLength||f===!0&&v>this.state.expectedRecordLength)this.info.invalid_field_length++,this.state.error=S;else{const w=this.__error(S);if(w)return w}}if(p===!0&&rt(A)){this.__resetRecord();return}if(this.state.recordHasError===!0){this.__resetRecord(),this.state.recordHasError=!1;return}if(this.info.records++,u===1||this.info.records>=u){const{objname:S}=this.options;if(i!==!1){const w={};for(let I=0,$=A.length;I<$;I++)i[I]===void 0||i[I].disabled||(o===!0&&w[i[I].name]!==void 0?Array.isArray(w[i[I].name])?w[i[I].name]=w[i[I].name].concat(A[I]):w[i[I].name]=[w[i[I].name],A[I]]:w[i[I].name]=A[I]);if(m===!0||a===!0){const I=Object.assign({record:w},m===!0?{raw:this.state.rawBuffer.toString(s)}:{},a===!0?{info:this.__infoRecord()}:{}),$=this.__push(S===void 0?I:[w[S],I],r);if($)return $}else{const I=this.__push(S===void 0?w:[w[S],w],r);if(I)return I}}else if(m===!0||a===!0){const w=Object.assign({record:A},m===!0?{raw:this.state.rawBuffer.toString(s)}:{},a===!0?{info:this.__infoRecord()}:{}),I=this.__push(S===void 0?w:[A[S],w],r);if(I)return I}else{const w=this.__push(S===void 0?A:[A[S],A],r);if(w)return w}}this.__resetRecord()},__firstLineToColumns:function(r){const{firstLineToHeaders:i}=this.state;try{const o=i===void 0?r:i.call(null,r);if(!Array.isArray(o))return this.__error(new C("CSV_INVALID_COLUMN_MAPPING",["Invalid Column Mapping:","expect an array from column function,",`got ${JSON.stringify(o)}`],this.options,this.__infoField(),{headers:o}));const s=Et(o);this.state.expectedRecordLength=s.length,this.options.columns=s,this.__resetRecord();return}catch(o){return o}},__resetRecord:function(){this.options.raw===!0&&this.state.rawBuffer.reset(),this.state.error=void 0,this.state.record=[],this.state.record_length=0},__onField:function(){const{cast:r,encoding:i,rtrim:o,max_record_size:s}=this.options,{enabled:a,wasQuoting:u}=this.state;if(a===!1)return this.__resetField();let c=this.state.field.toString(i);if(o===!0&&u===!1&&(c=c.trimRight()),r===!0){const[d,f]=this.__cast(c);if(d!==void 0)return d;c=f}this.state.record.push(c),s!==0&&typeof c=="string"&&(this.state.record_length+=c.length),this.__resetField()},__resetField:function(){this.state.field.reset(),this.state.wasQuoting=!1},__push:function(r,i){const{on_record:o}=this.options;if(o!==void 0){const s=this.__infoRecord();try{r=o.call(null,r,s)}catch(a){return a}if(r==null)return}i(r)},__cast:function(r){const{columns:i,relax_column_count:o}=this.options;if(Array.isArray(i)===!0&&o&&this.options.columns.length<=this.state.record.length)return[void 0,void 0];if(this.state.castField!==null)try{const a=this.__infoField();return[void 0,this.state.castField.call(null,r,a)]}catch(a){return[a]}if(this.__isFloat(r))return[void 0,parseFloat(r)];if(this.options.cast_date!==!1){const a=this.__infoField();return[void 0,this.options.cast_date.call(null,r,a)]}return[void 0,r]},__isCharTrimable:function(r,i){return((s,a)=>{const{timchars:u}=this.state;e:for(let c=0;c<u.length;c++){const d=u[c];for(let f=0;f<d.length;f++)if(d[f]!==s[a+f])continue e;return d.length}return 0})(r,i)},__isFloat:function(r){return r-parseFloat(r)+1>=0},__compareBytes:function(r,i,o,s){if(r[0]!==s)return 0;const a=r.length;for(let u=1;u<a;u++)if(r[u]!==i[o+u])return 0;return a},__isDelimiter:function(r,i,o){const{delimiter:s,ignore_last_delimiters:a}=this.options;if(a===!0&&this.state.record.length===this.options.columns.length-1)return 0;if(a!==!1&&typeof a=="number"&&this.state.record.length===a-1)return 0;e:for(let u=0;u<s.length;u++){const c=s[u];if(c[0]===o){for(let d=1;d<c.length;d++)if(c[d]!==r[i+d])continue e;return c.length}}return 0},__isRecordDelimiter:function(r,i,o){const{record_delimiter:s}=this.options,a=s.length;e:for(let u=0;u<a;u++){const c=s[u],d=c.length;if(c[0]===r){for(let f=1;f<d;f++)if(c[f]!==i[o+f])continue e;return c.length}}return 0},__isEscape:function(r,i,o){const{escape:s}=this.options;if(s===null)return!1;const a=s.length;if(s[0]===o){for(let u=0;u<a;u++)if(s[u]!==r[i+u])return!1;return!0}return!1},__isQuote:function(r,i){const{quote:o}=this.options;if(o===null)return!1;const s=o.length;for(let a=0;a<s;a++)if(o[a]!==r[i+a])return!1;return!0},__autoDiscoverRecordDelimiter:function(r,i){const{encoding:o}=this.options,s=[l.from(`\r
`,o),l.from(`
`,o),l.from("\r",o)];e:for(let a=0;a<s.length;a++){const u=s[a].length;for(let c=0;c<u;c++)if(s[a][c]!==r[i+c])continue e;return this.options.record_delimiter.push(s[a]),this.state.recordDelimiterMaxLength=s[a].length,s[a].length}return 0},__error:function(r){const{encoding:i,raw:o,skip_records_with_error:s}=this.options,a=typeof r=="string"?new Error(r):r;if(s){this.state.recordHasError=!0,this.options.on_skip!==void 0&&this.options.on_skip(a,o?this.state.rawBuffer.toString(i):void 0);return}else return a},__infoDataSet:function(){return{...this.info,columns:this.options.columns}},__infoRecord:function(){const{columns:r,raw:i,encoding:o}=this.options;return{...this.__infoDataSet(),error:this.state.error,header:r===!0,index:this.state.record.length,raw:i?this.state.rawBuffer.toString(o):void 0}},__infoField:function(){const{columns:r}=this.options,i=Array.isArray(r);return{...this.__infoRecord(),column:i===!0?r.length>this.state.record.length?r[this.state.record.length].name:null:this.state.record.length,quoting:this.state.wasQuoting}}}},Zn=function(n,e={}){typeof n=="string"&&(n=l.from(n));const t=e&&e.objname?{}:[],r=Xn(e),i=u=>{r.options.objname===void 0?t.push(u):t[u[0]]=u[1]},o=()=>{},s=r.parse(n,!1,i,o);if(s!==void 0)throw s;const a=r.parse(void 0,!0,i,o);if(a!==void 0)throw a;return t};function er(n,e){const{value:t,unit:r}=n,{dataType:i,units:o,defaultUnit:s,unitTransformer:a}=e;if(!r||!s||!a.length||!o.includes(r)||(i!=="number"||typeof t!="number"))return t;const d=o.indexOf(r),f=a[d];return t*f}const Qe=n=>(Ne("data-v-1d18d9e2"),n=n(),Re(),n),tr={class:"verifyPanel"},nr={class:"fw5 mb2"},rr=Qe(()=>_("div",{class:"verifyPanel__head verifyPanel__head--bt"},"年度",-1)),ir=Qe(()=>_("div",{class:"verifyPanel__head verifyPanel__head--bt"},"數值",-1)),or=Qe(()=>_("div",{class:"verifyPanel__head"},"前年差",-1)),sr="https://thaubing-esg.gcaa.org.tw/content/company/",ar=2,lr=pe({__name:"VerifyPanel",props:{report:{},reportField:{},fieldMeta:{},curFiledData:{}},setup(n){const e=n,t=T(()=>s.value.length?"歷史資料":"無歷史資料"),r=T(()=>!s.value.length||!e.fieldMeta.defaultUnit?"":` (${e.fieldMeta.defaultUnit})`),i=Ie();function o(f,m){const p=Number.parseFloat(f.value)-Number.parseFloat(m.value);let E="-";return Number.isNaN(p)||(p>0?E=`+${p.toLocaleString()}`:p<0&&(E=`${p.toLocaleString()}`)),E}const s=T(()=>{const f=e.fieldMeta.historyColumnName;if(!f||!i.value)return[];const m=i.value.filter(p=>f===p.項目&&!!p.來自公司報告).sort((p,E)=>E.年份-p.年份).map(p=>({year:p.年份,value:p.數值}));return m.map((p,E)=>{const A={...p,diffLabel:"-"};return E<m.length-1&&(A.diffLabel=o(A,m[E+1])),A}).slice(0,ar)}),a=T(()=>{if(!s.value.length)return[];const f={year:e.report.year,value:er(e.curFiledData,e.fieldMeta),diffLabel:"-"};return f.diffLabel=o(f,s.value[0]),[f,...s.value]}),u=T(()=>({gridTemplateColumns:`1fr repeat(${a.value.length}, 2fr)`}));async function c(){const f=e.report.company.abbreviation,m=`${sr}${f}.csv`,E=await(await fetch(m)).text();i.value=Zn(E,{columns:!0,skip_empty_lines:!0})}function d(f){return e.fieldMeta.dataType==="number"&&typeof f=="string"&&(f=Number.parseFloat(f)),f.toLocaleString()}return ke(()=>{c()}),(f,m)=>(O(),F("div",tr,[_("div",nr,V(g(t))+V(g(r)),1),g(s).length?(O(),F("div",{key:0,class:"verifyPanel__table f6 pb3 relative",style:Be(g(u))},[rr,(O(!0),F(te,null,le(g(a),p=>(O(),F("div",{key:p.year,class:"verifyPanel__cell verifyPanel__cell--bt"},V(p.year),1))),128)),ir,(O(!0),F(te,null,le(g(a),p=>(O(),F("div",{key:p.year,class:"verifyPanel__cell verifyPanel__cell--bt"},V(d(p.value)),1))),128)),or,(O(!0),F(te,null,le(g(a),p=>(O(),F("div",{key:p.year,class:"verifyPanel__cell"},V(p.diffLabel),1))),128))],4)):ue("",!0)]))}});const ur=we(lr,[["__scopeId","data-v-1d18d9e2"]]),fr=n=>(Ne("data-v-1b2898d0"),n=n(),Re(),n),cr={class:"answerPanel"},dr=["onSubmit"],hr={class:"fw5 mb2"},_r={class:"flex items-center mb2"},pr={class:"answerPanel__value flex-auto mr3"},mr=fr(()=>_("span",{class:"f6 mid-gray"}," 數值 ",-1)),gr=["type","step"],wr={key:1,class:"answerPanel__input pv2"},yr={class:"mr2"},vr={class:"answerPanel__unit flex-none"},xr=["value"],br={class:"flex mb2"},Ir={class:"flex-auto mr3"},Er={class:"answerPanel__answerPage flex-none"},Sr={class:"flex justify-between"},Ar=["disabled"],$e="NA",Nr=pe({__name:"AnswerPanel",props:{report:{},reportField:{},fieldMeta:{},focusedPage:{}},emits:["next"],setup(n,{emit:e}){const t=n,{feathers:r,isCollaborator:i}=qe(),o=M({value:"",unit:"",notes:"",pageIndex:0}),s=T(()=>o.value.notes?!0:o.value.value!==""&&(o.value.unit||!c.value)),a=T(()=>{let y="填寫判讀結果";return o.value.value===$e&&(y+=" (已標為無法填答)"),y}),u=new Set(["無",$e]),c=T(()=>t.fieldMeta.units?t.fieldMeta.units.some(y=>!u.has(y)):!1);function d(){o.value.pageIndex=t.focusedPage+p.value}const f={number:"number",string:"text",boolean:"radio"},m=T(()=>f[t.fieldMeta.dataType]||"text"),p=T(()=>t.report.pageOffset||0);let E=0;const A=Gt(),v=Wt();lt(()=>{E=Date.now()}),_e(v,async y=>{y?E=Date.now():await S()}),_e(A,async y=>{y==="hidden"?await S():y==="visible"&&(E=Date.now())});async function S(){if(!i.value)return;const y=Math.round((Date.now()-E)/1e3);await r.app.service("report-field").track({id:t.reportField.id,timeSpentInSeconds:y}),E=Date.now()}jt(()=>t.reportField,y=>{y&&(o.value.value=y.value||"",o.value.unit=y.unit||"",t.fieldMeta.units.length===1&&!o.value.unit&&(o.value.unit=t.fieldMeta.units[0]),o.value.notes=y.notes||"")});async function w(y){y={...y,pageIndex:(y.pageIndex||0)-p.value},await r.app.service("report-field").patch(t.reportField.id,y),await S(),e("next",y)}function I(){w({value:o.value.value.toString(),unit:o.value.unit,notes:o.value.notes,pageIndex:o.value.pageIndex})}function $(){w({value:$e,unit:"",notes:o.value.notes,pageIndex:o.value.pageIndex})}return(y,N)=>{const Y=ur;return O(),F("div",cr,[_("form",{class:"answerPanel__form pb2 mb3 bb b--moon-gray",onSubmit:Mt(I,["prevent"])},[_("div",hr,V(g(a)),1),_("div",_r,[_("div",pr,[mr,g(m)!=="radio"?X((O(),F("input",{key:0,"onUpdate:modelValue":N[0]||(N[0]=x=>g(o).value=x),type:g(m),step:y.fieldMeta.numberStep||1,class:"answerPanel__input",placeholder:"數值"},null,8,gr)),[[Lt,g(o).value,void 0,{trim:!0}]]):(O(),F("div",wr,[_("label",yr,[X(_("input",{"onUpdate:modelValue":N[1]||(N[1]=x=>g(o).value=x),type:"radio",name:"answerValue",value:"是"},null,512),[[We,g(o).value]]),Q(" 是 ")]),_("label",null,[X(_("input",{"onUpdate:modelValue":N[2]||(N[2]=x=>g(o).value=x),type:"radio",name:"answerValue",value:"否"},null,512),[[We,g(o).value]]),Q(" 否 ")])]))]),X(_("label",vr,[Q(" 單位 "),y.fieldMeta.isCustomUnit?X((O(),F("input",{key:0,"onUpdate:modelValue":N[3]||(N[3]=x=>g(o).unit=x),type:"text",class:"answerPanel__input"},null,512)),[[me,g(o).unit]]):X((O(),F("select",{key:1,"onUpdate:modelValue":N[4]||(N[4]=x=>g(o).unit=x),name:"answerUnit",class:"answerPanel__input"},[(O(!0),F(te,null,le(y.fieldMeta.units,x=>(O(),F("option",{key:x,value:x},V(x),9,xr))),128))],512)),[[kt,g(o).unit]])],512),[[ze,g(c)]])]),_("div",br,[_("label",Ir,[Q(" 備註 "),X(_("textarea",{"onUpdate:modelValue":N[5]||(N[5]=x=>g(o).notes=x),class:"answerPanel__input mt1",placeholder:"備註"},null,512),[[me,g(o).notes,void 0,{trim:!0}]])]),_("label",Er,[Q(" 答案頁次 "),_("button",{type:"button",class:"mt1 w-100 f7",onClick:d},"同步頁次"),X(_("input",{"onUpdate:modelValue":N[6]||(N[6]=x=>g(o).pageIndex=x),type:"number",class:"answerPanel__input mt1"},null,512),[[me,g(o).pageIndex]])])]),_("div",Sr,[_("button",{type:"button",class:"answerPanel__submit",onClick:$},"無法填答"),_("button",{type:"submit",disabled:!g(s),class:"answerPanel__submit"},"儲存",8,Ar)])],40,dr),ge(Y,{report:y.report,"report-field":y.reportField,"field-meta":y.fieldMeta,"cur-filed-data":g(o)},null,8,["report","report-field","field-meta","cur-filed-data"])])}}});const Rr=we(Nr,[["__scopeId","data-v-1b2898d0"]]),ye=n=>(Ne("data-v-aaa39382"),n=n(),Re(),n),Or={class:"editorControl"},Fr={class:"ph3"},Cr=ye(()=>_("i",{class:"fa-solid fa-arrow-left mr1"},null,-1)),Pr={class:"editorControl__keepTop mt2 pv2 ph3 mb2 bb b--moon-gray"},Tr={class:"fw6 f4 mv0 black"},$r={class:"ph3"},Dr={class:"gray f6 mt0 pb2 mb3 bb b--moon-gray lh-copy"},Lr={class:"editorControl__keywordSection pb2 mb3"},kr=ye(()=>_("div",{class:"editorControl__keepMiddle fw5 mb1"},"相關關鍵字",-1)),Mr=ye(()=>_("div",{class:"f6 gray"},"點選以下關鍵字，或是自行輸入，就能搜出相關頁面",-1)),Ur={key:0,class:"editorControl__keepBottom pv2 ph3 bt ba b--moon-gray shadow-1 br2"},Br={class:"flex justify-end"},Vr=ye(()=>_("i",{class:"fa-solid fa-eye ml2 f7"},null,-1)),Yr=ye(()=>_("i",{class:"fa-solid fa-eye-slash ml2 f7"},null,-1)),zr={class:"mt2"},qr=pe({__name:"EditorControl",props:{report:{},reportField:{},fieldMeta:{},focusedPage:{}},emits:["page","matched-pages","next","prev","report-field"],setup(n,{emit:e}){const t=n,{isCollaborator:r}=qe(),i=T(()=>({name:"profession-report-reportId",params:{reportId:t.report.id}}));function o(m){e("matched-pages",m)}function s(m){e("page",m)}const a=M(!1);function u(){a.value=!a.value}function c(m){e("report-field",m),d()}function d(){e("next")}function f(){e("prev")}return(m,p)=>{const E=$t,A=cn,v=Rr;return O(),F("div",Or,[_("div",Fr,[ge(E,{class:"flex f6 gray items-center no-underline dim pt3",to:g(i)},{default:Ut(()=>[Cr,Q(V(m.report.company.abbreviation)+" "+V(m.report.year)+" 報告書",1)]),_:1},8,["to"])]),_("div",Pr,[_("h1",Tr,V(m.fieldMeta.name),1)]),_("div",$r,[_("p",Dr,V(m.fieldMeta.description),1),_("div",{class:"flex justify-between items-center mb3 mt2 pb3 bb b--moon-gray"},[_("button",{class:"editorControl__nav",onClick:f},"往上個欄位"),_("button",{class:"editorControl__nav",onClick:d},"往下個欄位")]),_("div",Lr,[kr,Mr,ge(A,{report:m.report,"field-meta":m.fieldMeta,onMatchedPages:o,onPage:s},null,8,["report","field-meta"])])]),g(r)?(O(),F("div",Ur,[_("div",Br,[_("button",{class:"pv2 ph3 ba bg-dark-gray white br2 pointer f6 flex items-baseline",onClick:u},[g(a)?(O(),F(te,{key:0},[Q("展開填答 x 驗證區"),Vr],64)):(O(),F(te,{key:1},[Q("收合填答 x 驗證區"),Yr],64))])]),X(_("div",zr,[ge(v,{report:m.report,"report-field":m.reportField,"field-meta":m.fieldMeta,"focused-page":m.focusedPage,onNext:c},null,8,["report","report-field","field-meta","focused-page"])],512),[[ze,!g(a)]])])):ue("",!0)])}}});const Jr=we(qr,[["__scopeId","data-v-aaa39382"]]),ve=n=>(Ne("data-v-bd879947"),n=n(),Re(),n),jr={class:"reportViewer"},Hr={class:"reportViewer__control pr2"},Qr={class:"bb b--moon-gray flex items-center justify-between pv2"},Gr={class:"flex items-center pl3"},Wr=ve(()=>_("i",{class:"fa-solid fa-plus"},null,-1)),Kr=ve(()=>_("i",{class:"fa-solid fa-minus"},null,-1)),Xr=ve(()=>_("i",{class:"fa-solid fa-arrows-left-right"},null,-1)),Zr=ve(()=>_("i",{class:"fa-solid fa-arrows-up-down"},null,-1)),ei={key:0,class:"reportViewer__content w-100"},ti=["onClick"],ni=ve(()=>_("div",{class:"flex flex-column items-center justify-around h-100 f3 fw6"},[_("div",{class:"reportViewer__maskLabel pv3 ph4 br2"},"設定為第一頁"),_("div",{class:"reportViewer__maskLabel pv3 ph4 br2"},"設定為第一頁"),_("div",{class:"reportViewer__maskLabel pv3 ph4 br2"},"設定為第一頁")],-1)),ri=[ni],De="https://cdn.jsdelivr.net/npm/pdfjs-dist@3.9.179",ii="https://gcaa-static.s3.ap-northeast-3.amazonaws.com/company-report-toolkit",Le=10,oi=100,si=60,it=.1,ot=100,ai=pe({__name:"PdfViewer",props:{page:{default:1},year:{default:2019},report:{},highlight:{default:""},matchedPages:{default(){return[]}}},emits:["view-page","page","reload"],setup(n,{emit:e}){const t=n,r=ut(),{feathers:i,isCollaborator:o}=qe();Bt({link:[{rel:"stylesheet",href:`${De}/web/pdf_viewer.css`}]});const s=M(!1),a=M(void 0),u=M([]),c=M(0),d=Ie({}),f=M([null]),m=M(1),p=M(1),E=T({get(){return p.value+(t.report.pageOffset||0)},set(h){const P=Number.parseInt(h,10)-(t.report.pageOffset||0);At(P)}}),A=T(()=>{const h=t.report.pageOffset||0;return h?`${t.report.totalPages+h} + ${Math.abs(h)}`:t.report.totalPages}),v=M(!1);function S(){t.report.hasSetPageOffset||!o.value?v.value=!1:(v.value=!0,r.add({type:"warning",text:"歡迎光臨，我們先校正報告書的第一頁吧 🍥",duration:5e3}))}const w=()=>{v.value=!v.value},I=T(()=>v.value?"取消設定報告第一頁":"頁次對不上？點此調整");async function $(h){const P=1-h;try{await i.app.service("report").patch(t.report.id,{pageOffset:P}),e("reload"),v.value=!1}catch(D){throw D.message&&r.add({type:"error",text:D.message}),D}}const y=M("fit-width"),N=M({pdfSize:{width:0,height:0},widthScale:0,heightScale:0,customScale:0}),Y=T(()=>{if(!N.value.widthScale||!oe.value)return null;let h=1;switch(y.value){case"custom":h=N.value.customScale;break;case"fit-height":h=N.value.heightScale;break;case"fit-width":default:h=N.value.widthScale}return h=h||1,{scale:h,width:N.value.pdfSize.width*h,height:N.value.pdfSize.height*h}});lt(()=>{fe()}),Vt(()=>{clearTimeout(a.value)});const x=T(()=>f.value[0]&&Y.value),G=T(()=>`${ii}/${t.year}/${t.report.company.id}`),W=T(()=>t.highlight+"");function R(){return!!window&&!!window.pdfjsLib&&!!window.pdfjsViewer}function fe(){a.value=setTimeout(async()=>{const h=R();h?(window.pdfjsLib.GlobalWorkerOptions.workerSrc=`${De}/build/pdf.worker.js`,await Ue()):fe(),s.value=h},oi)}async function b(h){const P=window.pdfjsLib,D=`${De}/cmaps/`,H=h%Le||Le,k=re(h);d.value[k]||(d.value[k]=P.getDocument({url:`${G.value}/${k}.pdf`,cMapUrl:D,cMapPacked:!0,enableXfa:!0}));const q=await d.value[k].promise;return L(q),{document:q,page:H}}async function L(h){if(N.value.widthScale)return;const P=await h.getPage(1),{width:D,height:H}=P.getViewport({scale:1});N.value.pdfSize={width:D,height:H};const k=de.value,q=k.clientWidth,xe=k.clientHeight,Pt=Number.parseInt(getComputedStyle(k).paddingLeft),Tt=q-Pt*2;N.value.widthScale=Tt/D,N.value.heightScale=xe/H}const j=T(()=>{var h,P;return Y.value?{width:`${(h=Y.value)==null?void 0:h.width}px`,height:`${(P=Y.value)==null?void 0:P.height}px`}:{}}),Te=T(()=>j.value.height?{...j.value,marginTop:`-${j.value.height}`}:{});async function U(){const h=await b(1);f.value[0]={pdf:Ie(h)}}function se(){d.value={},f.value=Array(t.report.totalPages).fill(null),y.value="fit-width",N.value.widthScale=0}function re(h){return`${Math.ceil(h/Le)}`.padStart(3,"0")}async function z(h,{forceLoad:P=!1,anchor:D=0}={}){if(!P&&u.value.length){u.value.includes(h)||u.value.unshift(h);return}const H=h-1;if(H>=f.value.length)throw new Error(`Invalid page number: ${h}`);if(P||(u.value.push(h),D&&(c.value=D)),!f.value[H]){const k=await b(h);f.value[H]={pdf:Ie(k),highlight:t.matchedPages.includes(h)?W.value:""}}u.value.pop(),u.value.length?z(u.value[0],{forceLoad:!0}):setTimeout(()=>{c.value=0},ot)}const ce=Ee.debounce(h=>{z(h)},100),oe=Kt(),de=M(null);Ht(()=>G.value&&!s.value&&!oe.value,()=>{se(),U(),S()});function St(h){const D=de.value.querySelectorAll(".reportViewer__page")[h-1];return D==null?void 0:D.offsetTop}function At(h){h<1||h>t.report.totalPages||Number.isNaN(h)||(Ge(h),e("page",h))}async function Ge(h){const P=St(h),D=z(h,{anchor:P});h>1&&z(h-1),h<t.report.totalPages&&z(h+1),P&&de.value.scrollTo({top:P}),await D,p.value=h}_e(()=>t.page,async()=>{await Ge(t.page)});function Nt(){var h;N.value.customScale=(((h=Y.value)==null?void 0:h.scale)||1)*(1+it),y.value="custom"}function Rt(){var h;N.value.customScale=(((h=Y.value)==null?void 0:h.scale)||1)*(1-it),y.value="custom"}function Ot(){y.value="fit-width"}function Ft(){y.value="fit-height"}_e(Y,async(h,P)=>{if(!h||!P||!de.value)return;const D=de.value,H=D.clientHeight/2,k=(D.scrollTop+H)/D.scrollHeight;await Ue();const q=D.scrollHeight*k-H;c.value=q,setTimeout(()=>{c.value=0},ot)});const Ct=Ee.debounce(h=>{h!==m.value&&(p.value=m.value,m.value=h,e("view-page",p.value))},si);return(h,P)=>{const D=Xt,H=Zt;return O(),F("div",jr,[_("div",Hr,[_("div",Qr,[_("div",Gr,[X(_("input",{class:"reportViewer__pageInput b--moon-gray ba ph1 mr1","onUpdate:modelValue":P[0]||(P[0]=k=>at(E)?E.value=k:null),onKeyup:P[1]||(P[1]=Yt(k=>k.target.blur(),["enter"]))},null,544),[[me,g(E),void 0,{lazy:!0}]]),Q("頁 / 共 "+V(g(A))+" 頁",1),g(o)?(O(),F("button",{key:0,class:"reportViewer__button ml2 gray",onClick:w},V(g(I)),1)):ue("",!0)]),_("div",{class:"flex items-center"},[_("button",{class:"reportViewer__button",onClick:Nt},[Wr,Q("放大")]),_("button",{class:"reportViewer__button",onClick:Rt},[Kr,Q("縮小")]),_("button",{class:"reportViewer__button",onClick:Ot},[Xr,Q("滿頁寬")]),_("button",{class:"reportViewer__button",onClick:Ft},[Zr,Q("滿頁高")])])])]),_("div",{class:"reportViewer__scrollContainer relative",ref_key:"scrollerEle",ref:de},[g(x)?(O(),F("div",ei,[(O(!0),F(te,null,le(g(f),(k,q)=>(O(),F(te,{key:q},[k?(O(),Ve(H,zt({key:1,class:"reportViewer__page"},k.pdf,{class:[`thePage--${q+1}`],highlight:k.highlight,"page-anchor":g(c),scale:g(Y).scale,onVisible:xe=>g(Ct)(q+1)}),null,16,["class","highlight","page-anchor","scale","onVisible"])):(O(),Ve(D,{key:0,class:Me(["reportViewer__page",[`theEmpty--${q+1}`]]),style:Be(g(j)),"page-number":q+1,onVisible:xe=>g(ce)(q+1)},null,8,["style","class","page-number","onVisible"])),g(v)?(O(),F("div",{key:2,class:"reportViewer__page reportViewer__page--mask center pointer",style:Be(g(Te)),onClick:xe=>$(q+1)},ri,12,ti)):ue("",!0)],64))),128))])):ue("",!0)],512)])}}});const li=we(ai,[["__scopeId","data-v-bd879947"]]),ui={key:0,class:"editor"},fi={class:"editor__viewer"},st="看完收工！ 🎉 找找頁面左上角，就能回上一層",ci=5,wi=pe({__name:"[reportId]",setup(n){const e=qt(),t=T(()=>Number.parseInt(e.params.reportId)),{report:r,reportFieldList:i,isDataReady:o,meta:s}=en(t.value),a=T(()=>Number.parseInt(e.query.fieldId)),u=T(()=>i.value.find(G=>G.id===a.value)||i.value[0]),c=ut();function d(x){Object.keys(x).forEach(W=>{u.value[W]=x[W]});const G=m.value===st?8e3:4e3;c.add({type:"success",duration:G,text:m.value})}const f=T(()=>s(u.value)),m=T(()=>{const x=i.value.filter(R=>!!R.value).length,G=i.value.length,W=G-x;return W?W<=ci?`最後 ${W} 個欄位！ 🧙`:`已完成 ${x} / ${G} 個欄位 🤖`:st}),p=M({page:1,highlight:""}),E=M([]),A=M(0);function v(x){A.value=x}function S(x){p.value=x}function w(x){E.value=x}const I=Jt(),$=T(()=>i.value.findIndex(x=>x.id===a.value));function y(){let x=$.value+1;x===i.value.length&&(x=0),I.push({name:"profession-editor-reportId",params:{reportId:t.value},query:{fieldId:i.value[x].id}})}function N(){let x=$.value-1;x<0&&(x=i.value.length-1),I.push({name:"profession-editor-reportId",params:{reportId:t.value},query:{fieldId:i.value[x].id}})}function Y(){window.location.reload()}return(x,G)=>{const W=Jr,R=li;return g(o)?(O(),F("div",ui,[ge(W,{class:"editor__control br b--moon-gray",report:g(r),"report-field":g(u),"field-meta":g(f),"focused-page":g(A),onPage:S,onMatchedPages:w,onNext:y,onPrev:N,onReportField:d},null,8,["report","report-field","field-meta","focused-page"]),_("div",fi,[g(p)?(O(),Ve(R,{key:0,year:g(r).year,report:g(r),page:g(p).page,highlight:g(p).highlight,"matched-pages":g(E),onViewPage:v,onReload:Y},null,8,["year","report","page","highlight","matched-pages"])):ue("",!0)])])):ue("",!0)}}});export{wi as default};
