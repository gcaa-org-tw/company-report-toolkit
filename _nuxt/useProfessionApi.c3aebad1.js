var er=Object.defineProperty;var tr=(r,e,t)=>e in r?er(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var N=(r,e,t)=>(tr(r,typeof e!="symbol"?e+"":e,t),t);import{r as z,k as ue,g as De,h as re,P as rr,l as Xe,m as pt}from"./entry.bac27b46.js";import{c as _,g as yt,a as nr,_ as sr}from"./lodash.c5f1a86c.js";var Ae={exports:{}},$={},R={};Object.defineProperty(R,"__esModule",{value:!0});R.createDebug=R.setDebug=R.noopDebug=void 0;const G={};function gt(){return function(){}}R.noopDebug=gt;let mt=gt;function ir(r){mt=r,Object.keys(G).forEach(e=>{G[e]=r(e)})}R.setDebug=ir;function or(r){return G[r]||(G[r]=mt(r)),(...e)=>G[r](...e)}R.createDebug=or;(function(r){var e=_&&_.__createBinding||(Object.create?function(i,c,a,u){u===void 0&&(u=a);var h=Object.getOwnPropertyDescriptor(c,a);(!h||("get"in h?!c.__esModule:h.writable||h.configurable))&&(h={enumerable:!0,get:function(){return c[a]}}),Object.defineProperty(i,u,h)}:function(i,c,a,u){u===void 0&&(u=a),i[u]=c[a]}),t=_&&_.__exportStar||function(i,c){for(var a in i)a!=="default"&&!Object.prototype.hasOwnProperty.call(c,a)&&e(c,i,a)};Object.defineProperty(r,"__esModule",{value:!0}),r.createSymbol=r.isPromise=r._=r.stripSlashes=void 0;function n(i){return i.replace(/^(\/+)|(\/+)$/g,"")}r.stripSlashes=n,r._={each(i,c){i&&typeof i.forEach=="function"?i.forEach(c):r._.isObject(i)&&Object.keys(i).forEach(a=>c(i[a],a))},some(i,c){return Object.keys(i).map(a=>[i[a],a]).some(([a,u])=>c(a,u))},every(i,c){return Object.keys(i).map(a=>[i[a],a]).every(([a,u])=>c(a,u))},keys(i){return Object.keys(i)},values(i){return r._.keys(i).map(c=>i[c])},isMatch(i,c){return r._.keys(c).every(a=>i[a]===c[a])},isEmpty(i){return r._.keys(i).length===0},isObject(i){return typeof i=="object"&&!Array.isArray(i)&&i!==null},isObjectOrArray(i){return typeof i=="object"&&i!==null},extend(i,...c){return Object.assign(i,...c)},omit(i,...c){const a=r._.extend({},i);return c.forEach(u=>delete a[u]),a},pick(i,...c){return c.reduce((a,u)=>(i[u]!==void 0&&(a[u]=i[u]),a),{})},merge(i,c){return r._.isObject(i)&&r._.isObject(c)&&Object.keys(c).forEach(a=>{r._.isObject(c[a])?(i[a]||Object.assign(i,{[a]:{}}),r._.merge(i[a],c[a])):Object.assign(i,{[a]:c[a]})}),i}};function s(i){return r._.isObject(i)&&typeof i.then=="function"}r.isPromise=s;function o(i){return typeof Symbol<"u"?Symbol.for(i):i}r.createSymbol=o,t(R,r)})($);var he={};Object.defineProperty(he,"__esModule",{value:!0});he.default="5.0.11";var fe={},qe={exports:{}},D=typeof Reflect=="object"?Reflect:null,xe=D&&typeof D.apply=="function"?D.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)},ne;D&&typeof D.ownKeys=="function"?ne=D.ownKeys:Object.getOwnPropertySymbols?ne=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:ne=function(e){return Object.getOwnPropertyNames(e)};function ar(r){console&&console.warn&&console.warn(r)}var vt=Number.isNaN||function(e){return e!==e};function v(){v.init.call(this)}qe.exports=v;qe.exports.once=fr;v.EventEmitter=v;v.prototype._events=void 0;v.prototype._eventsCount=0;v.prototype._maxListeners=void 0;var Qe=10;function le(r){if(typeof r!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r)}Object.defineProperty(v,"defaultMaxListeners",{enumerable:!0,get:function(){return Qe},set:function(r){if(typeof r!="number"||r<0||vt(r))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+r+".");Qe=r}});v.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};v.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||vt(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function bt(r){return r._maxListeners===void 0?v.defaultMaxListeners:r._maxListeners}v.prototype.getMaxListeners=function(){return bt(this)};v.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var s=e==="error",o=this._events;if(o!==void 0)s=s&&o.error===void 0;else if(!s)return!1;if(s){var i;if(t.length>0&&(i=t[0]),i instanceof Error)throw i;var c=new Error("Unhandled error."+(i?" ("+i.message+")":""));throw c.context=i,c}var a=o[e];if(a===void 0)return!1;if(typeof a=="function")xe(a,this,t);else for(var u=a.length,h=kt(a,u),n=0;n<u;++n)xe(h[n],this,t);return!0};function _t(r,e,t,n){var s,o,i;if(le(t),o=r._events,o===void 0?(o=r._events=Object.create(null),r._eventsCount=0):(o.newListener!==void 0&&(r.emit("newListener",e,t.listener?t.listener:t),o=r._events),i=o[e]),i===void 0)i=o[e]=t,++r._eventsCount;else if(typeof i=="function"?i=o[e]=n?[t,i]:[i,t]:n?i.unshift(t):i.push(t),s=bt(r),s>0&&i.length>s&&!i.warned){i.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+i.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=r,c.type=e,c.count=i.length,ar(c)}return r}v.prototype.addListener=function(e,t){return _t(this,e,t,!1)};v.prototype.on=v.prototype.addListener;v.prototype.prependListener=function(e,t){return _t(this,e,t,!0)};function cr(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function wt(r,e,t){var n={fired:!1,wrapFn:void 0,target:r,type:e,listener:t},s=cr.bind(n);return s.listener=t,n.wrapFn=s,s}v.prototype.once=function(e,t){return le(t),this.on(e,wt(this,e,t)),this};v.prototype.prependOnceListener=function(e,t){return le(t),this.prependListener(e,wt(this,e,t)),this};v.prototype.removeListener=function(e,t){var n,s,o,i,c;if(le(t),s=this._events,s===void 0)return this;if(n=s[e],n===void 0)return this;if(n===t||n.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete s[e],s.removeListener&&this.emit("removeListener",e,n.listener||t));else if(typeof n!="function"){for(o=-1,i=n.length-1;i>=0;i--)if(n[i]===t||n[i].listener===t){c=n[i].listener,o=i;break}if(o<0)return this;o===0?n.shift():ur(n,o),n.length===1&&(s[e]=n[0]),s.removeListener!==void 0&&this.emit("removeListener",e,c||t)}return this};v.prototype.off=v.prototype.removeListener;v.prototype.removeAllListeners=function(e){var t,n,s;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[e]),this;if(arguments.length===0){var o=Object.keys(n),i;for(s=0;s<o.length;++s)i=o[s],i!=="removeListener"&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=n[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(s=t.length-1;s>=0;s--)this.removeListener(e,t[s]);return this};function Ot(r,e,t){var n=r._events;if(n===void 0)return[];var s=n[e];return s===void 0?[]:typeof s=="function"?t?[s.listener||s]:[s]:t?hr(s):kt(s,s.length)}v.prototype.listeners=function(e){return Ot(this,e,!0)};v.prototype.rawListeners=function(e){return Ot(this,e,!1)};v.listenerCount=function(r,e){return typeof r.listenerCount=="function"?r.listenerCount(e):Et.call(r,e)};v.prototype.listenerCount=Et;function Et(r){var e=this._events;if(e!==void 0){var t=e[r];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}v.prototype.eventNames=function(){return this._eventsCount>0?ne(this._events):[]};function kt(r,e){for(var t=new Array(e),n=0;n<e;++n)t[n]=r[n];return t}function ur(r,e){for(;e+1<r.length;e++)r[e]=r[e+1];r.pop()}function hr(r){for(var e=new Array(r.length),t=0;t<e.length;++t)e[t]=r[t].listener||r[t];return e}function fr(r,e){return new Promise(function(t,n){function s(i){r.removeListener(e,o),n(i)}function o(){typeof r.removeListener=="function"&&r.removeListener("error",s),t([].slice.call(arguments))}At(r,e,o,{once:!0}),e!=="error"&&lr(r,s,{once:!0})})}function lr(r,e,t){typeof r.on=="function"&&At(r,"error",e,t)}function At(r,e,t,n){if(typeof r.on=="function")n.once?r.once(e,t):r.on(e,t);else if(typeof r.addEventListener=="function")r.addEventListener(e,function s(o){n.once&&r.removeEventListener(e,s),t(o)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof r)}var Fe=qe.exports,$e={},ce={},T={};Object.defineProperty(T,"__esModule",{value:!0});T.copyFnProperties=T.copyProperties=void 0;function dr(r,...e){for(const t of e){const n=Object.keys(t).concat(Object.getOwnPropertySymbols(t));for(const s of n){const o=Object.getOwnPropertyDescriptor(t,s);o&&!Object.prototype.hasOwnProperty.call(r,s)&&Object.defineProperty(r,s,o)}}return r}T.copyProperties=dr;function pr(r,e){const t=["name","length"];try{for(const n of t){const s=e[n];Object.defineProperty(r,n,{value:s})}}catch{}return r}T.copyFnProperties=pr;(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.setMiddleware=r.getMiddleware=r.setManager=r.getManager=r.convertOptions=r.HookManager=r.BaseHookContext=r.HOOKS=void 0;const e=T;r.HOOKS=Symbol("@feathersjs/hooks");class t{constructor(h={}){Object.defineProperty(this,"self",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.assign(this,h)}toJSON(){const h=Object.keys(this);let f=Object.getPrototypeOf(this);for(;f;)h.push(...Object.keys(f)),f=Object.getPrototypeOf(f);return h.reduce((l,d)=>(l[d]=this[d],l),{})}}r.BaseHookContext=t;class n{constructor(){Object.defineProperty(this,"_parent",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"_params",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"_middleware",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"_props",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"_defaults",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}parent(h){return this._parent=h,this}middleware(h){return this._middleware=h!=null&&h.length?h:null,this}getMiddleware(){var f;const h=(f=this._parent)==null?void 0:f.getMiddleware();return h&&this._middleware?h.concat(this._middleware):h||this._middleware}collectMiddleware(h,f){const l=c(h),d=this.getMiddleware();return l&&d?l.concat(d):l||d||[]}props(h){return this._props||(this._props={}),(0,e.copyProperties)(this._props,h),this}getProps(){var f;const h=(f=this._parent)==null?void 0:f.getProps();return h&&this._props?(0,e.copyProperties)({},h,this._props):h||this._props||null}params(...h){return this._params=h,this}getParams(){var f;const h=(f=this._parent)==null?void 0:f.getParams();return h&&this._params?h.concat(this._params):h||this._params}defaults(h){return this._defaults=h,this}getDefaults(h,f,l){var E;const d=typeof this._defaults=="function"?this._defaults(h,f,l):null,g=(E=this._parent)==null?void 0:E.getDefaults(h,f,l);return g&&d?Object.assign({},g,d):g||d}getContextClass(h=t){const f=class extends h{constructor(E){super(E)}},l=this.getParams(),d=this.getProps();return l&&l.forEach((g,E)=>{if((d==null?void 0:d[g])!==void 0)throw new Error(`Hooks can not have a property and param named '${g}'. Use .defaults instead.`);Object.defineProperty(f.prototype,g,{enumerable:!0,get(){return this==null?void 0:this.arguments[E]},set(V){this.arguments[E]=V}})}),d&&(0,e.copyProperties)(f.prototype,d),f}initializeContext(h,f,l){const d=this._parent?this._parent.initializeContext(h,f,l):l,g=this.getDefaults(h,f,d);if(h&&(d.self=h),d.arguments=f,g)for(const E of Object.keys(g))d[E]===void 0&&(d[E]=g[E]);return d}}r.HookManager=n;function s(u=null){return u?Array.isArray(u)?new n().middleware(u):u:new n}r.convertOptions=s;function o(u){return u&&u[r.HOOKS]||null}r.getManager=o;function i(u,h){const f=o(u);return u[r.HOOKS]=h.parent(f),u}r.setManager=i;function c(u){const h=o(u);return h?h.getMiddleware():null}r.getMiddleware=c;function a(u,h){const f=new n().middleware(h);return i(u,f)}r.setMiddleware=a})(ce);var S={},I={};Object.defineProperty(I,"__esModule",{value:!0});I.compose=void 0;function yr(r){if(!Array.isArray(r))throw new TypeError("Middleware stack must be an array!");for(const e of r)if(typeof e!="function")throw new TypeError("Middleware must be composed of functions!");return function(e,t){let n=-1;return s.call(this,0);function s(o){if(o<=n)return Promise.reject(new Error("next() called multiple times"));n=o;let i=r[o];if(o===r.length&&(i=t),!i)return Promise.resolve();try{return Promise.resolve(i.call(this,e,s.bind(this,o+1)))}catch(c){return Promise.reject(c)}}}}I.compose=yr;Object.defineProperty(S,"__esModule",{value:!0});S.hookDecorator=S.objectHooks=S.functionHooks=S.getOriginal=void 0;const gr=I,q=ce,Ze=T;function Ie(r){return typeof r.original=="function"?Ie(r.original):r}S.getOriginal=Ie;function Ue(r,e){if(typeof r!="function")throw new Error("Can not apply hooks to non-function");const t=(0,q.convertOptions)(e),n=function(...s){const{Context:o,original:i}=n,c=s[s.length-1]instanceof o,a=c?s.pop():new o,u=t.initializeContext(this,s,a),h=[(l,d)=>d().then(()=>c?l:l.result)],f=t.collectMiddleware(this,s);return f&&Array.prototype.push.apply(h,f),h.push((l,d)=>Object.prototype.hasOwnProperty.call(u,"result")?d():Promise.resolve(i.apply(this,l.arguments)).then(g=>(l.result=g,d()))),(0,gr.compose)(h).call(this,u)};return(0,Ze.copyFnProperties)(n,r),(0,Ze.copyProperties)(n,r),(0,q.setManager)(n,t),Object.assign(n,{original:Ie(r),Context:t.getContextClass(),createContext:(s={})=>new n.Context(s)})}S.functionHooks=Ue;function mr(r,e){if(Array.isArray(e))return(0,q.setMiddleware)(r,e);for(const t of Object.keys(e)){const n=typeof r[t]=="function"?r:r.prototype,s=n&&n[t];if(typeof s!="function")throw new Error(`Can not apply hooks. '${t}' is not a function`);const o=(0,q.convertOptions)(e[t]);n[t]=Ue(s,o.props({method:t}))}return r}S.objectHooks=mr;const vr=r=>(t,n,s)=>{const o=(0,q.convertOptions)(r);if(!s)return(0,q.setManager)(t.prototype,o),t;const i=s.value;if(typeof i!="function")throw new Error(`Can not apply hooks. '${n}' is not a function`);return s.value=Ue(i,o.props({method:n})),s};S.hookDecorator=vr;var St={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.collect=r.fromErrorHook=r.fromAfterHook=r.fromBeforeHook=r.runHooks=r.runHook=void 0;const e=I,t=(a,u,h)=>{const f=u.type;return h&&(u.type=h),Promise.resolve(a.call(u.self,u)).then(l=>{h&&(u.type=f),l&&l!==u&&Object.assign(u,l)})};r.runHook=t;const n=a=>u=>a.reduce((h,f)=>h.then(()=>(0,r.runHook)(f,u)),Promise.resolve(u));r.runHooks=n;function s(a){return(u,h)=>(0,r.runHook)(a,u,"before").then(h)}r.fromBeforeHook=s;function o(a){return(u,h)=>h().then(()=>(0,r.runHook)(a,u,"after"))}r.fromAfterHook=o;function i(a){return(u,h)=>h().catch(f=>((u.error!==f||u.result!==void 0)&&(u.original={...u},u.error=f,delete u.result),(0,r.runHook)(a,u,"error").then(()=>{if(u.result===void 0&&u.error!==void 0)throw u.error}).catch(l=>{throw u.error=l,u.error})))}r.fromErrorHook=i;function c({before:a=[],after:u=[],error:h=[]}){const f=a.map(s),l=[...u].reverse().map(o),d=h.length?[i((0,r.runHooks)(h))]:[];return(0,e.compose)([...d,...f,...l])}r.collect=c})(St);(function(r){var e=_&&_.__createBinding||(Object.create?function(c,a,u,h){h===void 0&&(h=u),Object.defineProperty(c,h,{enumerable:!0,get:function(){return a[u]}})}:function(c,a,u,h){h===void 0&&(h=u),c[h]=a[u]}),t=_&&_.__exportStar||function(c,a){for(var u in c)u!=="default"&&!Object.prototype.hasOwnProperty.call(a,u)&&e(a,c,u)};Object.defineProperty(r,"__esModule",{value:!0}),r.hooks=r.middleware=void 0;const n=ce,s=S;t(S,r),t(I,r),t(ce,r),t(St,r);function o(c,a){const u=new n.HookManager().middleware(c);return a&&(a.params&&u.params(...a.params),a.defaults&&u.defaults(a.defaults),a.props&&u.props(a.props)),u}r.middleware=o;function i(...c){const[a,u]=c;return typeof a=="function"&&(u instanceof n.HookManager||Array.isArray(u)||c.length===1)?(0,s.functionHooks)(a,u):c.length===2?(0,s.objectHooks)(a,u):(0,s.hookDecorator)(a)}r.hooks=i})($e);var F={},Y={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.wrapService=r.normalizeServiceOptions=r.getServiceOptions=r.getHookMethods=r.protectedMethods=r.defaultServiceEvents=r.defaultEventMap=r.defaultServiceMethods=r.defaultServiceArguments=r.SERVICE=void 0;const e=Fe,t=$;r.SERVICE=(0,t.createSymbol)("@feathersjs/service"),r.defaultServiceArguments={find:["params"],get:["id","params"],create:["data","params"],update:["id","data","params"],patch:["id","data","params"],remove:["id","params"]},r.defaultServiceMethods=["find","get","create","update","patch","remove"],r.defaultEventMap={create:"created",update:"updated",patch:"patched",remove:"removed"},r.defaultServiceEvents=Object.values(r.defaultEventMap),r.protectedMethods=Object.keys(Object.prototype).concat(Object.keys(e.EventEmitter.prototype)).concat(["all","around","before","after","error","hooks","setup","teardown","publish"]);function n(c,a){const{methods:u}=a;return r.defaultServiceMethods.filter(h=>typeof c[h]=="function"&&!u.includes(h)).concat(u)}r.getHookMethods=n;function s(c){return c[r.SERVICE]}r.getServiceOptions=s;const o=(c,a={})=>{const{methods:u=r.defaultServiceMethods.filter(l=>typeof c[l]=="function"),events:h=c.events||[]}=a,f=a.serviceEvents||r.defaultServiceEvents.concat(h);return{...a,events:h,methods:u,serviceEvents:f}};r.normalizeServiceOptions=o;function i(c,a,u){if(a[r.SERVICE])return a;const h=Object.create(a),f=(0,r.normalizeServiceOptions)(a,u);if(Object.keys(f.methods).length===0&&![...r.defaultServiceMethods,"setup","teardown"].some(l=>typeof a[l]=="function"))throw new Error(`Invalid service object passed for path \`${c}\``);return Object.defineProperty(h,r.SERVICE,{value:f}),h}r.wrapService=i})(Y);Object.defineProperty(F,"__esModule",{value:!0});F.eventMixin=F.eventHook=void 0;const br=Fe,et=Y;function _r(r,e){const{events:t}=(0,et.getServiceOptions)(r.self),n=et.defaultEventMap[r.method]||null;return r.event=n,e().then(()=>{typeof r.event=="string"&&!t.includes(r.event)&&(Array.isArray(r.result)?r.result:[r.result]).forEach(o=>r.self.emit(r.event,o,r))})}F.eventHook=_r;function wr(r){return typeof r.on=="function"&&typeof r.emit=="function"||Object.assign(r,br.EventEmitter.prototype),r}F.eventMixin=wr;var O={};Object.defineProperty(O,"__esModule",{value:!0});O.hookMixin=O.FeathersHookManager=O.createContext=O.enableHooks=O.collectHooks=O.convertHookData=void 0;const L=$e,tt=Y,Or=["before","after","error","around"],Er=r=>Or.includes(r);function Ct(r){const e={};if(Array.isArray(r))e.all=r;else if(typeof r!="object")e.all=[r];else for(const t of Object.keys(r)){const n=r[t];e[t]=Array.isArray(n)?n:[n]}return e}O.convertHookData=Ct;function Se(r,e){const{collected:t,collectedAll:n,around:s}=r.__hooks;return[...s.all||[],...s[e]||[],...n.before||[],...t[e]||[],...n.after||[]]}O.collectHooks=Se;function Pt(r){return Object.defineProperty(r,"__hooks",{configurable:!0,value:{around:{},before:{},after:{},error:{},collected:{},collectedAll:{}},writable:!0}),function(n){const s=this.__hooks,o=Object.keys(n).reduce((c,a)=>{if(!Er(a))throw new Error(`'${a}' is not a valid hook type`);return c[a]=Ct(n[a]),c},{});return Object.keys(o).forEach(c=>Object.keys(o[c]).forEach(a=>{var u;const h=o[c][a];if(((u=s[c])[a]||(u[a]=[])).push(...h),a==="all"){if(s.before[a]||s.error[a]){const l=(0,L.collect)({before:s.before[a]||[],error:s.error[a]||[]});s.collectedAll.before=[l]}if(s.after[a]){const l=(0,L.collect)({after:s.after[a]||[]});s.collectedAll.after=[l]}}else if(s.before[a]||s.after[a]||s.error[a]){const l=(0,L.collect)({before:s.before[a]||[],after:s.after[a]||[],error:s.error[a]||[]});s.collected[a]=[l]}})),this}}O.enableHooks=Pt;function kr(r,e,t={}){const n=r[e].createContext;if(typeof n!="function")throw new Error(`Can not create context for method ${e}`);return n(t)}O.createContext=kr;class Ce extends L.HookManager{constructor(e,t){super(),this.app=e,this.method=t,this._middleware=[]}collectMiddleware(e,t){const n=Se(this.app,this.method),s=super.collectMiddleware(e,t),o=Se(e,this.method);return[...n,...s,...o]}initializeContext(e,t,n){const s=super.initializeContext(e,t,n);return s.params=s.params||{},s}middleware(e){return this._middleware.push(...e),this}}O.FeathersHookManager=Ce;function Ar(r,e,t){if(typeof r.hooks=="function")return r;const s=(0,tt.getHookMethods)(r,t).reduce((i,c)=>{const a=tt.defaultServiceArguments[c]||["data","params"];return i[c]=new Ce(this,c).params(...a).props({app:this,path:e,method:c,service:r,event:null,type:"around",get statusCode(){var u;return(u=this.http)===null||u===void 0?void 0:u.status},set statusCode(u){this.http=this.http||{},this.http.status=u}}),i},{}),o=Pt(r);return(0,L.hooks)(r,s),r.hooks=function(i){return i.before||i.after||i.error||i.around?o.call(this,i):Array.isArray(i)?(0,L.hooks)(this,i):(Object.keys(i).forEach(c=>{const a=(0,L.getManager)(this[c]);if(!(a instanceof Ce))throw new Error(`Method ${c} is not a Feathers hooks enabled service method`);a.middleware(i[c])}),this)},r}O.hookMixin=Ar;var Sr=_&&_.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(fe,"__esModule",{value:!0});fe.Feathers=void 0;const Cr=Sr(he),Pr=Fe,se=$,M=$e,rt=F,Rr=O,we=Y,Mr=O,x=(0,se.createDebug)("@feathersjs/feathers");class Lr extends Pr.EventEmitter{constructor(){super(),this.services={},this.settings={},this.mixins=[Rr.hookMixin,rt.eventMixin],this.version=Cr.default,this._isSetup=!1,this.registerHooks=(0,Mr.enableHooks)(this),this.registerHooks({around:[rt.eventHook]})}get(e){return this.settings[e]}set(e,t){return this.settings[e]=t,this}configure(e){return e.call(this,this),this}defaultService(e){throw new Error(`Can not find service '${e}'`)}service(e){const t=(0,se.stripSlashes)(e)||"/",n=this.services.hasOwnProperty(t)?this.services[t]:void 0;return typeof n>"u"?(this.use(t,this.defaultService(t)),this.service(t)):n}_setup(){return this._isSetup=!0,Object.keys(this.services).reduce((e,t)=>e.then(()=>{const n=this.service(t);if(typeof n.setup=="function")return x(`Setting up service for \`${t}\``),n.setup(this,t)}),Promise.resolve()).then(()=>this)}get setup(){return this._setup}set setup(e){this._setup=e[M.HOOKS]?e:(0,M.hooks)(e,(0,M.middleware)().params("server").props({app:this}))}_teardown(){return this._isSetup=!1,Object.keys(this.services).reduce((e,t)=>e.then(()=>{const n=this.service(t);if(typeof n.teardown=="function")return x(`Tearing down service for \`${t}\``),n.teardown(this,t)}),Promise.resolve()).then(()=>this)}get teardown(){return this._teardown}set teardown(e){this._teardown=e[M.HOOKS]?e:(0,M.hooks)(e,(0,M.middleware)().params("server").props({app:this}))}use(e,t,n){if(typeof e!="string")throw new Error(`'${e}' is not a valid service path.`);const s=(0,se.stripSlashes)(e)||"/",o=t;if(typeof o.service=="function"&&o.services)return Object.keys(o.services).forEach(u=>this.use(`${s}/${u}`,o.service(u))),this;const c=(0,we.wrapService)(s,t,n),a=(0,we.getServiceOptions)(c);for(const u of we.protectedMethods)if(a.methods.includes(u))throw new Error(`'${u}' on service '${s}' is not allowed as a custom method name`);return x(`Registering new service at \`${s}\``),this.mixins.forEach(u=>u.call(this,c,s,a)),this.services[s]=c,this._isSetup&&typeof c.setup=="function"&&(x(`Setting up service for \`${s}\``),c.setup(this,s)),this}async unuse(e){const t=(0,se.stripSlashes)(e)||"/",n=this.services[t];return n&&typeof n.teardown=="function"&&await n.teardown(this,t),delete this.services[t],n}hooks(e){const t=e;return t.before||t.after||t.error||t.around?this.registerHooks(t):t.setup||t.teardown?(0,M.hooks)(this,t):this.registerHooks({around:t}),this}}fe.Feathers=Lr;var Rt={};Object.defineProperty(Rt,"__esModule",{value:!0});(function(r,e){var t=_&&_.__createBinding||(Object.create?function(u,h,f,l){l===void 0&&(l=f);var d=Object.getOwnPropertyDescriptor(h,f);(!d||("get"in d?!h.__esModule:d.writable||d.configurable))&&(d={enumerable:!0,get:function(){return h[f]}}),Object.defineProperty(u,l,d)}:function(u,h,f,l){l===void 0&&(l=f),u[l]=h[f]}),n=_&&_.__exportStar||function(u,h){for(var f in u)f!=="default"&&!Object.prototype.hasOwnProperty.call(h,f)&&t(h,u,f)},s=_&&_.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(e,"__esModule",{value:!0}),e.Feathers=e.version=e.feathers=void 0;const o=$,i=s(he);e.version=i.default;const c=fe;Object.defineProperty(e,"Feathers",{enumerable:!0,get:function(){return c.Feathers}});function a(){return new c.Feathers}e.feathers=a,a.setDebug=o.setDebug,n(O,e),n(Rt,e),n(Y,e),r.exports=Object.assign(a,r.exports)})(Ae,Ae.exports);var Mt=Ae.exports,Pe={exports:{}},de={},Ve={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.convert=r.errors=r.Unavailable=r.BadGateway=r.NotImplemented=r.GeneralError=r.TooManyRequests=r.Unprocessable=r.LengthRequired=r.Gone=r.Conflict=r.Timeout=r.NotAcceptable=r.MethodNotAllowed=r.NotFound=r.Forbidden=r.PaymentError=r.NotAuthenticated=r.BadRequest=r.FeathersError=void 0;class e extends Error{constructor(p,y,Jt,Xt,J){let _e=typeof p=="string"?p:"Error";const X={name:y,code:Jt,className:Xt,type:"FeathersError"};if(Array.isArray(J))X.data=J;else if(typeof p=="object"||J!==void 0){const{message:xt,errors:Qt,...Zt}=p!==null&&typeof p=="object"?p:J;_e=xt||_e,X.errors=Qt,X.data=Zt}super(_e),Object.assign(this,X)}toJSON(){const p={name:this.name,message:this.message,code:this.code,className:this.className};return this.data!==void 0&&(p.data=this.data),this.errors!==void 0&&(p.errors=this.errors),p}}r.FeathersError=e;class t extends e{constructor(p,y){super(p,"BadRequest",400,"bad-request",y)}}r.BadRequest=t;class n extends e{constructor(p,y){super(p,"NotAuthenticated",401,"not-authenticated",y)}}r.NotAuthenticated=n;class s extends e{constructor(p,y){super(p,"PaymentError",402,"payment-error",y)}}r.PaymentError=s;class o extends e{constructor(p,y){super(p,"Forbidden",403,"forbidden",y)}}r.Forbidden=o;class i extends e{constructor(p,y){super(p,"NotFound",404,"not-found",y)}}r.NotFound=i;class c extends e{constructor(p,y){super(p,"MethodNotAllowed",405,"method-not-allowed",y)}}r.MethodNotAllowed=c;class a extends e{constructor(p,y){super(p,"NotAcceptable",406,"not-acceptable",y)}}r.NotAcceptable=a;class u extends e{constructor(p,y){super(p,"Timeout",408,"timeout",y)}}r.Timeout=u;class h extends e{constructor(p,y){super(p,"Conflict",409,"conflict",y)}}r.Conflict=h;class f extends e{constructor(p,y){super(p,"Gone",410,"gone",y)}}r.Gone=f;class l extends e{constructor(p,y){super(p,"LengthRequired",411,"length-required",y)}}r.LengthRequired=l;class d extends e{constructor(p,y){super(p,"Unprocessable",422,"unprocessable",y)}}r.Unprocessable=d;class g extends e{constructor(p,y){super(p,"TooManyRequests",429,"too-many-requests",y)}}r.TooManyRequests=g;class E extends e{constructor(p,y){super(p,"GeneralError",500,"general-error",y)}}r.GeneralError=E;class V extends e{constructor(p,y){super(p,"NotImplemented",501,"not-implemented",y)}}r.NotImplemented=V;class ve extends e{constructor(p,y){super(p,"BadGateway",502,"bad-gateway",y)}}r.BadGateway=ve;class be extends e{constructor(p,y){super(p,"Unavailable",503,"unavailable",y)}}r.Unavailable=be,r.errors={FeathersError:e,BadRequest:t,NotAuthenticated:n,PaymentError:s,Forbidden:o,NotFound:i,MethodNotAllowed:c,NotAcceptable:a,Timeout:u,Conflict:h,LengthRequired:l,Unprocessable:d,TooManyRequests:g,GeneralError:E,NotImplemented:V,BadGateway:ve,Unavailable:be,400:t,401:n,402:s,403:o,404:i,405:c,406:a,408:u,409:h,410:f,411:l,422:d,429:g,500:E,501:V,502:ve,503:be};function Yt(b){if(!b)return b;const p=r.errors[b.name],y=p?new p(b.message,b.data):new Error(b.message||b);return typeof b=="object"&&Object.assign(y,b),y}r.convert=Yt})(Ve);Object.defineProperty(de,"__esModule",{value:!0});de.Service=void 0;const Tr=Ve,jr=$,Lt=(0,jr.createDebug)("@feathersjs/transport-commons/client"),Nr=["addListener","addEventListener","emit","listenerCount","listeners","on","once","prependListener","prependOnceListener","removeAllListeners","removeEventListener","removeListener"],Br=["eventNames","getMaxListeners","setMaxListeners"],Hr=r=>{Br.forEach(e=>{r[e]=function(...t){if(typeof this.connection[e]!="function")throw new Error(`Can not call '${e}' on the client service connection`);return this.connection[e](...t)}}),Nr.forEach(e=>{r[e]=function(t,...n){if(typeof this.connection[e]!="function")throw new Error(`Can not call '${e}' on the client service connection`);const s=`${this.path} ${t}`;Lt(`Calling emitter method ${e} with namespaced event '${s}'`);const o=this.connection[e](s,...n);return o===this.connection?this:o}})};class Dr{constructor(e){this.events=e.events,this.path=e.name,this.connection=e.connection,this.method=e.method,Hr(this)}send(e,...t){return new Promise((n,s)=>{const o=t.pop();let i=this.path;o&&Object.keys(o).forEach(c=>{i=i.replace(`:${c}`,o[c])}),t.unshift(e,i),t.push(function(c,a){return c?s((0,Tr.convert)(c)):n(a)}),Lt(`Sending socket.${this.method}`,t),this.connection[this.method](...t)})}methods(...e){return e.forEach(t=>{const n=`_${t}`;this[n]=function(s,o={}){return this.send(t,s,o.query||{},o.route||{})},this[t]=function(s,o={}){return this[n](s,o,o.route||{})}}),this}_find(e={}){return this.send("find",e.query||{},e.route||{})}find(e={}){return this._find(e)}_get(e,t={}){return this.send("get",e,t.query||{},t.route||{})}get(e,t={}){return this._get(e,t)}_create(e,t={}){return this.send("create",e,t.query||{},t.route||{})}create(e,t={}){return this._create(e,t)}_update(e,t,n={}){return typeof e>"u"?Promise.reject(new Error("id for 'update' can not be undefined")):this.send("update",e,t,n.query||{},n.route||{})}update(e,t,n={}){return this._update(e,t,n)}_patch(e,t,n={}){return this.send("patch",e,t,n.query||{},n.route||{})}patch(e,t,n={}){return this._patch(e,t,n)}_remove(e,t={}){return this.send("remove",e,t.query||{},t.route||{})}remove(e,t={}){return this._remove(e,t)}off(e,...t){if(typeof this.connection.off=="function"){const n=this.connection.off(`${this.path} ${e}`,...t);return n===this.connection?this:n}else if(t.length===0)return this.removeAllListeners(e);return this.removeListener(e,...t)}}de.Service=Dr;var qr=de;(function(r,e){Object.defineProperty(e,"__esModule",{value:!0});const t=qr,n=Mt;function s(o,i){if(!o)throw new Error("Socket.io connection needs to be provided");const c=function(u){const h=Object.values(n.defaultEventMap),f=Object.assign({},i,{events:h,name:u,connection:o,method:"emit"});return new t.Service(f)},a=function(u){if(u.io!==void 0)throw new Error("Only one default client provider can be configured");u.io=o,u.defaultService=c,u.mixins.unshift((h,f,l)=>{if(l&&l.methods&&h instanceof t.Service){const d=l.methods.filter(g=>!n.defaultServiceMethods.includes(g));h.methods(...d)}})};return a.Service=t.Service,a.service=c,a}e.default=s,r.exports=Object.assign(s,r.exports)})(Pe,Pe.exports);var Fr=Pe.exports;const $r=yt(Fr),P=Object.create(null);P.open="0";P.close="1";P.ping="2";P.pong="3";P.message="4";P.upgrade="5";P.noop="6";const ie=Object.create(null);Object.keys(P).forEach(r=>{ie[P[r]]=r});const Re={type:"error",data:"parser error"},Tt=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",jt=typeof ArrayBuffer=="function",Nt=r=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(r):r&&r.buffer instanceof ArrayBuffer,Ke=({type:r,data:e},t,n)=>Tt&&e instanceof Blob?t?n(e):nt(e,n):jt&&(e instanceof ArrayBuffer||Nt(e))?t?n(e):nt(new Blob([e]),n):n(P[r]+(e||"")),nt=(r,e)=>{const t=new FileReader;return t.onload=function(){const n=t.result.split(",")[1];e("b"+(n||""))},t.readAsDataURL(r)};function st(r){return r instanceof Uint8Array?r:r instanceof ArrayBuffer?new Uint8Array(r):new Uint8Array(r.buffer,r.byteOffset,r.byteLength)}let Oe;function Ir(r,e){if(Tt&&r.data instanceof Blob)return r.data.arrayBuffer().then(st).then(e);if(jt&&(r.data instanceof ArrayBuffer||Nt(r.data)))return e(st(r.data));Ke(r,!1,t=>{Oe||(Oe=new TextEncoder),e(Oe.encode(t))})}const it="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",W=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let r=0;r<it.length;r++)W[it.charCodeAt(r)]=r;const Ur=r=>{let e=r.length*.75,t=r.length,n,s=0,o,i,c,a;r[r.length-1]==="="&&(e--,r[r.length-2]==="="&&e--);const u=new ArrayBuffer(e),h=new Uint8Array(u);for(n=0;n<t;n+=4)o=W[r.charCodeAt(n)],i=W[r.charCodeAt(n+1)],c=W[r.charCodeAt(n+2)],a=W[r.charCodeAt(n+3)],h[s++]=o<<2|i>>4,h[s++]=(i&15)<<4|c>>2,h[s++]=(c&3)<<6|a&63;return u},Vr=typeof ArrayBuffer=="function",We=(r,e)=>{if(typeof r!="string")return{type:"message",data:Bt(r,e)};const t=r.charAt(0);return t==="b"?{type:"message",data:Kr(r.substring(1),e)}:ie[t]?r.length>1?{type:ie[t],data:r.substring(1)}:{type:ie[t]}:Re},Kr=(r,e)=>{if(Vr){const t=Ur(r);return Bt(t,e)}else return{base64:!0,data:r}},Bt=(r,e)=>{switch(e){case"blob":return r instanceof Blob?r:new Blob([r]);case"arraybuffer":default:return r instanceof ArrayBuffer?r:r.buffer}},Ht=String.fromCharCode(30),Wr=(r,e)=>{const t=r.length,n=new Array(t);let s=0;r.forEach((o,i)=>{Ke(o,!1,c=>{n[i]=c,++s===t&&e(n.join(Ht))})})},zr=(r,e)=>{const t=r.split(Ht),n=[];for(let s=0;s<t.length;s++){const o=We(t[s],e);if(n.push(o),o.type==="error")break}return n};function Gr(){return new TransformStream({transform(r,e){Ir(r,t=>{const n=t.length;let s;if(n<126)s=new Uint8Array(1),new DataView(s.buffer).setUint8(0,n);else if(n<65536){s=new Uint8Array(3);const o=new DataView(s.buffer);o.setUint8(0,126),o.setUint16(1,n)}else{s=new Uint8Array(9);const o=new DataView(s.buffer);o.setUint8(0,127),o.setBigUint64(1,BigInt(n))}r.data&&typeof r.data!="string"&&(s[0]|=128),e.enqueue(s),e.enqueue(t)})}})}let Ee;function Q(r){return r.reduce((e,t)=>e+t.length,0)}function Z(r,e){if(r[0].length===e)return r.shift();const t=new Uint8Array(e);let n=0;for(let s=0;s<e;s++)t[s]=r[0][n++],n===r[0].length&&(r.shift(),n=0);return r.length&&n<r[0].length&&(r[0]=r[0].slice(n)),t}function Yr(r,e){Ee||(Ee=new TextDecoder);const t=[];let n=0,s=-1,o=!1;return new TransformStream({transform(i,c){for(t.push(i);;){if(n===0){if(Q(t)<1)break;const a=Z(t,1);o=(a[0]&128)===128,s=a[0]&127,s<126?n=3:s===126?n=1:n=2}else if(n===1){if(Q(t)<2)break;const a=Z(t,2);s=new DataView(a.buffer,a.byteOffset,a.length).getUint16(0),n=3}else if(n===2){if(Q(t)<8)break;const a=Z(t,8),u=new DataView(a.buffer,a.byteOffset,a.length),h=u.getUint32(0);if(h>Math.pow(2,53-32)-1){c.enqueue(Re);break}s=h*Math.pow(2,32)+u.getUint32(4),n=3}else{if(Q(t)<s)break;const a=Z(t,s);c.enqueue(We(o?a:Ee.decode(a),e)),n=0}if(s===0||s>r){c.enqueue(Re);break}}}})}const Dt=4;function w(r){if(r)return Jr(r)}function Jr(r){for(var e in w.prototype)r[e]=w.prototype[e];return r}w.prototype.on=w.prototype.addEventListener=function(r,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+r]=this._callbacks["$"+r]||[]).push(e),this};w.prototype.once=function(r,e){function t(){this.off(r,t),e.apply(this,arguments)}return t.fn=e,this.on(r,t),this};w.prototype.off=w.prototype.removeListener=w.prototype.removeAllListeners=w.prototype.removeEventListener=function(r,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var t=this._callbacks["$"+r];if(!t)return this;if(arguments.length==1)return delete this._callbacks["$"+r],this;for(var n,s=0;s<t.length;s++)if(n=t[s],n===e||n.fn===e){t.splice(s,1);break}return t.length===0&&delete this._callbacks["$"+r],this};w.prototype.emit=function(r){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),t=this._callbacks["$"+r],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(t){t=t.slice(0);for(var n=0,s=t.length;n<s;++n)t[n].apply(this,e)}return this};w.prototype.emitReserved=w.prototype.emit;w.prototype.listeners=function(r){return this._callbacks=this._callbacks||{},this._callbacks["$"+r]||[]};w.prototype.hasListeners=function(r){return!!this.listeners(r).length};const k=(()=>typeof self<"u"?self:typeof window<"u"?window:Function("return this")())();function qt(r,...e){return e.reduce((t,n)=>(r.hasOwnProperty(n)&&(t[n]=r[n]),t),{})}const Xr=k.setTimeout,xr=k.clearTimeout;function pe(r,e){e.useNativeTimers?(r.setTimeoutFn=Xr.bind(k),r.clearTimeoutFn=xr.bind(k)):(r.setTimeoutFn=k.setTimeout.bind(k),r.clearTimeoutFn=k.clearTimeout.bind(k))}const Qr=1.33;function Zr(r){return typeof r=="string"?en(r):Math.ceil((r.byteLength||r.size)*Qr)}function en(r){let e=0,t=0;for(let n=0,s=r.length;n<s;n++)e=r.charCodeAt(n),e<128?t+=1:e<2048?t+=2:e<55296||e>=57344?t+=3:(n++,t+=4);return t}function tn(r){let e="";for(let t in r)r.hasOwnProperty(t)&&(e.length&&(e+="&"),e+=encodeURIComponent(t)+"="+encodeURIComponent(r[t]));return e}function rn(r){let e={},t=r.split("&");for(let n=0,s=t.length;n<s;n++){let o=t[n].split("=");e[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return e}class nn extends Error{constructor(e,t,n){super(e),this.description=t,this.context=n,this.type="TransportError"}}class ze extends w{constructor(e){super(),this.writable=!1,pe(this,e),this.opts=e,this.query=e.query,this.socket=e.socket}onError(e,t,n){return super.emitReserved("error",new nn(e,t,n)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=We(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,t={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){const e=this.opts.hostname;return e.indexOf(":")===-1?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(e){const t=tn(e);return t.length?"?"+t:""}}const Ft="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),Me=64,sn={};let ot=0,ee=0,at;function ct(r){let e="";do e=Ft[r%Me]+e,r=Math.floor(r/Me);while(r>0);return e}function $t(){const r=ct(+new Date);return r!==at?(ot=0,at=r):r+"."+ct(ot++)}for(;ee<Me;ee++)sn[Ft[ee]]=ee;let It=!1;try{It=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const on=It;function Ut(r){const e=r.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||on))return new XMLHttpRequest}catch{}if(!e)try{return new k[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}function an(){}const cn=function(){return new Ut({xdomain:!1}).responseType!=null}();class un extends ze{constructor(e){if(super(e),this.polling=!1,typeof location<"u"){const n=location.protocol==="https:";let s=location.port;s||(s=n?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||s!==e.port}const t=e&&e.forceBase64;this.supportsBinary=cn&&!t,this.opts.withCredentials&&(this.cookieJar=void 0)}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let n=0;this.polling&&(n++,this.once("pollComplete",function(){--n||t()})),this.writable||(n++,this.once("drain",function(){--n||t()}))}else t()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const t=n=>{if(this.readyState==="opening"&&n.type==="open"&&this.onOpen(),n.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(n)};zr(e,this.socket.binaryType).forEach(t),this.readyState!=="closed"&&(this.polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this.poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,Wr(e,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",t=this.query||{};return this.opts.timestampRequests!==!1&&(t[this.opts.timestampParam]=$t()),!this.supportsBinary&&!t.sid&&(t.b64=1),this.createUri(e,t)}request(e={}){return Object.assign(e,{xd:this.xd,cookieJar:this.cookieJar},this.opts),new C(this.uri(),e)}doWrite(e,t){const n=this.request({method:"POST",data:e});n.on("success",t),n.on("error",(s,o)=>{this.onError("xhr post error",s,o)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(t,n)=>{this.onError("xhr poll error",t,n)}),this.pollXhr=e}}class C extends w{constructor(e,t){super(),pe(this,t),this.opts=t,this.method=t.method||"GET",this.uri=e,this.data=t.data!==void 0?t.data:null,this.create()}create(){var e;const t=qt(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this.opts.xd;const n=this.xhr=new Ut(t);try{n.open(this.method,this.uri,!0);try{if(this.opts.extraHeaders){n.setDisableHeaderCheck&&n.setDisableHeaderCheck(!0);for(let s in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(s)&&n.setRequestHeader(s,this.opts.extraHeaders[s])}}catch{}if(this.method==="POST")try{n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{n.setRequestHeader("Accept","*/*")}catch{}(e=this.opts.cookieJar)===null||e===void 0||e.addCookies(n),"withCredentials"in n&&(n.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(n.timeout=this.opts.requestTimeout),n.onreadystatechange=()=>{var s;n.readyState===3&&((s=this.opts.cookieJar)===null||s===void 0||s.parseCookies(n)),n.readyState===4&&(n.status===200||n.status===1223?this.onLoad():this.setTimeoutFn(()=>{this.onError(typeof n.status=="number"?n.status:0)},0))},n.send(this.data)}catch(s){this.setTimeoutFn(()=>{this.onError(s)},0);return}typeof document<"u"&&(this.index=C.requestsCount++,C.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(!(typeof this.xhr>"u"||this.xhr===null)){if(this.xhr.onreadystatechange=an,e)try{this.xhr.abort()}catch{}typeof document<"u"&&delete C.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}C.requestsCount=0;C.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",ut);else if(typeof addEventListener=="function"){const r="onpagehide"in k?"pagehide":"unload";addEventListener(r,ut,!1)}}function ut(){for(let r in C.requests)C.requests.hasOwnProperty(r)&&C.requests[r].abort()}const Ge=(()=>typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,t)=>t(e,0))(),te=k.WebSocket||k.MozWebSocket,ht=!0,hn="arraybuffer",ft=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class fn extends ze{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),t=this.opts.protocols,n=ft?{}:qt(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=ht&&!ft?t?new te(e,t):new te(e):new te(e,t,n)}catch(s){return this.emitReserved("error",s)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const n=e[t],s=t===e.length-1;Ke(n,this.supportsBinary,o=>{const i={};try{ht&&this.ws.send(o)}catch{}s&&Ge(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=$t()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}check(){return!!te}}class ln extends ze{get name(){return"webtransport"}doOpen(){typeof WebTransport=="function"&&(this.transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name]),this.transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this.transport.ready.then(()=>{this.transport.createBidirectionalStream().then(e=>{const t=Yr(Number.MAX_SAFE_INTEGER,this.socket.binaryType),n=e.readable.pipeThrough(t).getReader(),s=Gr();s.readable.pipeTo(e.writable),this.writer=s.writable.getWriter();const o=()=>{n.read().then(({done:c,value:a})=>{c||(this.onPacket(a),o())}).catch(c=>{})};o();const i={type:"open"};this.query.sid&&(i.data=`{"sid":"${this.query.sid}"}`),this.writer.write(i).then(()=>this.onOpen())})}))}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const n=e[t],s=t===e.length-1;this.writer.write(n).then(()=>{s&&Ge(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;(e=this.transport)===null||e===void 0||e.close()}}const dn={websocket:fn,webtransport:ln,polling:un},pn=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,yn=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Le(r){const e=r,t=r.indexOf("["),n=r.indexOf("]");t!=-1&&n!=-1&&(r=r.substring(0,t)+r.substring(t,n).replace(/:/g,";")+r.substring(n,r.length));let s=pn.exec(r||""),o={},i=14;for(;i--;)o[yn[i]]=s[i]||"";return t!=-1&&n!=-1&&(o.source=e,o.host=o.host.substring(1,o.host.length-1).replace(/;/g,":"),o.authority=o.authority.replace("[","").replace("]","").replace(/;/g,":"),o.ipv6uri=!0),o.pathNames=gn(o,o.path),o.queryKey=mn(o,o.query),o}function gn(r,e){const t=/\/{2,9}/g,n=e.replace(t,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&n.splice(0,1),e.slice(-1)=="/"&&n.splice(n.length-1,1),n}function mn(r,e){const t={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(n,s,o){s&&(t[s]=o)}),t}let Vt=class B extends w{constructor(e,t={}){super(),this.binaryType=hn,this.writeBuffer=[],e&&typeof e=="object"&&(t=e,e=null),e?(e=Le(e),t.hostname=e.host,t.secure=e.protocol==="https"||e.protocol==="wss",t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=Le(t.host).host),pe(this,t),this.secure=t.secure!=null?t.secure:typeof location<"u"&&location.protocol==="https:",t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=t.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=t.transports||["polling","websocket","webtransport"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=rn(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,typeof addEventListener=="function"&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=Dt,t.transport=e,this.id&&(t.sid=this.id);const n=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new dn[e](n)}open(){let e;if(this.opts.rememberUpgrade&&B.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)e="websocket";else if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else e=this.transports[0];this.readyState="opening";try{e=this.createTransport(e)}catch{this.transports.shift(),this.open();return}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",t=>this.onClose("transport close",t))}probe(e){let t=this.createTransport(e),n=!1;B.priorWebsocketSuccess=!1;const s=()=>{n||(t.send([{type:"ping",data:"probe"}]),t.once("packet",f=>{if(!n)if(f.type==="pong"&&f.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;B.priorWebsocketSuccess=t.name==="websocket",this.transport.pause(()=>{n||this.readyState!=="closed"&&(h(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{const l=new Error("probe error");l.transport=t.name,this.emitReserved("upgradeError",l)}}))};function o(){n||(n=!0,h(),t.close(),t=null)}const i=f=>{const l=new Error("probe error: "+f);l.transport=t.name,o(),this.emitReserved("upgradeError",l)};function c(){i("transport closed")}function a(){i("socket closed")}function u(f){t&&f.name!==t.name&&o()}const h=()=>{t.removeListener("open",s),t.removeListener("error",i),t.removeListener("close",c),this.off("close",a),this.off("upgrading",u)};t.once("open",s),t.once("error",i),t.once("close",c),this.once("close",a),this.once("upgrading",u),this.upgrades.indexOf("webtransport")!==-1&&e!=="webtransport"?this.setTimeoutFn(()=>{n||t.open()},200):t.open()}onOpen(){if(this.readyState="open",B.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade){let e=0;const t=this.upgrades.length;for(;e<t;e++)this.probe(this.upgrades[e])}}onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),this.resetPingTimeout(),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let t=1;for(let n=0;n<this.writeBuffer.length;n++){const s=this.writeBuffer[n].data;if(s&&(t+=Zr(s)),n>0&&t>this.maxPayload)return this.writeBuffer.slice(0,n);t+=2}return this.writeBuffer}write(e,t,n){return this.sendPacket("message",e,t,n),this}send(e,t,n){return this.sendPacket("message",e,t,n),this}sendPacket(e,t,n,s){if(typeof t=="function"&&(s=t,t=void 0),typeof n=="function"&&(s=n,n=null),this.readyState==="closing"||this.readyState==="closed")return;n=n||{},n.compress=n.compress!==!1;const o={type:e,data:t,options:n};this.emitReserved("packetCreate",o),this.writeBuffer.push(o),s&&this.once("flush",s),this.flush()}close(){const e=()=>{this.onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},n=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?n():e()}):this.upgrading?n():e()),this}onError(e){B.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,t){(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const t=[];let n=0;const s=e.length;for(;n<s;n++)~this.transports.indexOf(e[n])&&t.push(e[n]);return t}};Vt.protocol=Dt;function vn(r,e="",t){let n=r;t=t||typeof location<"u"&&location,r==null&&(r=t.protocol+"//"+t.host),typeof r=="string"&&(r.charAt(0)==="/"&&(r.charAt(1)==="/"?r=t.protocol+r:r=t.host+r),/^(https?|wss?):\/\//.test(r)||(typeof t<"u"?r=t.protocol+"//"+r:r="https://"+r),n=Le(r)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";const o=n.host.indexOf(":")!==-1?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+o+":"+n.port+e,n.href=n.protocol+"://"+o+(t&&t.port===n.port?"":":"+n.port),n}const bn=typeof ArrayBuffer=="function",_n=r=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(r):r.buffer instanceof ArrayBuffer,Kt=Object.prototype.toString,wn=typeof Blob=="function"||typeof Blob<"u"&&Kt.call(Blob)==="[object BlobConstructor]",On=typeof File=="function"||typeof File<"u"&&Kt.call(File)==="[object FileConstructor]";function Ye(r){return bn&&(r instanceof ArrayBuffer||_n(r))||wn&&r instanceof Blob||On&&r instanceof File}function oe(r,e){if(!r||typeof r!="object")return!1;if(Array.isArray(r)){for(let t=0,n=r.length;t<n;t++)if(oe(r[t]))return!0;return!1}if(Ye(r))return!0;if(r.toJSON&&typeof r.toJSON=="function"&&arguments.length===1)return oe(r.toJSON(),!0);for(const t in r)if(Object.prototype.hasOwnProperty.call(r,t)&&oe(r[t]))return!0;return!1}function En(r){const e=[],t=r.data,n=r;return n.data=Te(t,e),n.attachments=e.length,{packet:n,buffers:e}}function Te(r,e){if(!r)return r;if(Ye(r)){const t={_placeholder:!0,num:e.length};return e.push(r),t}else if(Array.isArray(r)){const t=new Array(r.length);for(let n=0;n<r.length;n++)t[n]=Te(r[n],e);return t}else if(typeof r=="object"&&!(r instanceof Date)){const t={};for(const n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=Te(r[n],e));return t}return r}function kn(r,e){return r.data=je(r.data,e),delete r.attachments,r}function je(r,e){if(!r)return r;if(r&&r._placeholder===!0){if(typeof r.num=="number"&&r.num>=0&&r.num<e.length)return e[r.num];throw new Error("illegal attachments")}else if(Array.isArray(r))for(let t=0;t<r.length;t++)r[t]=je(r[t],e);else if(typeof r=="object")for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&(r[t]=je(r[t],e));return r}const An=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],Sn=5;var m;(function(r){r[r.CONNECT=0]="CONNECT",r[r.DISCONNECT=1]="DISCONNECT",r[r.EVENT=2]="EVENT",r[r.ACK=3]="ACK",r[r.CONNECT_ERROR=4]="CONNECT_ERROR",r[r.BINARY_EVENT=5]="BINARY_EVENT",r[r.BINARY_ACK=6]="BINARY_ACK"})(m||(m={}));class Cn{constructor(e){this.replacer=e}encode(e){return(e.type===m.EVENT||e.type===m.ACK)&&oe(e)?this.encodeAsBinary({type:e.type===m.EVENT?m.BINARY_EVENT:m.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let t=""+e.type;return(e.type===m.BINARY_EVENT||e.type===m.BINARY_ACK)&&(t+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(t+=e.nsp+","),e.id!=null&&(t+=e.id),e.data!=null&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=En(e),n=this.encodeAsString(t.packet),s=t.buffers;return s.unshift(n),s}}function lt(r){return Object.prototype.toString.call(r)==="[object Object]"}class Je extends w{constructor(e){super(),this.reviver=e}add(e){let t;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const n=t.type===m.BINARY_EVENT;n||t.type===m.BINARY_ACK?(t.type=n?m.EVENT:m.ACK,this.reconstructor=new Pn(t),t.attachments===0&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else if(Ye(e)||e.base64)if(this.reconstructor)t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let t=0;const n={type:Number(e.charAt(0))};if(m[n.type]===void 0)throw new Error("unknown packet type "+n.type);if(n.type===m.BINARY_EVENT||n.type===m.BINARY_ACK){const o=t+1;for(;e.charAt(++t)!=="-"&&t!=e.length;);const i=e.substring(o,t);if(i!=Number(i)||e.charAt(t)!=="-")throw new Error("Illegal attachments");n.attachments=Number(i)}if(e.charAt(t+1)==="/"){const o=t+1;for(;++t&&!(e.charAt(t)===","||t===e.length););n.nsp=e.substring(o,t)}else n.nsp="/";const s=e.charAt(t+1);if(s!==""&&Number(s)==s){const o=t+1;for(;++t;){const i=e.charAt(t);if(i==null||Number(i)!=i){--t;break}if(t===e.length)break}n.id=Number(e.substring(o,t+1))}if(e.charAt(++t)){const o=this.tryParse(e.substr(t));if(Je.isPayloadValid(n.type,o))n.data=o;else throw new Error("invalid payload")}return n}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,t){switch(e){case m.CONNECT:return lt(t);case m.DISCONNECT:return t===void 0;case m.CONNECT_ERROR:return typeof t=="string"||lt(t);case m.EVENT:case m.BINARY_EVENT:return Array.isArray(t)&&(typeof t[0]=="number"||typeof t[0]=="string"&&An.indexOf(t[0])===-1);case m.ACK:case m.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class Pn{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const t=kn(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const Rn=Object.freeze(Object.defineProperty({__proto__:null,Decoder:Je,Encoder:Cn,get PacketType(){return m},protocol:Sn},Symbol.toStringTag,{value:"Module"}));function A(r,e,t){return r.on(e,t),function(){r.off(e,t)}}const Mn=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Wt extends w{constructor(e,t,n){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,n&&n.auth&&(this.auth=n.auth),this._opts=Object.assign({},n),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[A(e,"open",this.onopen.bind(this)),A(e,"packet",this.onpacket.bind(this)),A(e,"error",this.onerror.bind(this)),A(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){if(Mn.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const n={type:m.EVENT,data:t};if(n.options={},n.options.compress=this.flags.compress!==!1,typeof t[t.length-1]=="function"){const i=this.ids++,c=t.pop();this._registerAckCallback(i,c),n.id=i}const s=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!s||!this.connected)||(this.connected?(this.notifyOutgoingListeners(n),this.packet(n)):this.sendBuffer.push(n)),this.flags={},this}_registerAckCallback(e,t){var n;const s=(n=this.flags.timeout)!==null&&n!==void 0?n:this._opts.ackTimeout;if(s===void 0){this.acks[e]=t;return}const o=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let i=0;i<this.sendBuffer.length;i++)this.sendBuffer[i].id===e&&this.sendBuffer.splice(i,1);t.call(this,new Error("operation has timed out"))},s);this.acks[e]=(...i)=>{this.io.clearTimeoutFn(o),t.apply(this,[null,...i])}}emitWithAck(e,...t){const n=this.flags.timeout!==void 0||this._opts.ackTimeout!==void 0;return new Promise((s,o)=>{t.push((i,c)=>n?i?o(i):s(c):s(i)),this.emit(e,...t)})}_addToQueue(e){let t;typeof e[e.length-1]=="function"&&(t=e.pop());const n={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((s,...o)=>n!==this._queue[0]?void 0:(s!==null?n.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(s)):(this._queue.shift(),t&&t(null,...o)),n.pending=!1,this._drainQueue())),this._queue.push(n),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:m.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t)}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case m.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case m.EVENT:case m.BINARY_EVENT:this.onevent(e);break;case m.ACK:case m.BINARY_ACK:this.onack(e);break;case m.DISCONNECT:this.ondisconnect();break;case m.CONNECT_ERROR:this.destroy();const n=new Error(e.data.message);n.data=e.data.data,this.emitReserved("connect_error",n);break}}onevent(e){const t=e.data||[];e.id!=null&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const n of t)n.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let n=!1;return function(...s){n||(n=!0,t.packet({type:m.ACK,id:e,data:s}))}}onack(e){const t=this.acks[e.id];typeof t=="function"&&(t.apply(this,e.data),delete this.acks[e.id])}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:m.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const n of t)n.apply(this,e.data)}}}function U(r){r=r||{},this.ms=r.min||100,this.max=r.max||1e4,this.factor=r.factor||2,this.jitter=r.jitter>0&&r.jitter<=1?r.jitter:0,this.attempts=0}U.prototype.duration=function(){var r=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),t=Math.floor(e*this.jitter*r);r=Math.floor(e*10)&1?r+t:r-t}return Math.min(r,this.max)|0};U.prototype.reset=function(){this.attempts=0};U.prototype.setMin=function(r){this.ms=r};U.prototype.setMax=function(r){this.max=r};U.prototype.setJitter=function(r){this.jitter=r};class Ne extends w{constructor(e,t){var n;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.opts=t,pe(this,t),this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor((n=t.randomizationFactor)!==null&&n!==void 0?n:.5),this.backoff=new U({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this._readyState="closed",this.uri=e;const s=t.parser||Rn;this.encoder=new s.Encoder,this.decoder=new s.Decoder,this._autoConnect=t.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(t=this.backoff)===null||t===void 0||t.setMin(e),this)}randomizationFactor(e){var t;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(t=this.backoff)===null||t===void 0||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(t=this.backoff)===null||t===void 0||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new Vt(this.uri,this.opts);const t=this.engine,n=this;this._readyState="opening",this.skipReconnect=!1;const s=A(t,"open",function(){n.onopen(),e&&e()}),o=c=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",c),e?e(c):this.maybeReconnectOnOpen()},i=A(t,"error",o);if(this._timeout!==!1){const c=this._timeout,a=this.setTimeoutFn(()=>{s(),o(new Error("timeout")),t.close()},c);this.opts.autoUnref&&a.unref(),this.subs.push(()=>{this.clearTimeoutFn(a)})}return this.subs.push(s),this.subs.push(i),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(A(e,"ping",this.onping.bind(this)),A(e,"data",this.ondata.bind(this)),A(e,"error",this.onerror.bind(this)),A(e,"close",this.onclose.bind(this)),A(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(t){this.onclose("parse error",t)}}ondecoded(e){Ge(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let n=this.nsps[e];return n?this._autoConnect&&!n.active&&n.connect():(n=new Wt(this,e,t),this.nsps[e]=n),n}_destroy(e){const t=Object.keys(this.nsps);for(const n of t)if(this.nsps[n].active)return;this._close()}_packet(e){const t=this.encoder.encode(e);for(let n=0;n<t.length;n++)this.engine.write(t[n],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const n=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(s=>{s?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",s)):e.onreconnect()}))},t);this.opts.autoUnref&&n.unref(),this.subs.push(()=>{this.clearTimeoutFn(n)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const K={};function ae(r,e){typeof r=="object"&&(e=r,r=void 0),e=e||{};const t=vn(r,e.path||"/socket.io"),n=t.source,s=t.id,o=t.path,i=K[s]&&o in K[s].nsps,c=e.forceNew||e["force new connection"]||e.multiplex===!1||i;let a;return c?a=new Ne(n,e):(K[s]||(K[s]=new Ne(n,e)),a=K[s]),t.query&&!e.query&&(e.query=t.queryKey),a.socket(t.path,e)}Object.assign(ae,{Manager:Ne,Socket:Wt,io:ae,connect:ae});var Be={exports:{}},ye={},j={};Object.defineProperty(j,"__esModule",{value:!0});j.StorageWrapper=j.MemoryStorage=void 0;class Ln{constructor(){this.store={}}getItem(e){return Promise.resolve(this.store[e])}setItem(e,t){return Promise.resolve(this.store[e]=t)}removeItem(e){const t=this.store[e];return delete this.store[e],Promise.resolve(t)}}j.MemoryStorage=Ln;class Tn{constructor(e){this.storage=e}getItem(e){var t;return Promise.resolve((t=this.storage)===null||t===void 0?void 0:t.getItem(e))}setItem(e,t){var n;return Promise.resolve((n=this.storage)===null||n===void 0?void 0:n.setItem(e,t))}removeItem(e){var t;return Promise.resolve((t=this.storage)===null||t===void 0?void 0:t.removeItem(e))}}j.StorageWrapper=Tn;Object.defineProperty(ye,"__esModule",{value:!0});ye.AuthenticationClient=void 0;const zt=Ve,jn=j;class Nn extends zt.FeathersError{constructor(e,t){super(e,"OauthError",401,"oauth-error",t)}}const dt=(r,e)=>{const t=new RegExp(`(?:&?)${e}=([^&]*)`),n=r.hash?r.hash.match(t):null;if(n!==null){const[,s]=n;return[s,t]}return[null,t]};class Bn{constructor(e,t){const n=e.io,s=new jn.StorageWrapper(e.get("storage")||t.storage);this.app=e,this.options=t,this.authenticated=!1,this.app.set("storage",s),n&&this.handleSocket(n)}get service(){return this.app.service(this.options.path)}get storage(){return this.app.get("storage")}handleSocket(e){e.on("disconnect",()=>{this.authenticated&&this.reAuthenticate(!0)})}getFromLocation(e){const[t,n]=dt(e,this.options.locationKey);if(t!==null)return e.hash=e.hash.replace(n,""),Promise.resolve(t);const[s,o]=dt(e,this.options.locationErrorKey);return s!==null?(e.hash=e.hash.replace(o,""),Promise.reject(new Nn(decodeURIComponent(s)))):Promise.resolve(null)}setAccessToken(e){return this.storage.setItem(this.options.storageKey,e)}getAccessToken(){return this.storage.getItem(this.options.storageKey).then(e=>!e&&typeof window<"u"&&window.location?this.getFromLocation(window.location):e||null)}removeAccessToken(){return this.storage.removeItem(this.options.storageKey)}reset(){return this.app.set("authentication",null),this.authenticated=!1,Promise.resolve(null)}handleError(e,t){if(e.code>400&&e.code<408){const n=this.removeAccessToken().then(()=>this.reset());return t==="logout"?n:n.then(()=>Promise.reject(e))}return this.reset().then(()=>Promise.reject(e))}reAuthenticate(e=!1,t){let n=this.app.get("authentication");return(!n||e===!0)&&(n=this.getAccessToken().then(s=>s?this.authenticate({strategy:t||this.options.jwtStrategy,accessToken:s}):this.handleError(new zt.NotAuthenticated("No accessToken found in storage"),"authenticate")),this.app.set("authentication",n)),n}authenticate(e,t){if(!e)return this.reAuthenticate();const n=this.service.create(e,t).then(s=>{const{accessToken:o}=s;return this.authenticated=!0,this.app.emit("login",s),this.app.emit("authenticated",s),this.setAccessToken(o).then(()=>s)}).catch(s=>this.handleError(s,"authenticate"));return this.app.set("authentication",n),n}logout(){return Promise.resolve(this.app.get("authentication")).then(()=>this.service.remove(null).then(e=>this.removeAccessToken().then(()=>this.reset()).then(()=>(this.app.emit("logout",e),e)))).catch(e=>this.handleError(e,"logout"))}}ye.AuthenticationClient=Bn;var Gt={},ge={};Object.defineProperty(ge,"__esModule",{value:!0});ge.authentication=void 0;const Hn=$,Dn=()=>(r,e)=>{const{app:t,params:n,path:s,method:o,app:{authentication:i}}=r;return(0,Hn.stripSlashes)(i.options.path)===s&&o==="create"?e():Promise.resolve(t.get("authentication")).then(c=>{c&&(r.params=Object.assign({},c,n))}).then(e)};ge.authentication=Dn;var me={};Object.defineProperty(me,"__esModule",{value:!0});me.populateHeader=void 0;const qn=()=>(r,e)=>{const{app:t,params:{accessToken:n}}=r,s=t.authentication;if(t.rest&&n){const{scheme:o,header:i}=s.options,c=`${o} ${n}`;r.params.headers=Object.assign({},{[i]:c},r.params.headers)}return e()};me.populateHeader=qn;(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.populateHeader=r.authentication=void 0;var e=ge;Object.defineProperty(r,"authentication",{enumerable:!0,get:function(){return e.authentication}});var t=me;Object.defineProperty(r,"populateHeader",{enumerable:!0,get:function(){return t.populateHeader}})})(Gt);(function(r,e){var t=_&&_.__createBinding||(Object.create?function(h,f,l,d){d===void 0&&(d=l);var g=Object.getOwnPropertyDescriptor(f,l);(!g||("get"in g?!f.__esModule:g.writable||g.configurable))&&(g={enumerable:!0,get:function(){return f[l]}}),Object.defineProperty(h,d,g)}:function(h,f,l,d){d===void 0&&(d=l),h[d]=f[l]}),n=_&&_.__setModuleDefault||(Object.create?function(h,f){Object.defineProperty(h,"default",{enumerable:!0,value:f})}:function(h,f){h.default=f}),s=_&&_.__importStar||function(h){if(h&&h.__esModule)return h;var f={};if(h!=null)for(var l in h)l!=="default"&&Object.prototype.hasOwnProperty.call(h,l)&&t(f,h,l);return n(f,h),f};Object.defineProperty(e,"__esModule",{value:!0}),e.defaults=e.defaultStorage=e.hooks=e.MemoryStorage=e.AuthenticationClient=e.getDefaultStorage=void 0;const o=ye;Object.defineProperty(e,"AuthenticationClient",{enumerable:!0,get:function(){return o.AuthenticationClient}});const i=s(Gt);e.hooks=i;const c=j;Object.defineProperty(e,"MemoryStorage",{enumerable:!0,get:function(){return c.MemoryStorage}});const a=()=>{try{return new c.StorageWrapper(window.localStorage)}catch{}return new c.MemoryStorage};e.getDefaultStorage=a,e.defaultStorage=(0,e.getDefaultStorage)(),e.defaults={header:"Authorization",scheme:"Bearer",storageKey:"feathers-jwt",locationKey:"access_token",locationErrorKey:"error",jwtStrategy:"jwt",path:"/authentication",Authentication:o.AuthenticationClient,storage:e.defaultStorage};const u=(h={})=>{const f=Object.assign({},e.defaults,h),{Authentication:l}=f;return d=>{const g=new l(d,f);d.authentication=g,d.authenticate=g.authenticate.bind(g),d.reAuthenticate=g.reAuthenticate.bind(g),d.logout=g.logout.bind(g),d.hooks([i.authentication(),i.populateHeader()])}};e.default=u,r.exports=Object.assign(u,r.exports)})(Be,Be.exports);var Fn=Be.exports;const $n=yt(Fn),In=["find","get","create","patch","remove","track"],Un="http://localhost:3030/";function Vn(r=void 0,e=void 0){return r=r||ue(),e=e||De(),new Promise(t=>{const n=setInterval(()=>{r&&!r.isLoading.value&&(r.isAuthenticated.value||r.loginWithRedirect({appState:{target:e.fullPath}}),clearInterval(n),t(r))},50)})}function es(){const r=ue(),t=pt().app.baseUrl||"";return()=>{if(r){const n=`${window.location.origin}${t}`;r.logout({logoutParams:{returnTo:n}})}}}async function Kn(r,e,t){const n=ae(e),s=$r(n),o=Mt.feathers();o.configure(s),o.configure($n({})),await o.authentication.setAccessToken(r);try{await o.authenticate()}catch{t.push({name:"auth-register"});return}return o.use("report-field",s.service("report-field"),{methods:In}),o}async function Wn(r,e){const t=sr.get(e,"user.value.sub");H.value=await r.service("users").get(t)}class zn{constructor(){N(this,"application");N(this,"ready",z(!1));N(this,"isReady",re(()=>this.ready.value));N(this,"jwtToken",z(""));N(this,"apiEndpoint",z(""))}async init(e,t,n,s){if(!this.application){const o=t.public.apiEndpoint||Un,i=await Kn(e,o,n);if(!i)return;this.application=i,this.jwtToken.value=e,this.ready.value=!0,this.apiEndpoint.value=o,Wn(this.application,s)}}get app(){return this.application}}let ke;const H=z();function Gn(){const r=ue(),e=re(()=>{var s,o;if(!(!r||!((s=r.isAuthenticated)!=null&&s.value)))return(o=r.user.value)==null?void 0:o.picture}),t=re(()=>H.value&&H.value.role==="admin"),n=re(()=>t.value?!0:!!H.value&&H.value.role==="collaborator");return{user:H,isAdmin:t,isCollaborator:n,avatar:e}}function ts(){const r=ue(),e=pt(),t=De(),n=rr(),s=z(""),o=Jn();ke||(ke=new zn);const i=ke;async function c(){i.isReady.value||r&&(await Vn(r,t),r.isAuthenticated.value&&(s.value=await r.getAccessTokenSilently(),i.init(s.value,e,n,r)))}o.isOnRegister&&!o.isRegisterOk?n.replace({name:"auth-error",query:{error:o.error}}):o.isRegisterOk?(n.replace({name:"profession",hash:""}),Xe(c)):o.isOnAuth0Login?nr(()=>t.query.code,(f,l)=>{!f&&l&&c()}):Xe(c);const{user:a,isAdmin:u,isCollaborator:h}=Gn();return{user:a,token:s,feathers:i,isAdmin:u,isCollaborator:h}}const He="#error=",Yn=`${He}secretOrPrivateKey must be an asymmetric key when using RS256`;function Jn(){const{hash:r,query:e}=De(),t=!!e.code,n=r.startsWith(He),s=r.startsWith(Yn);let o="";return n&&!s&&(o=r.replace(He,"")),{isOnAuth0Login:t,isOnRegister:n,isRegisterOk:s,error:o}}export{Un as D,es as a,Gn as b,Vn as s,ts as u};
