import{_ as q}from"./FieldProgress.1b514909.js";import{_ as j}from"./nuxt-link.e96bb55a.js";import{f as Y,h as $,o as e,c as s,i,F as v,t as d,j as k,r as b,L as z,z as J,d as N,a as o,y as L,b as D,w as B,J as G,p as K,e as Q,_ as U,I as W,n as X,g as Z,B as T,C as x}from"./entry.17b55f46.js";import{u as E}from"./useProfessionApi.11da22c7.js";import{d as H}from"./dayjs.min.08b35b16.js";import{m as ee}from"./industryStats.5556f7dc.js";import{_ as te}from"./lodash.159e145e.js";import"./_commonjsHelpers.14e01a87.js";const se={class:"cellValue"},ie={key:0,class:"moon-gray"},re={key:0,class:"cellValue__value"},ne={key:1,class:"f6 gray"},ae=Y({__name:"IndustryCellValue",props:{reportField:{},filedMeta:{}},setup(n){const u=n,p=$(()=>!u.reportField||!u.reportField.value&&!u.reportField.notes);return(c,r)=>(e(),s("div",se,[i(p)?(e(),s("div",ie,"尚未判讀")):(e(),s(v,{key:1},[c.reportField.value?(e(),s("div",re,d(c.reportField.value)+" "+d(c.reportField.unit),1)):k("",!0),c.reportField.notes?(e(),s("div",ne,d(c.reportField.notes),1)):k("",!0)],64))]))}}),P=n=>(K("data-v-03c55aae"),n=n(),Q(),n),oe={class:"industryDetail"},le={key:0,class:"mv5 tc f2"},ce={class:"fw7"},de=P(()=>o("div",{class:"industryDetail__cell industryDetail__cell--head industryDetail__cell--name"},"公司名稱",-1)),_e=P(()=>o("div",{class:"industryDetail__cell industryDetail__cell--head"},"更新時間",-1)),ue={key:0,class:"industryDetail__cell industryDetail__cell--head"},pe={key:0},ye=P(()=>o("i",{class:"ml2 fa-solid fa-arrow-up-right-from-square"},null,-1)),me={class:"industryDetail__value"},fe={class:"industryDetail__cell"},ve={key:0,class:"industryDetail__cell"},he=["onClick"],ge=Y({__name:"IndustryDetail",props:{reportList:{}},setup(n){const u=n,{feathers:p,isAdmin:c}=E(),r=b({}),h=b({}),m=b(0),w=$(()=>{let t=`6rem repeat(${h.value.length}, 6rem) 8rem`;return c.value&&(t+=" 10rem"),{gridTemplateColumns:t}});function f(t){return H(t).format("YYYY/MM/DD HH:mm")}function M(t){return`/profession/report/${t.id}`}const I=z();async function C(t){confirm(`確定要將「${t.company.name} 」標為已驗證嗎？按下去之後，整本報告書就無法修改囉～～～`)&&(await p.app.service("report").patch(t.id,{isVerified:!0}),I.add({type:"success",text:`${t.company.name}驗證完畢`}),t.isVerified=!0)}function R(t,y=0){return p.app.service("report-field").find({query:{reportId:{$in:t},$limit:200,$skip:y}})}async function V(){const t=u.reportList.map(l=>l.id);let y=0;for(;;){const l=await R(t,y);if(l.data.forEach(g=>{r.value[g.reportId]||(r.value[g.reportId]={}),r.value[g.reportId][g.fieldId]=g}),!l.data.length){m.value=100;break}y=l.skip+l.data.length,m.value=Math.floor(y*100/l.total)}}async function S(){const t=await p.app.service("field-meta").find({query:{$limit:100,$sort:{id:1}}});h.value=t.data,await V()}return J(()=>u.reportList,S,{immediate:!0}),(t,y)=>{const l=j,g=ae;return e(),s("div",oe,[i(m)<1?(e(),s("h1",le,[N(" 資料載入中... "),o("span",ce,d(i(m))+"%",1)])):k("",!0),o("div",{class:"industryDetail__table mv3 f6",style:G(i(w))},[de,(e(!0),s(v,null,L(i(h),_=>(e(),s("div",{key:_.id,class:"industryDetail__cell industryDetail__cell--head"},d(_.name),1))),128)),_e,i(c)?(e(),s("div",ue)):k("",!0),(e(!0),s(v,null,L(t.reportList,_=>(e(),s(v,{key:_.id},[i(r)[_.id]?(e(),s(v,{key:0},[D(l,{to:M(_),class:"industryDetail__cell industryDetail__cell--name gray dim no-underline"},{default:B(()=>[_.isVerified?(e(),s("span",pe,"✅")):k("",!0),N(" "+d(_.company.abbreviation)+" ",1),ye]),_:2},1032,["to"]),(e(!0),s(v,null,L(i(h),a=>(e(),s("div",{key:a.id,class:"industryDetail__cell"},[o("div",me,[D(g,{"report-field":i(r)[_.id][a.id],"filed-meta":a},null,8,["report-field","filed-meta"])])]))),128)),o("div",fe,d(f(_.updatedAt)),1),i(c)?(e(),s("div",ve,[_.isVerified?k("",!0):(e(),s("button",{key:0,class:"bg-green white pv1 ph2 br2 bw0 dim pointer",onClick:a=>C(_)}," 標為已驗證 ✅ ",8,he))])):k("",!0)],64)):k("",!0)],64))),128))],4)])}}});const ke=U(ge,[["__scopeId","data-v-03c55aae"]]),$e={class:"reportList"},be=X('<div class="reportList__report"><div class="reportList__cell">公司名稱</div><div class="reportList__cell">年份</div><div class="reportList__cell">進度</div><div class="reportList__cell">更新時間</div></div>',1),Le={class:"reportList__cell"},De={class:"reportList__cell"},we={class:"reportList__cell"},Ie={class:"reportList__cell"},Ce=o("i",{class:"fa-solid fa-arrow-right self-center"},null,-1),Fe={key:1,class:"pa2 tc"},Ve=Y({__name:"ReportList",props:{reportList:{},filter:{}},setup(n){const u=n,p=$(()=>u.filter===F.all?u.reportList:u.reportList.filter(r=>u.filter===F.verified?r.isVerified:u.filter===F.isAnswered?r.answeredFields===r.totalFields:r.answeredFields<r.totalFields));function c(r){return H(r).format("YYYY/MM/DD HH:mm")}return(r,h)=>{const m=q,w=j;return e(),s("div",$e,[be,i(p).length?(e(!0),s(v,{key:0},L(i(p),f=>(e(),W(w,{key:f.id,to:`/profession/report/${f.id}`,class:"reportList__report black dim no-underline"},{default:B(()=>[o("div",Le,d(f.company.name),1),o("div",De,d(f.year),1),o("div",we,[D(m,{progress:f,"is-industry":!1},null,8,["progress"])]),o("div",Ie,d(c(f.updatedAt)),1),Ce]),_:2},1032,["to"]))),128)):(e(),s("div",Fe," 此分類無 資料 "))])}}});const xe={class:"pb3"},Ye={class:"tc f2 fw6 mb2"},Me={class:"tc f3 mv2"},Re={class:"w5 center"},Se={class:"pv3 mb4 bt bb b--moon-gray flex justify-between"},Pe={key:0},Ae=["onClick"],Ne={key:1},qe=["onClick"],je={class:"industry__modeList"},Be=["onClick"],Ee={key:0},He={key:1,class:"pa4"};var F=(n=>(n.all="全部",n.verified="已驗證",n.isAnswered="判讀完成",n.pending="待判讀",n))(F||{}),O=(n=>(n.list="報告書列表",n.detail="所有欄位資料",n))(O||{});const Xe=Y({__name:"[industry]",setup(n){const p=Z().params.industry,{feathers:c}=E(),r=b([]),h=b("全部"),m=b(0),w=$(()=>te.uniq(r.value.map(t=>t.year)));function f(t){m.value=t}const M=$(()=>r.value.filter(t=>t.year===m.value)),I=b("報告書列表"),C=$(()=>I.value==="所有欄位資料");function R(t){h.value=t}const V=$(()=>{const t={};return r.value.forEach(y=>{ee(t,y)}),t[p]});async function S(){const y=(await c.app.service("company").find({query:{industry:p,$select:["id"],$limit:500}})).data.map(l=>l.id);c.app.service("report").find({query:{companyId:{$in:y},$limit:500,$sort:{year:-1}}}).then(l=>{r.value=l.data,l.data.length&&(m.value=l.data[0].year)})}return T(()=>{c.isReady.value&&S()}),(t,y)=>{const l=q,g=ke,_=Ve;return i(r).length?(e(),s("div",{key:0,class:x(["industry pa4 lh-copy",{"industry--wide":i(C)}])},[o("div",xe,[o("h1",Ye,d(i(p)),1),o("p",Me,d(i(V).total)+" 本",1),o("div",Re,[D(l,{progress:i(V)},null,8,["progress"])])]),o("div",Se,[i(C)?(e(),s("div",Pe,[(e(!0),s(v,null,L(i(w),a=>(e(),s("button",{class:x(["industry__filter bg-white pv2 ph3 ba b--light-gray br2 dim pointer",{"bg-green":i(m)===a}]),key:a,onClick:A=>f(a)},d(a),11,Ae))),128))])):(e(),s("div",Ne,[(e(!0),s(v,null,L(Object.values(F),a=>(e(),s("button",{class:x(["industry__filter bg-white pv2 ph3 ba b--light-gray br2 dim pointer",{"bg-green":i(h)===a}]),key:a,onClick:A=>R(a)},d(a),11,qe))),128))])),o("div",je,[(e(!0),s(v,null,L(Object.values(O),a=>(e(),s("button",{class:x(["industry__mode bg-white pv2 ph3 ba b-light-green b--light-gray br2 dim pointer",{"industry__mode--active":i(I)===a}]),key:a,onClick:A=>I.value=a},d(a),11,Be))),128))])]),i(C)?(e(),s("div",Ee,[D(g,{"report-list":i(M)},null,8,["report-list"])])):(e(),s("div",He,[D(_,{"report-list":i(r),filter:i(h)},null,8,["report-list","filter"])]))],2)):k("",!0)}}});export{F as FilterType,Xe as default};
