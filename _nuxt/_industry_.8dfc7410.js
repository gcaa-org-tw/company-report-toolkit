import{_ as A}from"./FieldProgress.c2008237.js";import{_ as j}from"./nuxt-link.1806371e.js";import{f as M,h as $,o as e,c as t,i as s,F as v,t as d,j as b,r as k,O as z,z as J,d as q,a as o,y as D,b as w,w as B,J as G,p as K,e as Q,_ as U,I as W,n as X,g as Z,B as T,C as Y}from"./entry.f2f70b64.js";import{u as E}from"./useProfessionApi.c6b4ce0f.js";import{d as O}from"./dayjs.min.395d6a1a.js";import{m as ee}from"./industryStats.5556f7dc.js";import{_ as te}from"./lodash.2000d224.js";import"./_commonjsHelpers.ee68ef9e.js";const se={class:"cellValue"},ie={key:0,class:"moon-gray"},re={key:0,class:"cellValue__value"},ne={key:1,class:"f6 gray"},oe=M({__name:"IndustryCellValue",props:{reportField:{},filedMeta:{}},setup(r){const m=r,y=$(()=>!m.reportField||!m.reportField.value&&!m.reportField.notes);return(l,i)=>(e(),t("div",se,[s(y)?(e(),t("div",ie,"尚未判讀")):(e(),t(v,{key:1},[l.reportField.value?(e(),t("div",re,d(l.reportField.value)+" "+d(l.reportField.unit),1)):b("",!0),l.reportField.notes?(e(),t("div",ne,d(l.reportField.notes),1)):b("",!0)],64))]))}}),R=r=>(K("data-v-6b177e11"),r=r(),Q(),r),ae={class:"industryDetail"},le={key:0,class:"mv5 tc f2"},ce={class:"fw7"},de=R(()=>o("div",{class:"industryDetail__cell industryDetail__cell--head industryDetail__cell--name"},"公司名稱",-1)),_e=R(()=>o("div",{class:"industryDetail__cell industryDetail__cell--head"},"更新時間",-1)),ue=R(()=>o("div",{class:"industryDetail__cell industryDetail__cell--head"},null,-1)),pe={key:0},me=R(()=>o("i",{class:"ml2 fa-solid fa-arrow-up-right-from-square"},null,-1)),ye={class:"industryDetail__value"},fe={class:"industryDetail__cell"},ve={class:"industryDetail__cell"},he=["onClick"],ge=M({__name:"IndustryDetail",props:{reportList:{}},setup(r){const m=r,{feathers:y}=E(),l=k({}),i=k({}),h=k(0),g=$(()=>({gridTemplateColumns:`6rem repeat(${i.value.length}, 6rem) 8rem 10rem`}));function I(a){return O(a).format("YYYY/MM/DD HH:mm")}function f(a){return`/profession/report/${a.id}`}const S=z();async function C(a){confirm(`確定要將「${a.company.name} 」標為已驗證嗎？按下去之後，整本報告書就無法修改囉～～～`)&&(await y.app.service("report").patch(a.id,{isVerified:!0}),S.add({type:"success",text:`${a.company.name}驗證完畢`}),a.isVerified=!0)}function F(a,n=0){return y.app.service("report-field").find({query:{reportId:{$in:a},$limit:200,$skip:n}})}async function P(){const a=m.reportList.map(_=>_.id);let n=0;for(;;){const _=await F(a,n);if(_.data.forEach(c=>{l.value[c.reportId]||(l.value[c.reportId]={}),l.value[c.reportId][c.fieldId]=c}),!_.data.length){h.value=100;break}n=_.skip+_.data.length,h.value=Math.floor(n*100/_.total)}}async function x(){const a=await y.app.service("field-meta").find({query:{$limit:100,$sort:{id:1}}});i.value=a.data,await P()}return J(()=>m.reportList,x,{immediate:!0}),(a,n)=>{const _=j,c=oe;return e(),t("div",ae,[s(h)<1?(e(),t("h1",le,[q(" 資料載入中... "),o("span",ce,d(s(h))+"%",1)])):b("",!0),o("div",{class:"industryDetail__table mv3 f6",style:G(s(g))},[de,(e(!0),t(v,null,D(s(i),u=>(e(),t("div",{key:u.id,class:"industryDetail__cell industryDetail__cell--head"},d(u.name),1))),128)),_e,ue,(e(!0),t(v,null,D(a.reportList,u=>(e(),t(v,{key:u.id},[s(l)[u.id]?(e(),t(v,{key:0},[w(_,{to:f(u),class:"industryDetail__cell industryDetail__cell--name gray dim no-underline"},{default:B(()=>[u.isVerified?(e(),t("span",pe,"✅")):b("",!0),q(" "+d(u.company.abbreviation)+" ",1),me]),_:2},1032,["to"]),(e(!0),t(v,null,D(s(i),L=>(e(),t("div",{key:L.id,class:"industryDetail__cell"},[o("div",ye,[w(c,{"report-field":s(l)[u.id][L.id],"filed-meta":L},null,8,["report-field","filed-meta"])])]))),128)),o("div",fe,d(I(u.updatedAt)),1),o("div",ve,[u.isVerified?b("",!0):(e(),t("button",{key:0,class:"bg-green white pv1 ph2 br2 bw0 dim pointer",onClick:L=>C(u)}," 標為已驗證 ✅ ",8,he))])],64)):b("",!0)],64))),128))],4)])}}});const $e=U(ge,[["__scopeId","data-v-6b177e11"]]),be={class:"reportList"},ke=X('<div class="reportList__report"><div class="reportList__cell">公司名稱</div><div class="reportList__cell">年份</div><div class="reportList__cell">進度</div><div class="reportList__cell">更新時間</div></div>',1),De={class:"reportList__cell"},Le={class:"reportList__cell"},we={class:"reportList__cell"},Ie={class:"reportList__cell"},Ce=o("i",{class:"fa-solid fa-arrow-right self-center"},null,-1),Fe={key:1,class:"pa2 tc"},Ve=M({__name:"ReportList",props:{reportList:{},filter:{}},setup(r){const m=r,y=$(()=>m.filter===V.all?m.reportList:m.reportList.filter(i=>m.filter===V.verified?i.isVerified:m.filter===V.isAnswered?i.answeredFields===i.totalFields:i.answeredFields<i.totalFields));function l(i){return O(i).format("YYYY/MM/DD HH:mm")}return(i,h)=>{const g=A,I=j;return e(),t("div",be,[ke,s(y).length?(e(!0),t(v,{key:0},D(s(y),f=>(e(),W(I,{key:f.id,to:`/profession/report/${f.id}`,class:"reportList__report black dim no-underline"},{default:B(()=>[o("div",De,d(f.company.name),1),o("div",Le,d(f.year),1),o("div",we,[w(g,{progress:f,"is-industry":!1},null,8,["progress"])]),o("div",Ie,d(l(f.updatedAt)),1),Ce]),_:2},1032,["to"]))),128)):(e(),t("div",Fe," 此分類無 資料 "))])}}});const xe={class:"pb3"},Ye={class:"tc f2 fw6 mb2"},Me={class:"tc f3 mv2"},Re={class:"w5 center"},Se={class:"pv3 mb4 bt bb b--moon-gray flex justify-between"},Pe={key:0},Ne=["onClick"],qe={key:1},Ae=["onClick"],je={class:"industry__modeList"},Be=["onClick"],Ee={key:0},Oe={key:1,class:"pa4"};var V=(r=>(r.all="全部",r.verified="已驗證",r.isAnswered="判讀完成",r.pending="待判讀",r))(V||{}),H=(r=>(r.list="報告書列表",r.detail="所有欄位資料",r))(H||{});const Xe=M({__name:"[industry]",setup(r){const y=Z().params.industry,{feathers:l}=E(),i=k([]),h=k("全部"),g=k(0),I=$(()=>te.uniq(i.value.map(n=>n.year)));function f(n){g.value=n}const S=$(()=>i.value.filter(n=>n.year===g.value)),C=k("報告書列表"),F=$(()=>C.value==="所有欄位資料");function P(n){h.value=n}const x=$(()=>{const n={};return i.value.forEach(_=>{ee(n,_)}),n[y]});async function a(){const _=(await l.app.service("company").find({query:{industry:y,$select:["id"],$limit:500}})).data.map(c=>c.id);l.app.service("report").find({query:{companyId:{$in:_},$limit:500,$sort:{year:-1}}}).then(c=>{i.value=c.data,c.data.length&&(g.value=c.data[0].year)})}return T(()=>{l.isReady.value&&a()}),(n,_)=>{const c=A,u=$e,L=Ve;return s(i).length?(e(),t("div",{key:0,class:Y(["industry pa4 lh-copy",{"industry--wide":s(F)}])},[o("div",xe,[o("h1",Ye,d(s(y)),1),o("p",Me,d(s(x).total)+" 本",1),o("div",Re,[w(c,{progress:s(x)},null,8,["progress"])])]),o("div",Se,[s(F)?(e(),t("div",Pe,[(e(!0),t(v,null,D(s(I),p=>(e(),t("button",{class:Y(["industry__filter bg-white pv2 ph3 ba b--light-gray br2 dim pointer",{"bg-green":s(g)===p}]),key:p,onClick:N=>f(p)},d(p),11,Ne))),128))])):(e(),t("div",qe,[(e(!0),t(v,null,D(Object.values(V),p=>(e(),t("button",{class:Y(["industry__filter bg-white pv2 ph3 ba b--light-gray br2 dim pointer",{"bg-green":s(h)===p}]),key:p,onClick:N=>P(p)},d(p),11,Ae))),128))])),o("div",je,[(e(!0),t(v,null,D(Object.values(H),p=>(e(),t("button",{class:Y(["industry__mode bg-white pv2 ph3 ba b-light-green b--light-gray br2 dim pointer",{"industry__mode--active":s(C)===p}]),key:p,onClick:N=>C.value=p},d(p),11,Be))),128))])]),s(F)?(e(),t("div",Ee,[w(u,{"report-list":s(S)},null,8,["report-list"])])):(e(),t("div",Oe,[w(L,{"report-list":s(i),filter:s(h)},null,8,["report-list","filter"])]))],2)):b("",!0)}}});export{V as FilterType,Xe as default};
