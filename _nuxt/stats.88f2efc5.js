import{u as A}from"./useProfessionApi.aff587e3.js";import{u as W}from"./useFieldMeta.6b47ff0d.js";import{f as C,r as v,h as w,o as f,c as g,i as u,d as U,a as e,t as d,F as M,y as I,j as z,q as G,O as H,s as J,b as K}from"./entry.64d8ce45.js";import{w as D}from"./lodash.5caf96cb.js";var h={},Q=X;function X(t){return!isNaN(parseFloat(t))&&isFinite(t)}h.numbers=b;h.sum=$;h.mean=L;h.median=Z;h.mode=tt;h.variance=E;h.sampleVariance=O;h.populationVariance=E;h.stdev=P;h.sampleStdev=et;h.populationStdev=P;h.percentile=nt;h.histogram=rt;var Y=Q;function b(t){var n=[];if(t==null)return n;for(var r=0;r<t.length;r++)Y(t[r])&&n.push(+t[r]);return n}function F(t){return t.sort(function(r,a){return r-a})}function $(t){t=b(t);for(var n=0,r=0;r<t.length;r++)n+=t[r];return n}function L(t){return t=b(t),t.length===0?NaN:$(t)/t.length}function Z(t){if(t=b(t),t.length===0)return NaN;var n=t.length/2|0;return t=F(t),t.length%2?t[n]:(t[n-1]+t[n])/2}function tt(t){if(t=b(t),t.length===0)return NaN;for(var n=NaN,r={},a=0;a<t.length;a++){var _=t[a],m=r[_]||0;m++,r[_]=m}var p=b(Object.keys(r).sort(function(s,k){return r[k]-r[s]}));if(n=p[0],r[p[1]]==r[n]){if(p.length==t.length)return t;for(var c=new Set([n]),y=r[n],a=1;a<p.length&&r[p[a]]==y;a++)c.add(p[a]);return c}return n}function j(t){t=b(t);for(var n=L(t),r=[],a=0;a<t.length;a++)r.push(Math.pow(t[a]-n,2));return r}function E(t){return L(j(t))}function O(t){var n=j(t);return n.length<=1?NaN:$(n)/(n.length-1)}function P(t){return Math.sqrt(E(t))}function et(t){return Math.sqrt(O(t))}function nt(t,n){if(t=b(t),t.length===0||n==null||n<0)return NaN;n>1&&(n=1),t=F(t);var r=t.length*n-.5;if((r|0)===r)return t[r];var a=r|0,_=r-a;return(1-_)*t[a]+_*t[Math.min(a+1,t.length-1)]}function rt(t,n){if(t==null||(t=F(b(t)),t.length===0))return null;n==null&&(n=Math.sqrt(t.length)),n=Math.round(n),n<1&&(n=1);var r=t[0],a=t[t.length-1];r===a&&(r=r-.5,a=a+.5);var _=a-r,m=(_+_*.05)/n,p=(r+a)/2,c=p-m*Math.floor(n/2);if(n%2!==0)var c=p-m/2-m*Math.floor(n/2);for(var y={values:Array(n).fill(0),bins:n,binWidth:m,binLimits:[c,c+m*n]},S=0,s=0;s<t.length;s++){for(;t[s]>(S+1)*m+c;)S++;y.values[S]++}return y}const at={class:"detailStats"},st={key:0,class:"mv5 tc f2"},ot={class:"fw7"},it={key:1,class:"w-100 ba b--moon-gray",cellspacing:"0"},lt=e("thead",null,[e("tr",{class:"bg-light-gray tl"},[e("th",null,"公司名稱"),e("th",null,"年度"),e("th",null,"欄位名稱"),e("th",null,"填答時間（分）"),e("th",null,"管理員改過")])],-1),dt={key:2,class:"w-100 ba b--moon-gray",cellspacing:"0"},ut=e("thead",null,[e("tr",{class:"bg-light-gray tl"},[e("th",null,"欄位名稱"),e("th",null,"平均填答時間（分）"),e("th",null,"中位數填答時間（分）"),e("th",null,"標準差填答時間（分）"),e("th",null,"管理員改過比例"),e("th",null,"填答次數")])],-1),ct=C({__name:"DetailStats",props:{reportList:{},statsType:{}},setup(t){const n=t,{feathers:r}=A(),{fieldMetaList:a,fieldMetaMap:_}=W(),m=v([]),p=v(0),c=w(()=>{const i=new Map;for(const l of n.reportList)i.set(l.id,l);return i}),y=w(()=>{const i=new Map;m.value.forEach(l=>{i.has(l.fieldId)||i.set(l.fieldId,{timeSpentList:[],meanTimeSpent:0,medianTimeSpent:0,stdTimeSpend:0,adminEditCount:0,adminEditRatio:0,count:0});const o=i.get(l.fieldId);o.timeSpentList.push(l.timeSpentInSeconds),o.adminEditCount+=l.hasAdminEdited?1:0,o.count+=1});for(const[,l]of i)l.meanTimeSpent=h.mean(l.timeSpentList),l.medianTimeSpent=h.median(l.timeSpentList),l.stdTimeSpend=h.stdev(l.timeSpentList),l.adminEditRatio=Math.round(l.adminEditCount*100/l.count);return i}),S=w(()=>a.value.filter(i=>y.value.has(i.id)));function s(i){return Math.round(i*10/60)/10}function k(i=0){return r.app.service("report-field").find({query:{timeSpentInSeconds:{$gt:0},$select:["fieldId","reportId","timeSpentInSeconds","hasAdminEdited"],$limit:500,$sort:{reportId:1,fieldId:1},$skip:i}})}async function B(){let i=0;const l=[];for(;;){const o=await k(i);if(l.push(...o.data),!o.data.length){p.value=100;break}i=o.skip+o.data.length,p.value=Math.floor(i*100/o.total)}m.value=l}return D(r.isReady,i=>{i&&B()}),(i,l)=>(f(),g("div",at,[u(p)<100?(f(),g("h1",st,[U(" 資料載入中... "),e("span",ot,d(u(p))+"%",1)])):i.statsType===u(N).reportField?(f(),g("table",it,[lt,e("tbody",null,[(f(!0),g(M,null,I(u(m),o=>(f(),g("tr",{key:o.id},[e("td",null,d(u(c).get(o.reportId).company.name),1),e("td",null,d(u(c).get(o.reportId).year),1),e("td",null,d(u(_).get(o.fieldId).name),1),e("td",null,d(s(o.timeSpentInSeconds)),1),e("td",null,d(o.hasAdminEdited?"✅":"-"),1)]))),128))])])):i.statsType===u(N).fieldMeta?(f(),g("table",dt,[ut,e("tbody",null,[(f(!0),g(M,null,I(u(S),o=>{var T,R,V,q,x;return f(),g("tr",{key:o.id},[e("td",null,d(o.name),1),e("td",null,d(s(((T=u(y).get(o.id))==null?void 0:T.meanTimeSpent)||0)),1),e("td",null,d(s(((R=u(y).get(o.id))==null?void 0:R.medianTimeSpent)||0)),1),e("td",null,d(s(((V=u(y).get(o.id))==null?void 0:V.stdTimeSpend)||0)),1),e("td",null,d(((q=u(y).get(o.id))==null?void 0:q.adminEditRatio)||0)+"%",1),e("td",null,d(((x=u(y).get(o.id))==null?void 0:x.count)||0),1)])}),128))])])):z("",!0)]))}});const pt={class:"stats pa4 lh-copy"},ht=e("div",{class:"pb3"},[e("h1",{class:"f2 fw6"},"使用狀況統計"),e("p",{class:"f4 mb4"}," 這裡只會顯示有判讀過的報告書，若要下載原始資料，請在下拉選單選取「原始資料」。 ")],-1),mt={class:"pv3 flex items-center justify-end mb4 bt bb b--moon-gray"},ft=["value"],gt={key:0,class:"f6"},_t={class:"w-100 ba b--moon-gray",cellspacing:"0"},yt=e("thead",null,[e("tr",{class:"bg-light-gray tl"},[e("th",{class:"pv2 ph3"},"公司名稱"),e("th",{class:"pv2 ph3"},"統編"),e("th",{class:"pv2 ph3"},"股票代碼"),e("th",{class:"pv2 ph3"},"報告書年度"),e("th",{class:"pv2 ph3"},"填答完成度"),e("th",{class:"pv2 ph3"},"是否驗證完畢"),e("th",{class:"pv2 ph3"},"目前累計時間（分）")])],-1),bt={class:"pv2 ph3 bt b--moon-gray"},St={class:"pv2 ph3 bt b--moon-gray"},vt={class:"pv2 ph3 bt b--moon-gray"},Mt={class:"pv2 ph3 bt b--moon-gray"},It={class:"pv2 ph3 bt b--moon-gray"},Nt={class:"pv2 ph3 bt b--moon-gray"},kt={class:"pv2 ph3 bt b--moon-gray"},wt={key:1,class:"f6"};var N=(t=>(t.report="各報告書",t.fieldMeta="各欄位",t.reportField="原始資料",t))(N||{});const Tt=C({__name:"stats",setup(t){const{feathers:n}=A(),r=Object.values(N),a=v("各報告書"),_=v([]);function m(c){return Math.round(c.timeSpentInSeconds*10/60)/10}function p(){n.app.service("report").find({query:{timeSpentInSeconds:{$gt:0},$limit:500,$sort:{answeredFields:-1}}}).then(c=>{_.value=c.data})}return D(n.isReady,c=>{c&&p()}),(c,y)=>{const S=ct;return f(),g("div",pt,[ht,e("div",mt,[G(e("select",{"onUpdate:modelValue":y[0]||(y[0]=s=>J(a)?a.value=s:null),class:"stats__control"},[(f(!0),g(M,null,I(u(r),s=>(f(),g("option",{key:s,value:s},d(s),9,ft))),128))],512),[[H,u(a)]])]),u(a)==="各報告書"?(f(),g("div",gt,[e("table",_t,[yt,e("tbody",null,[(f(!0),g(M,null,I(u(_),s=>(f(),g("tr",{key:s.id},[e("td",bt,d(s.company.name),1),e("td",St,d(s.company.id),1),e("td",vt,d(s.company.stockCode),1),e("td",Mt,d(s.year),1),e("td",It,d(s.answeredFields)+"/"+d(s.totalFields),1),e("td",Nt,d(s.isVerified?"✅":"-"),1),e("td",kt,d(m(s)),1)]))),128))])])])):(f(),g("div",wt,[K(S,{"report-list":u(_),"stats-type":u(a)},null,8,["report-list","stats-type"])]))])}}});export{N as StatsType,Tt as default};
